
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>File_level_Category_3</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="Author" content="Anonymous">
    <meta name="Keywords" content="file,category">
    <meta name="Description" content="">
    <link href="Assets/layui-v2.4.5/layui/css/layui.css" rel="stylesheet" />
    <script type="text/javascript" src="Scripts/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="Assets/layui-v2.4.5/layui/layui.js"></script>
    <style type="text/css">
        .component {
            width: 160px;
        }

        .searchbox {
            float: right;
            margin-top: 16px;
        }

            .searchbox ul li {
                display: inline-block;
            }

            .searchbox .searchinput {
                height: 30px;
            }
    </style>
    <script type="text/javascript">
        var __PageSize = 10;
    </script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?98ca367613cc2e6cb07af6941d206613";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <script>
        (function () {
            var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
            document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>
    <script>
        (function () {
            var el = document.createElement("script");
            el.src = "https://sf1-scmcdn-tos.pstatp.com/goofy/ttzz/push.js?22b548e786319b719ef88faf7d4a36dd0067dc1f7950828ecde1aa80e83255942c45b12be7ebe6ff56e915264ffe82297d4bbc6eb70d055f539142cd2fb93fe8";
            el.id = "ttzz";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(el, s);
        })(window)
    </script>
</head>
<body class="layui-bg-gray">
    <div class="layui-fluid  layui-bg-green">
        <div class="">
            <ul class="layui-container layui-nav layui-bg-green">
                <li class="layui-nav-item "><a href="index.html">Home</a></li>
                <li class="layui-nav-item ">
                    <a href="/1projects.html">Projects</a>
                </li>
                <li class="layui-nav-item ">
                    <a href="#">Method Level</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/2method_a.html">All</a></dd>
                        <dd><a href="/2method_c_1.html ">Category:Config</a></dd>
                        <dd><a href="/2method_c_2.html">Category:Function</a></dd>
                        <dd><a href="/2method_c_3.html ">Category:Fixed Format</a></dd>
                        <dd><a href="/2method_c_4.html">Category:Other</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item ">
                    <a href="#">File Level</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/3file_a.html">All</a></dd>
                        <dd><a href="/3file_c_1.html">Category:DPFile</a></dd>
                        <dd><a href="/3file_c_2.html">Category:DRFile</a></dd>
                        <dd><a href="/3file_c_3.html">Category:DIFile</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item ">
                    <a href="/4download.html">Data Download</a>
                </li>
            </ul>
        </div>
    </div>
    <br />

<style type="text/css">
    .btncus {
    }
</style>
<div class="layui-container">
    <div class="layui-row layui-col-space20">
        <div class="layui-col-xs12">
            <div class="layui-tab layui-tab-card">
                <ul class="layui-tab-title">
                    <li class="layui-this">CFile(Config File)</li>
                    <li>EHFile(Exception Handling File)</li>
                    <li>UFile(Utility File)</li>
                    <li>CSFile(Communication Support File)</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
<div class="layui-card" id="1" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.244</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> MavenWrapperDownloader.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>api-gateway\.mvn\wrapper\MavenWrapperDownloader.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
/*
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
*/

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.util.Properties;

public class MavenWrapperDownloader {

    /**
     * Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.
     */
    private static final String DEFAULT_DOWNLOAD_URL =
            "https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.4.2/maven-wrapper-0.4.2.jar";

    /**
     * Path to the maven-wrapper.properties file, which might contain a downloadUrl property to
     * use instead of the default one.
     */
    private static final String MAVEN_WRAPPER_PROPERTIES_PATH =
            ".mvn/wrapper/maven-wrapper.properties";

    /**
     * Path where the maven-wrapper.jar will be saved to.
     */
    private static final String MAVEN_WRAPPER_JAR_PATH =
            ".mvn/wrapper/maven-wrapper.jar";

    /**
     * Name of the property which should be used to override the default download url for the wrapper.
     */
    private static final String PROPERTY_NAME_WRAPPER_URL = "wrapperUrl";

    public static void main(String args[]) {
        System.out.println("- Downloader started");
        File baseDirectory = new File(args[0]);
        System.out.println("- Using base directory: " + baseDirectory.getAbsolutePath());

        // If the maven-wrapper.properties exists, read it and check if it contains a custom
        // wrapperUrl parameter.
        File mavenWrapperPropertyFile = new File(baseDirectory, MAVEN_WRAPPER_PROPERTIES_PATH);
        String url = DEFAULT_DOWNLOAD_URL;
        if (mavenWrapperPropertyFile.exists()) {
            FileInputStream mavenWrapperPropertyFileInputStream = null;
            try {
                mavenWrapperPropertyFileInputStream = new FileInputStream(mavenWrapperPropertyFile);
                Properties mavenWrapperProperties = new Properties();
                mavenWrapperProperties.load(mavenWrapperPropertyFileInputStream);
                url = mavenWrapperProperties.getProperty(PROPERTY_NAME_WRAPPER_URL, url);
            } catch (IOException e) {
                System.out.println("- ERROR loading '" + MAVEN_WRAPPER_PROPERTIES_PATH + "'");
            } finally {
                try {
                    if (mavenWrapperPropertyFileInputStream != null) {
                        mavenWrapperPropertyFileInputStream.close();
                    }
                } catch (IOException e) {
                    // Ignore ...
                }
            }
        }
        System.out.println("- Downloading from: : " + url);

        File outputFile = new File(baseDirectory.getAbsolutePath(), MAVEN_WRAPPER_JAR_PATH);
        if (!outputFile.getParentFile().exists()) {
            if (!outputFile.getParentFile().mkdirs()) {
                System.out.println(
                        "- ERROR creating output direcrory '" + outputFile.getParentFile().getAbsolutePath() + "'");
            }
        }
        System.out.println("- Downloading to: " + outputFile.getAbsolutePath());
        try {
            downloadFileFromURL(url, outputFile);
            System.out.println("Done");
            System.exit(0);
        } catch (Throwable e) {
            System.out.println("- Error downloading");
            e.printStackTrace();
            System.exit(1);
        }
    }

    private static void downloadFileFromURL(String urlString, File destination) throws Exception {
        URL website = new URL(urlString);
        ReadableByteChannel rbc;
        rbc = Channels.newChannel(website.openStream());
        FileOutputStream fos = new FileOutputStream(destination);
        fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE);
        fos.close();
        rbc.close();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="2" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.245</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> MavenWrapperDownloader.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>eureka-server\.mvn\wrapper\MavenWrapperDownloader.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
/*
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
*/

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.util.Properties;

public class MavenWrapperDownloader {

    /**
     * Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.
     */
    private static final String DEFAULT_DOWNLOAD_URL =
            "https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.4.2/maven-wrapper-0.4.2.jar";

    /**
     * Path to the maven-wrapper.properties file, which might contain a downloadUrl property to
     * use instead of the default one.
     */
    private static final String MAVEN_WRAPPER_PROPERTIES_PATH =
            ".mvn/wrapper/maven-wrapper.properties";

    /**
     * Path where the maven-wrapper.jar will be saved to.
     */
    private static final String MAVEN_WRAPPER_JAR_PATH =
            ".mvn/wrapper/maven-wrapper.jar";

    /**
     * Name of the property which should be used to override the default download url for the wrapper.
     */
    private static final String PROPERTY_NAME_WRAPPER_URL = "wrapperUrl";

    public static void main(String args[]) {
        System.out.println("- Downloader started");
        File baseDirectory = new File(args[0]);
        System.out.println("- Using base directory: " + baseDirectory.getAbsolutePath());

        // If the maven-wrapper.properties exists, read it and check if it contains a custom
        // wrapperUrl parameter.
        File mavenWrapperPropertyFile = new File(baseDirectory, MAVEN_WRAPPER_PROPERTIES_PATH);
        String url = DEFAULT_DOWNLOAD_URL;
        if (mavenWrapperPropertyFile.exists()) {
            FileInputStream mavenWrapperPropertyFileInputStream = null;
            try {
                mavenWrapperPropertyFileInputStream = new FileInputStream(mavenWrapperPropertyFile);
                Properties mavenWrapperProperties = new Properties();
                mavenWrapperProperties.load(mavenWrapperPropertyFileInputStream);
                url = mavenWrapperProperties.getProperty(PROPERTY_NAME_WRAPPER_URL, url);
            } catch (IOException e) {
                System.out.println("- ERROR loading '" + MAVEN_WRAPPER_PROPERTIES_PATH + "'");
            } finally {
                try {
                    if (mavenWrapperPropertyFileInputStream != null) {
                        mavenWrapperPropertyFileInputStream.close();
                    }
                } catch (IOException e) {
                    // Ignore ...
                }
            }
        }
        System.out.println("- Downloading from: : " + url);

        File outputFile = new File(baseDirectory.getAbsolutePath(), MAVEN_WRAPPER_JAR_PATH);
        if (!outputFile.getParentFile().exists()) {
            if (!outputFile.getParentFile().mkdirs()) {
                System.out.println(
                        "- ERROR creating output direcrory '" + outputFile.getParentFile().getAbsolutePath() + "'");
            }
        }
        System.out.println("- Downloading to: " + outputFile.getAbsolutePath());
        try {
            downloadFileFromURL(url, outputFile);
            System.out.println("Done");
            System.exit(0);
        } catch (Throwable e) {
            System.out.println("- Error downloading");
            e.printStackTrace();
            System.exit(1);
        }
    }

    private static void downloadFileFromURL(String urlString, File destination) throws Exception {
        URL website = new URL(urlString);
        ReadableByteChannel rbc;
        rbc = Channels.newChannel(website.openStream());
        FileOutputStream fos = new FileOutputStream(destination);
        fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE);
        fos.close();
        rbc.close();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="3" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.246</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> MavenWrapperDownloader.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>order-service\.mvn\wrapper\MavenWrapperDownloader.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
/*
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
*/

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.util.Properties;

public class MavenWrapperDownloader {

    /**
     * Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.
     */
    private static final String DEFAULT_DOWNLOAD_URL =
            "https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.4.2/maven-wrapper-0.4.2.jar";

    /**
     * Path to the maven-wrapper.properties file, which might contain a downloadUrl property to
     * use instead of the default one.
     */
    private static final String MAVEN_WRAPPER_PROPERTIES_PATH =
            ".mvn/wrapper/maven-wrapper.properties";

    /**
     * Path where the maven-wrapper.jar will be saved to.
     */
    private static final String MAVEN_WRAPPER_JAR_PATH =
            ".mvn/wrapper/maven-wrapper.jar";

    /**
     * Name of the property which should be used to override the default download url for the wrapper.
     */
    private static final String PROPERTY_NAME_WRAPPER_URL = "wrapperUrl";

    public static void main(String args[]) {
        System.out.println("- Downloader started");
        File baseDirectory = new File(args[0]);
        System.out.println("- Using base directory: " + baseDirectory.getAbsolutePath());

        // If the maven-wrapper.properties exists, read it and check if it contains a custom
        // wrapperUrl parameter.
        File mavenWrapperPropertyFile = new File(baseDirectory, MAVEN_WRAPPER_PROPERTIES_PATH);
        String url = DEFAULT_DOWNLOAD_URL;
        if (mavenWrapperPropertyFile.exists()) {
            FileInputStream mavenWrapperPropertyFileInputStream = null;
            try {
                mavenWrapperPropertyFileInputStream = new FileInputStream(mavenWrapperPropertyFile);
                Properties mavenWrapperProperties = new Properties();
                mavenWrapperProperties.load(mavenWrapperPropertyFileInputStream);
                url = mavenWrapperProperties.getProperty(PROPERTY_NAME_WRAPPER_URL, url);
            } catch (IOException e) {
                System.out.println("- ERROR loading '" + MAVEN_WRAPPER_PROPERTIES_PATH + "'");
            } finally {
                try {
                    if (mavenWrapperPropertyFileInputStream != null) {
                        mavenWrapperPropertyFileInputStream.close();
                    }
                } catch (IOException e) {
                    // Ignore ...
                }
            }
        }
        System.out.println("- Downloading from: : " + url);

        File outputFile = new File(baseDirectory.getAbsolutePath(), MAVEN_WRAPPER_JAR_PATH);
        if (!outputFile.getParentFile().exists()) {
            if (!outputFile.getParentFile().mkdirs()) {
                System.out.println(
                        "- ERROR creating output direcrory '" + outputFile.getParentFile().getAbsolutePath() + "'");
            }
        }
        System.out.println("- Downloading to: " + outputFile.getAbsolutePath());
        try {
            downloadFileFromURL(url, outputFile);
            System.out.println("Done");
            System.exit(0);
        } catch (Throwable e) {
            System.out.println("- Error downloading");
            e.printStackTrace();
            System.exit(1);
        }
    }

    private static void downloadFileFromURL(String urlString, File destination) throws Exception {
        URL website = new URL(urlString);
        ReadableByteChannel rbc;
        rbc = Channels.newChannel(website.openStream());
        FileOutputStream fos = new FileOutputStream(destination);
        fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE);
        fos.close();
        rbc.close();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="4" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.248</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> MavenWrapperDownloader.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>product-catalog-service\.mvn\wrapper\MavenWrapperDownloader.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
/*
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
*/

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.util.Properties;

public class MavenWrapperDownloader {

    /**
     * Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.
     */
    private static final String DEFAULT_DOWNLOAD_URL =
            "https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.4.2/maven-wrapper-0.4.2.jar";

    /**
     * Path to the maven-wrapper.properties file, which might contain a downloadUrl property to
     * use instead of the default one.
     */
    private static final String MAVEN_WRAPPER_PROPERTIES_PATH =
            ".mvn/wrapper/maven-wrapper.properties";

    /**
     * Path where the maven-wrapper.jar will be saved to.
     */
    private static final String MAVEN_WRAPPER_JAR_PATH =
            ".mvn/wrapper/maven-wrapper.jar";

    /**
     * Name of the property which should be used to override the default download url for the wrapper.
     */
    private static final String PROPERTY_NAME_WRAPPER_URL = "wrapperUrl";

    public static void main(String args[]) {
        System.out.println("- Downloader started");
        File baseDirectory = new File(args[0]);
        System.out.println("- Using base directory: " + baseDirectory.getAbsolutePath());

        // If the maven-wrapper.properties exists, read it and check if it contains a custom
        // wrapperUrl parameter.
        File mavenWrapperPropertyFile = new File(baseDirectory, MAVEN_WRAPPER_PROPERTIES_PATH);
        String url = DEFAULT_DOWNLOAD_URL;
        if (mavenWrapperPropertyFile.exists()) {
            FileInputStream mavenWrapperPropertyFileInputStream = null;
            try {
                mavenWrapperPropertyFileInputStream = new FileInputStream(mavenWrapperPropertyFile);
                Properties mavenWrapperProperties = new Properties();
                mavenWrapperProperties.load(mavenWrapperPropertyFileInputStream);
                url = mavenWrapperProperties.getProperty(PROPERTY_NAME_WRAPPER_URL, url);
            } catch (IOException e) {
                System.out.println("- ERROR loading '" + MAVEN_WRAPPER_PROPERTIES_PATH + "'");
            } finally {
                try {
                    if (mavenWrapperPropertyFileInputStream != null) {
                        mavenWrapperPropertyFileInputStream.close();
                    }
                } catch (IOException e) {
                    // Ignore ...
                }
            }
        }
        System.out.println("- Downloading from: : " + url);

        File outputFile = new File(baseDirectory.getAbsolutePath(), MAVEN_WRAPPER_JAR_PATH);
        if (!outputFile.getParentFile().exists()) {
            if (!outputFile.getParentFile().mkdirs()) {
                System.out.println(
                        "- ERROR creating output direcrory '" + outputFile.getParentFile().getAbsolutePath() + "'");
            }
        }
        System.out.println("- Downloading to: " + outputFile.getAbsolutePath());
        try {
            downloadFileFromURL(url, outputFile);
            System.out.println("Done");
            System.exit(0);
        } catch (Throwable e) {
            System.out.println("- Error downloading");
            e.printStackTrace();
            System.exit(1);
        }
    }

    private static void downloadFileFromURL(String urlString, File destination) throws Exception {
        URL website = new URL(urlString);
        ReadableByteChannel rbc;
        rbc = Channels.newChannel(website.openStream());
        FileOutputStream fos = new FileOutputStream(destination);
        fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE);
        fos.close();
        rbc.close();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="5" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.250</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> MavenWrapperDownloader.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>product-recommendation-service\.mvn\wrapper\MavenWrapperDownloader.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
/*
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
*/

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.util.Properties;

public class MavenWrapperDownloader {

    /**
     * Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.
     */
    private static final String DEFAULT_DOWNLOAD_URL =
            "https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.4.2/maven-wrapper-0.4.2.jar";

    /**
     * Path to the maven-wrapper.properties file, which might contain a downloadUrl property to
     * use instead of the default one.
     */
    private static final String MAVEN_WRAPPER_PROPERTIES_PATH =
            ".mvn/wrapper/maven-wrapper.properties";

    /**
     * Path where the maven-wrapper.jar will be saved to.
     */
    private static final String MAVEN_WRAPPER_JAR_PATH =
            ".mvn/wrapper/maven-wrapper.jar";

    /**
     * Name of the property which should be used to override the default download url for the wrapper.
     */
    private static final String PROPERTY_NAME_WRAPPER_URL = "wrapperUrl";

    public static void main(String args[]) {
        System.out.println("- Downloader started");
        File baseDirectory = new File(args[0]);
        System.out.println("- Using base directory: " + baseDirectory.getAbsolutePath());

        // If the maven-wrapper.properties exists, read it and check if it contains a custom
        // wrapperUrl parameter.
        File mavenWrapperPropertyFile = new File(baseDirectory, MAVEN_WRAPPER_PROPERTIES_PATH);
        String url = DEFAULT_DOWNLOAD_URL;
        if (mavenWrapperPropertyFile.exists()) {
            FileInputStream mavenWrapperPropertyFileInputStream = null;
            try {
                mavenWrapperPropertyFileInputStream = new FileInputStream(mavenWrapperPropertyFile);
                Properties mavenWrapperProperties = new Properties();
                mavenWrapperProperties.load(mavenWrapperPropertyFileInputStream);
                url = mavenWrapperProperties.getProperty(PROPERTY_NAME_WRAPPER_URL, url);
            } catch (IOException e) {
                System.out.println("- ERROR loading '" + MAVEN_WRAPPER_PROPERTIES_PATH + "'");
            } finally {
                try {
                    if (mavenWrapperPropertyFileInputStream != null) {
                        mavenWrapperPropertyFileInputStream.close();
                    }
                } catch (IOException e) {
                    // Ignore ...
                }
            }
        }
        System.out.println("- Downloading from: : " + url);

        File outputFile = new File(baseDirectory.getAbsolutePath(), MAVEN_WRAPPER_JAR_PATH);
        if (!outputFile.getParentFile().exists()) {
            if (!outputFile.getParentFile().mkdirs()) {
                System.out.println(
                        "- ERROR creating output direcrory '" + outputFile.getParentFile().getAbsolutePath() + "'");
            }
        }
        System.out.println("- Downloading to: " + outputFile.getAbsolutePath());
        try {
            downloadFileFromURL(url, outputFile);
            System.out.println("Done");
            System.exit(0);
        } catch (Throwable e) {
            System.out.println("- Error downloading");
            e.printStackTrace();
            System.exit(1);
        }
    }

    private static void downloadFileFromURL(String urlString, File destination) throws Exception {
        URL website = new URL(urlString);
        ReadableByteChannel rbc;
        rbc = Channels.newChannel(website.openStream());
        FileOutputStream fos = new FileOutputStream(destination);
        fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE);
        fos.close();
        rbc.close();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="6" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.252</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> MavenWrapperDownloader.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>user-service\.mvn\wrapper\MavenWrapperDownloader.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
/*
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
*/

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.util.Properties;

public class MavenWrapperDownloader {

    /**
     * Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.
     */
    private static final String DEFAULT_DOWNLOAD_URL =
            "https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.4.2/maven-wrapper-0.4.2.jar";

    /**
     * Path to the maven-wrapper.properties file, which might contain a downloadUrl property to
     * use instead of the default one.
     */
    private static final String MAVEN_WRAPPER_PROPERTIES_PATH =
            ".mvn/wrapper/maven-wrapper.properties";

    /**
     * Path where the maven-wrapper.jar will be saved to.
     */
    private static final String MAVEN_WRAPPER_JAR_PATH =
            ".mvn/wrapper/maven-wrapper.jar";

    /**
     * Name of the property which should be used to override the default download url for the wrapper.
     */
    private static final String PROPERTY_NAME_WRAPPER_URL = "wrapperUrl";

    public static void main(String args[]) {
        System.out.println("- Downloader started");
        File baseDirectory = new File(args[0]);
        System.out.println("- Using base directory: " + baseDirectory.getAbsolutePath());

        // If the maven-wrapper.properties exists, read it and check if it contains a custom
        // wrapperUrl parameter.
        File mavenWrapperPropertyFile = new File(baseDirectory, MAVEN_WRAPPER_PROPERTIES_PATH);
        String url = DEFAULT_DOWNLOAD_URL;
        if (mavenWrapperPropertyFile.exists()) {
            FileInputStream mavenWrapperPropertyFileInputStream = null;
            try {
                mavenWrapperPropertyFileInputStream = new FileInputStream(mavenWrapperPropertyFile);
                Properties mavenWrapperProperties = new Properties();
                mavenWrapperProperties.load(mavenWrapperPropertyFileInputStream);
                url = mavenWrapperProperties.getProperty(PROPERTY_NAME_WRAPPER_URL, url);
            } catch (IOException e) {
                System.out.println("- ERROR loading '" + MAVEN_WRAPPER_PROPERTIES_PATH + "'");
            } finally {
                try {
                    if (mavenWrapperPropertyFileInputStream != null) {
                        mavenWrapperPropertyFileInputStream.close();
                    }
                } catch (IOException e) {
                    // Ignore ...
                }
            }
        }
        System.out.println("- Downloading from: : " + url);

        File outputFile = new File(baseDirectory.getAbsolutePath(), MAVEN_WRAPPER_JAR_PATH);
        if (!outputFile.getParentFile().exists()) {
            if (!outputFile.getParentFile().mkdirs()) {
                System.out.println(
                        "- ERROR creating output direcrory '" + outputFile.getParentFile().getAbsolutePath() + "'");
            }
        }
        System.out.println("- Downloading to: " + outputFile.getAbsolutePath());
        try {
            downloadFileFromURL(url, outputFile);
            System.out.println("Done");
            System.exit(0);
        } catch (Throwable e) {
            System.out.println("- Error downloading");
            e.printStackTrace();
            System.exit(1);
        }
    }

    private static void downloadFileFromURL(String urlString, File destination) throws Exception {
        URL website = new URL(urlString);
        ReadableByteChannel rbc;
        rbc = Channels.newChannel(website.openStream());
        FileOutputStream fos = new FileOutputStream(destination);
        fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE);
        fos.close();
        rbc.close();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="7" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.257</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> CacheConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-outside\src\main\java\com\stalary\pf\outside\config\CacheConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.outside.config;

import com.alibaba.fastjson.support.spring.GenericFastJsonRedisSerializer;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.Cache;
import org.springframework.cache.annotation.CachingConfigurerSupport;
import org.springframework.cache.interceptor.CacheErrorHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.serializer.StringRedisSerializer;

/**
 * CacheConfig
 *
 * @author lirongqian
 * @since 2018/10/22
 */
@Configuration
@Slf4j
public class CacheConfig extends CachingConfigurerSupport {

    /**
     * redis序列化配置，使用lettuce客户端
     */
    @Bean
    public &lt;T&gt; RedisTemplate&lt;String, T&gt; redisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, T&gt; template = new RedisTemplate&lt;&gt;();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new GenericFastJsonRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new GenericFastJsonRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Bean
    public StringRedisTemplate stringRedisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        StringRedisTemplate template = new StringRedisTemplate();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new StringRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new StringRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Override
    public CacheErrorHandler errorHandler() {
        return new CacheErrorHandler() {
            @Override
            public void handleCacheGetError(RuntimeException e, Cache cache, Object key) {
                log.warn("获取缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCachePutError(RuntimeException e, Cache cache, Object key, Object value) {
                log.warn("handleCachePutError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheEvictError(RuntimeException e, Cache cache, Object key) {
                log.warn("handleCacheEvictError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheClearError(RuntimeException e, Cache cache) {
                log.warn("清除缓存时异常--- 异常信息:" + e);
            }
        };
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="8" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.258</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> PrefixRedisSerializer.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-outside\src\main\java\com\stalary\pf\outside\config\PrefixRedisSerializer.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.outside.config;

import com.stalary.pf.outside.data.Constant;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.serializer.RedisSerializer;
import org.springframework.stereotype.Component;
import org.springframework.util.Assert;

import java.nio.charset.Charset;

/**
 * PrefixRedisSerializer
 *
 * @author lirongqian
 * @since 2018/10/21
 */
@Component
@Slf4j
public class PrefixRedisSerializer implements RedisSerializer&lt;String&gt; {

    private String prefix = "pf";

    private final Charset charset;

    public PrefixRedisSerializer() {
        this(Charset.forName("UTF8"));
    }

    public PrefixRedisSerializer(Charset charset) {
        Assert.notNull(charset, "Charset must not be null!");
        this.charset = charset;
    }


    @Override
    public String deserialize(byte[] bytes) {
        String saveKey = new String(bytes, charset);
        int indexOf = saveKey.indexOf(prefix);
        if (indexOf &gt; 0) {
            log.warn("key缺少前缀");
        } else {
            saveKey = saveKey.substring(indexOf + prefix.length() + 1);
        }
        return saveKey;
    }

    @Override
    public byte[] serialize(String string) {
        String key = prefix + Constant.SPLIT + string;
        return key.getBytes(charset);
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="9" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.260</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> CacheConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-push\src\main\java\com\stalary\pf\push\config\CacheConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.push.config;

import com.alibaba.fastjson.support.spring.GenericFastJsonRedisSerializer;
import com.stalary.pf.push.service.MessageService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.Cache;
import org.springframework.cache.annotation.CachingConfigurerSupport;
import org.springframework.cache.interceptor.CacheErrorHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.listener.PatternTopic;
import org.springframework.data.redis.listener.RedisMessageListenerContainer;
import org.springframework.data.redis.listener.adapter.MessageListenerAdapter;
import org.springframework.data.redis.serializer.StringRedisSerializer;

/**
 * CacheConfig
 *
 * @author lirongqian
 * @since 2018/10/22
 */
@Configuration
@Slf4j
public class CacheConfig extends CachingConfigurerSupport {

    /**
     * redis序列化配置，使用lettuce客户端
     */
    @Bean
    public &lt;T&gt; RedisTemplate&lt;String, T&gt; redisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, T&gt; template = new RedisTemplate&lt;&gt;();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new GenericFastJsonRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new GenericFastJsonRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Bean
    public StringRedisTemplate stringRedisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        StringRedisTemplate template = new StringRedisTemplate();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new StringRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new StringRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Override
    public CacheErrorHandler errorHandler() {
        return new CacheErrorHandler() {
            @Override
            public void handleCacheGetError(RuntimeException e, Cache cache, Object key) {
                log.warn("获取缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCachePutError(RuntimeException e, Cache cache, Object key, Object value) {
                log.warn("handleCachePutError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheEvictError(RuntimeException e, Cache cache, Object key) {
                log.warn("handleCacheEvictError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheClearError(RuntimeException e, Cache cache) {
                log.warn("清除缓存时异常--- 异常信息:" + e);
            }
        };
    }

    @Bean
    RedisMessageListenerContainer container(RedisConnectionFactory connectionFactory,
                                            MessageListenerAdapter listenerAdapter) {
        RedisMessageListenerContainer container = new RedisMessageListenerContainer();
        container.setConnectionFactory(connectionFactory);
        // 订阅频道
        container.addMessageListener(listenerAdapter, new PatternTopic(MessageService.MESSAGE_CHANNEL));
        container.addMessageListener(listenerAdapter, new PatternTopic(MessageService.CLOSE_CHANNEL));
        return container;
    }

    @Bean
    MessageListenerAdapter listenerAdapter(MessageService receiver) {
        return new MessageListenerAdapter(receiver, "receiveMessage");
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="10" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.261</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> PrefixRedisSerializer.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-push\src\main\java\com\stalary\pf\push\config\PrefixRedisSerializer.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.push.config;

import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.serializer.RedisSerializer;
import org.springframework.stereotype.Component;
import org.springframework.util.Assert;

import java.nio.charset.Charset;

/**
 * PrefixRedisSerializer
 *
 * @author lirongqian
 * @since 2018/10/21
 */
@Component
@Slf4j
public class PrefixRedisSerializer implements RedisSerializer&lt;String&gt; {

    private String prefix = "pf";

    private final Charset charset;

    public PrefixRedisSerializer() {
        this(Charset.forName("UTF8"));
    }

    public PrefixRedisSerializer(Charset charset) {
        Assert.notNull(charset, "Charset must not be null!");
        this.charset = charset;
    }


    @Override
    public String deserialize(byte[] bytes) {
        String saveKey = new String(bytes, charset);
        int indexOf = saveKey.indexOf(prefix);
        if (indexOf &gt; 0) {
            log.warn("key缺少前缀");
        } else {
            saveKey = saveKey.substring(indexOf + prefix.length() + 1);
        }
        return saveKey;
    }

    @Override
    public byte[] serialize(String string) {
        String key = prefix + ":" + string;
        return key.getBytes(charset);
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="11" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.262</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> CacheConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-recruit\src\main\java\com\stalary\pf\recruit\config\CacheConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.recruit.config;

import com.alibaba.fastjson.support.spring.GenericFastJsonRedisSerializer;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.Cache;
import org.springframework.cache.annotation.CachingConfigurerSupport;
import org.springframework.cache.interceptor.CacheErrorHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.serializer.StringRedisSerializer;

/**
 * CacheConfig
 *
 * @author lirongqian
 * @since 2018/10/22
 */
@Configuration
@Slf4j
public class CacheConfig extends CachingConfigurerSupport {

    /**
     * redis序列化配置，使用lettuce客户端
     */
    @Bean
    public &lt;T&gt; RedisTemplate&lt;String, T&gt; redisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, T&gt; template = new RedisTemplate&lt;&gt;();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new GenericFastJsonRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new GenericFastJsonRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Bean
    public StringRedisTemplate stringRedisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        StringRedisTemplate template = new StringRedisTemplate();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new StringRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new StringRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Override
    public CacheErrorHandler errorHandler() {
        return new CacheErrorHandler() {
            @Override
            public void handleCacheGetError(RuntimeException e, Cache cache, Object key) {
                log.warn("获取缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCachePutError(RuntimeException e, Cache cache, Object key, Object value) {
                log.warn("handleCachePutError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheEvictError(RuntimeException e, Cache cache, Object key) {
                log.warn("handleCacheEvictError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheClearError(RuntimeException e, Cache cache) {
                log.warn("清除缓存时异常--- 异常信息:" + e);
            }
        };
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="12" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.263</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> PrefixRedisSerializer.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-recruit\src\main\java\com\stalary\pf\recruit\config\PrefixRedisSerializer.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.recruit.config;

import com.stalary.pf.recruit.data.constant.Constant;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.serializer.RedisSerializer;
import org.springframework.stereotype.Component;
import org.springframework.util.Assert;

import java.nio.charset.Charset;

/**
 * PrefixRedisSerializer
 *
 * @author lirongqian
 * @since 2018/10/21
 */
@Component
@Slf4j
public class PrefixRedisSerializer implements RedisSerializer&lt;String&gt; {

    private String prefix = "pf";

    private final Charset charset;

    public PrefixRedisSerializer() {
        this(Charset.forName("UTF8"));
    }

    public PrefixRedisSerializer(Charset charset) {
        Assert.notNull(charset, "Charset must not be null!");
        this.charset = charset;
    }


    @Override
    public String deserialize(byte[] bytes) {
        String saveKey = new String(bytes, charset);
        int indexOf = saveKey.indexOf(prefix);
        if (indexOf &gt; 0) {
            log.warn("key缺少前缀");
        } else {
            saveKey = saveKey.substring(indexOf + prefix.length() + 1);
        }
        return saveKey;
    }

    @Override
    public byte[] serialize(String string) {
        String key = prefix + Constant.SPLIT + string;
        return key.getBytes(charset);
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="13" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.265</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> CacheConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-resume\src\main\java\com\stalary\pf\resume\config\CacheConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.resume.config;

import com.alibaba.fastjson.support.spring.GenericFastJsonRedisSerializer;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.Cache;
import org.springframework.cache.annotation.CachingConfigurerSupport;
import org.springframework.cache.interceptor.CacheErrorHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.serializer.StringRedisSerializer;

/**
 * CacheConfig
 *
 * @author lirongqian
 * @since 2018/10/22
 */
@Configuration
@Slf4j
public class CacheConfig extends CachingConfigurerSupport {

    /**
     * redis序列化配置，使用lettuce客户端
     */
    @Bean
    public &lt;T&gt; RedisTemplate&lt;String, T&gt; redisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, T&gt; template = new RedisTemplate&lt;&gt;();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new GenericFastJsonRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new GenericFastJsonRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Bean
    public StringRedisTemplate stringRedisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        StringRedisTemplate template = new StringRedisTemplate();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new StringRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new StringRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Override
    public CacheErrorHandler errorHandler() {
        return new CacheErrorHandler() {
            @Override
            public void handleCacheGetError(RuntimeException e, Cache cache, Object key) {
                log.warn("获取缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCachePutError(RuntimeException e, Cache cache, Object key, Object value) {
                log.warn("handleCachePutError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheEvictError(RuntimeException e, Cache cache, Object key) {
                log.warn("handleCacheEvictError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheClearError(RuntimeException e, Cache cache) {
                log.warn("清除缓存时异常--- 异常信息:" + e);
            }
        };
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="14" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.266</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> PrefixRedisSerializer.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-resume\src\main\java\com\stalary\pf\resume\config\PrefixRedisSerializer.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.resume.config;

import com.stalary.pf.resume.data.constant.Constant;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.serializer.RedisSerializer;
import org.springframework.stereotype.Component;
import org.springframework.util.Assert;

import java.nio.charset.Charset;

/**
 * PrefixRedisSerializer
 *
 * @author lirongqian
 * @since 2018/10/21
 */
@Component
@Slf4j
public class PrefixRedisSerializer implements RedisSerializer&lt;String&gt; {

    private String prefix = "pf";

    private final Charset charset;

    public PrefixRedisSerializer() {
        this(Charset.forName("UTF8"));
    }

    public PrefixRedisSerializer(Charset charset) {
        Assert.notNull(charset, "Charset must not be null!");
        this.charset = charset;
    }


    @Override
    public String deserialize(byte[] bytes) {
        String saveKey = new String(bytes, charset);
        int indexOf = saveKey.indexOf(prefix);
        if (indexOf &gt; 0) {
            log.warn("key缺少前缀");
        } else {
            saveKey = saveKey.substring(indexOf + prefix.length() + 1);
        }
        return saveKey;
    }

    @Override
    public byte[] serialize(String string) {
        String key = prefix + Constant.SPLIT + string;
        return key.getBytes(charset);
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="15" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.268</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> CacheConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-user\src\main\java\com\stalary\pf\user\config\CacheConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.user.config;

import com.alibaba.fastjson.support.spring.GenericFastJsonRedisSerializer;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.Cache;
import org.springframework.cache.annotation.CachingConfigurerSupport;
import org.springframework.cache.interceptor.CacheErrorHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.serializer.StringRedisSerializer;

/**
 * CacheConfig
 *
 * @author lirongqian
 * @since 2018/10/22
 */
@Configuration
@Slf4j
public class CacheConfig extends CachingConfigurerSupport {

    /**
     * redis序列化配置，使用lettuce客户端
     */
    @Bean
    public &lt;T&gt; RedisTemplate&lt;String, T&gt; redisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, T&gt; template = new RedisTemplate&lt;&gt;();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new GenericFastJsonRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new GenericFastJsonRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Bean
    public StringRedisTemplate stringRedisTemplate(LettuceConnectionFactory redisConnectionFactory) {
        StringRedisTemplate template = new StringRedisTemplate();
        template.setKeySerializer(new PrefixRedisSerializer());
        template.setValueSerializer(new StringRedisSerializer());
        template.setConnectionFactory(redisConnectionFactory);
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new StringRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }

    @Override
    public CacheErrorHandler errorHandler() {
        return new CacheErrorHandler() {
            @Override
            public void handleCacheGetError(RuntimeException e, Cache cache, Object key) {
                log.warn("获取缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCachePutError(RuntimeException e, Cache cache, Object key, Object value) {
                log.warn("handleCachePutError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheEvictError(RuntimeException e, Cache cache, Object key) {
                log.warn("handleCacheEvictError缓存时异常---key: " + key + " 异常信息:" + e);
            }

            @Override
            public void handleCacheClearError(RuntimeException e, Cache cache) {
                log.warn("清除缓存时异常--- 异常信息:" + e);
            }
        };
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="16" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.269</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> PrefixRedisSerializer.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-user\src\main\java\com\stalary\pf\user\config\PrefixRedisSerializer.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">

package com.stalary.pf.user.config;

import com.stalary.pf.user.data.constant.Constant;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.serializer.RedisSerializer;
import org.springframework.stereotype.Component;
import org.springframework.util.Assert;

import java.nio.charset.Charset;

/**
 * PrefixRedisSerializer
 *
 * @author lirongqian
 * @since 2018/10/21
 */
@Component
@Slf4j
public class PrefixRedisSerializer implements RedisSerializer&lt;String&gt; {

    private String prefix = "pf";

    private final Charset charset;

    public PrefixRedisSerializer() {
        this(Charset.forName("UTF8"));
    }

    public PrefixRedisSerializer(Charset charset) {
        Assert.notNull(charset, "Charset must not be null!");
        this.charset = charset;
    }


    @Override
    public String deserialize(byte[] bytes) {
        String saveKey = new String(bytes, charset);
        int indexOf = saveKey.indexOf(prefix);
        if (indexOf &gt; 0) {
            log.warn("key缺少前缀");
        } else {
            saveKey = saveKey.substring(indexOf + prefix.length() + 1);
        }
        return saveKey;
    }

    @Override
    public byte[] serialize(String string) {
        String key = prefix + Constant.SPLIT + string;
        return key.getBytes(charset);
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="17" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.271</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> NetworkDisk</a><br />
<b> <a> File: </a> </b>  <a> CoreZuulApplication.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pan-core-service\pan-core-zuul\src\main\java\top\quhailong\pan\core\zuul\CoreZuulApplication.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package top.quhailong.pan.core.zuul;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.netflix.zuul.EnableZuulProxy;
import org.springframework.context.annotation.Bean;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;

/**
 * 登录、注册网关
 * @author 屈海龙
 *
 */
@EnableZuulProxy
@EnableDiscoveryClient
@SpringBootApplication
public class CoreZuulApplication {

	public static void main(String[] args) {
		SpringApplication.run(CoreZuulApplication.class, args);
	}
	@Bean
    public CorsFilter corsFilter() {
		final UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        final CorsConfiguration config = new CorsConfiguration();
        config.setAllowCredentials(true); // 允许cookies跨域
        //config.addAllowedOrigin("http://regist.727pan.cn");// #允许向该服务器提交请求的URI，*表示全部允许，在SpringMVC中，如果设成*，会自动转成当前请求头中的Origin
        //config.addAllowedOrigin("http://727pan.cn");// #允许向该服务器提交请求的URI，*表示全部允许，在SpringMVC中，如果设成*，会自动转成当前请求头中的Origin
        config.addAllowedOrigin("*");// #允许向该服务器提交请求的URI，*表示全部允许，在SpringMVC中，如果设成*，会自动转成当前请求头中的Origin
        config.addAllowedHeader("*");// #允许访问的头信息,*表示全部
        config.addAllowedMethod("*");// 允许提交请求的方法，*表示全部允许
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="18" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.273</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> NetworkDisk</a><br />
<b> <a> File: </a> </b>  <a> FileZuulApplication.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pan-file-service\pan-file-zuul\src\main\java\top\quhailong\pan\file\zuul\FileZuulApplication.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package top.quhailong.pan.file.zuul;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
import org.springframework.cloud.netflix.zuul.EnableZuulProxy;
import org.springframework.context.annotation.Bean;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;

/**
 * 系统核心网关
 * @author 屈海龙
 *
 */
@SpringBootApplication
@EnableEurekaClient
@EnableZuulProxy
public class FileZuulApplication {

	public static void main(String[] args) {
		SpringApplication.run(FileZuulApplication.class, args);
	}
	@Bean
    public CorsFilter corsFilter() {
		final UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        final CorsConfiguration config = new CorsConfiguration();
        config.setAllowCredentials(true); // 允许cookies跨域
        //config.addAllowedOrigin("http://localhost:8082");// #允许向该服务器提交请求的URI，*表示全部允许，在SpringMVC中，如果设成*，会自动转成当前请求头中的Origin
        config.addAllowedOrigin("*");// #允许向该服务器提交请求的URI，*表示全部允许，在SpringMVC中，如果设成*，会自动转成当前请求头中的Origin
        config.addAllowedHeader("*");// #允许访问的头信息,*表示全部
        config.addAllowedMethod("*");// 允许提交请求的方法，*表示全部允许
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="19" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.275</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> simplemall</a><br />
<b> <a> File: </a> </b>  <a> DruidDataSourceConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>account-sevice\src\main\java\com\simplemall\account\config\DruidDataSourceConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.simplemall.account.config;

import com.alibaba.druid.pool.DruidDataSource;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

import javax.sql.DataSource;
import java.sql.SQLException;

@Configuration
@EnableConfigurationProperties(DataSourceProperties.class)
public class DruidDataSourceConfig {

    private static Logger logger = LoggerFactory.getLogger(DruidDataSourceConfig.class);

    @Autowired
    private DataSourceProperties dataSourceProperties;

    @Bean
    @Primary
    public DataSource druidDataSource(){
        DruidDataSource datasource = new DruidDataSource();

        datasource.setUrl(dataSourceProperties.getUrl());
        datasource.setUsername(dataSourceProperties.getUsername());
        datasource.setPassword(dataSourceProperties.getPassword());
        datasource.setDriverClassName(dataSourceProperties.getDriverClassName());
        datasource.setInitialSize(dataSourceProperties.getInitialSize());
        datasource.setMinIdle(dataSourceProperties.getMinIdle());
        datasource.setMaxActive(dataSourceProperties.getMaxActive());
        datasource.setMaxWait(dataSourceProperties.getMaxWait());
        datasource.setTimeBetweenEvictionRunsMillis(dataSourceProperties.getTimeBetweenEvictionRunsMillis());
        datasource.setMinEvictableIdleTimeMillis(dataSourceProperties.getMinEvictableIdleTimeMillis());
        datasource.setValidationQuery(dataSourceProperties.getValidationQuery());
        datasource.setTestWhileIdle(dataSourceProperties.isTestWhileIdle());
        datasource.setTestOnBorrow(dataSourceProperties.isTestOnBorrow());
        datasource.setTestOnReturn(dataSourceProperties.isTestOnReturn());
        datasource.setPoolPreparedStatements(dataSourceProperties.isPoolPreparedStatements());
        try {
            datasource.setFilters(dataSourceProperties.getFilters());
        } catch (SQLException e) {
            logger.error("Druid configuration initialization filter error.", e);
        }
        return datasource;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="20" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.276</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> simplemall</a><br />
<b> <a> File: </a> </b>  <a> DruidDataSourceConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>msg-service\src\main\java\com\simplemall\micro\serv\msg\config\DruidDataSourceConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.simplemall.micro.serv.msg.config;

import com.alibaba.druid.pool.DruidDataSource;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

import javax.sql.DataSource;
import java.sql.SQLException;

@Configuration
@EnableConfigurationProperties(DataSourceProperties.class)
public class DruidDataSourceConfig {

    private static Logger logger = LoggerFactory.getLogger(DruidDataSourceConfig.class);

    @Autowired
    private DataSourceProperties dataSourceProperties;

    @Bean
    @Primary
    public DataSource druidDataSource(){
        DruidDataSource datasource = new DruidDataSource();

        datasource.setUrl(dataSourceProperties.getUrl());
        datasource.setUsername(dataSourceProperties.getUsername());
        datasource.setPassword(dataSourceProperties.getPassword());
        datasource.setDriverClassName(dataSourceProperties.getDriverClassName());
        datasource.setInitialSize(dataSourceProperties.getInitialSize());
        datasource.setMinIdle(dataSourceProperties.getMinIdle());
        datasource.setMaxActive(dataSourceProperties.getMaxActive());
        datasource.setMaxWait(dataSourceProperties.getMaxWait());
        datasource.setTimeBetweenEvictionRunsMillis(dataSourceProperties.getTimeBetweenEvictionRunsMillis());
        datasource.setMinEvictableIdleTimeMillis(dataSourceProperties.getMinEvictableIdleTimeMillis());
        datasource.setValidationQuery(dataSourceProperties.getValidationQuery());
        datasource.setTestWhileIdle(dataSourceProperties.isTestWhileIdle());
        datasource.setTestOnBorrow(dataSourceProperties.isTestOnBorrow());
        datasource.setTestOnReturn(dataSourceProperties.isTestOnReturn());
        datasource.setPoolPreparedStatements(dataSourceProperties.isPoolPreparedStatements());
        try {
            datasource.setFilters(dataSourceProperties.getFilters());
        } catch (SQLException e) {
            logger.error("Druid configuration initialization filter error.", e);
        }
        return datasource;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="21" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.277</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> simplemall</a><br />
<b> <a> File: </a> </b>  <a> DruidDataSourceConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>order-service\src\main\java\com\simplemall\micro\serv\order\config\DruidDataSourceConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.simplemall.micro.serv.order.config;

import com.alibaba.druid.pool.DruidDataSource;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

import javax.sql.DataSource;
import java.sql.SQLException;

@Configuration
@EnableConfigurationProperties(DataSourceProperties.class)
public class DruidDataSourceConfig {

    private static Logger logger = LoggerFactory.getLogger(DruidDataSourceConfig.class);

    @Autowired
    private DataSourceProperties dataSourceProperties;

    @Bean
    @Primary
    public DataSource druidDataSource(){
        DruidDataSource datasource = new DruidDataSource();

        datasource.setUrl(dataSourceProperties.getUrl());
        datasource.setUsername(dataSourceProperties.getUsername());
        datasource.setPassword(dataSourceProperties.getPassword());
        datasource.setDriverClassName(dataSourceProperties.getDriverClassName());
        datasource.setInitialSize(dataSourceProperties.getInitialSize());
        datasource.setMinIdle(dataSourceProperties.getMinIdle());
        datasource.setMaxActive(dataSourceProperties.getMaxActive());
        datasource.setMaxWait(dataSourceProperties.getMaxWait());
        datasource.setTimeBetweenEvictionRunsMillis(dataSourceProperties.getTimeBetweenEvictionRunsMillis());
        datasource.setMinEvictableIdleTimeMillis(dataSourceProperties.getMinEvictableIdleTimeMillis());
        datasource.setValidationQuery(dataSourceProperties.getValidationQuery());
        datasource.setTestWhileIdle(dataSourceProperties.isTestWhileIdle());
        datasource.setTestOnBorrow(dataSourceProperties.isTestOnBorrow());
        datasource.setTestOnReturn(dataSourceProperties.isTestOnReturn());
        datasource.setPoolPreparedStatements(dataSourceProperties.isPoolPreparedStatements());
        try {
            datasource.setFilters(dataSourceProperties.getFilters());
        } catch (SQLException e) {
            logger.error("Druid configuration initialization filter error.", e);
        }
        return datasource;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="22" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.278</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> simplemall</a><br />
<b> <a> File: </a> </b>  <a> DruidDataSourceConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>payment-service\src\main\java\com\simplemall\pay\config\DruidDataSourceConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.simplemall.pay.config;

import com.alibaba.druid.pool.DruidDataSource;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

import javax.sql.DataSource;
import java.sql.SQLException;

@Configuration
@EnableConfigurationProperties(DataSourceProperties.class)
public class DruidDataSourceConfig {

    private static Logger logger = LoggerFactory.getLogger(DruidDataSourceConfig.class);

    @Autowired
    private DataSourceProperties dataSourceProperties;

    @Bean
    @Primary
    public DataSource druidDataSource(){
        DruidDataSource datasource = new DruidDataSource();

        datasource.setUrl(dataSourceProperties.getUrl());
        datasource.setUsername(dataSourceProperties.getUsername());
        datasource.setPassword(dataSourceProperties.getPassword());
        datasource.setDriverClassName(dataSourceProperties.getDriverClassName());
        datasource.setInitialSize(dataSourceProperties.getInitialSize());
        datasource.setMinIdle(dataSourceProperties.getMinIdle());
        datasource.setMaxActive(dataSourceProperties.getMaxActive());
        datasource.setMaxWait(dataSourceProperties.getMaxWait());
        datasource.setTimeBetweenEvictionRunsMillis(dataSourceProperties.getTimeBetweenEvictionRunsMillis());
        datasource.setMinEvictableIdleTimeMillis(dataSourceProperties.getMinEvictableIdleTimeMillis());
        datasource.setValidationQuery(dataSourceProperties.getValidationQuery());
        datasource.setTestWhileIdle(dataSourceProperties.isTestWhileIdle());
        datasource.setTestOnBorrow(dataSourceProperties.isTestOnBorrow());
        datasource.setTestOnReturn(dataSourceProperties.isTestOnReturn());
        datasource.setPoolPreparedStatements(dataSourceProperties.isPoolPreparedStatements());
        try {
            datasource.setFilters(dataSourceProperties.getFilters());
        } catch (SQLException e) {
            logger.error("Druid configuration initialization filter error.", e);
        }
        return datasource;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="23" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.279</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> simplemall</a><br />
<b> <a> File: </a> </b>  <a> DruidDataSourceConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>product-service\src\main\java\com\simplemall\micro\serv\prd\config\DruidDataSourceConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.simplemall.micro.serv.prd.config;

import com.alibaba.druid.pool.DruidDataSource;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

import javax.sql.DataSource;
import java.sql.SQLException;

@Configuration
@EnableConfigurationProperties(DataSourceProperties.class)
public class DruidDataSourceConfig {

    private static Logger logger = LoggerFactory.getLogger(DruidDataSourceConfig.class);

    @Autowired
    private DataSourceProperties dataSourceProperties;

    @Bean
    @Primary
    public DataSource druidDataSource(){
        DruidDataSource datasource = new DruidDataSource();

        datasource.setUrl(dataSourceProperties.getUrl());
        datasource.setUsername(dataSourceProperties.getUsername());
        datasource.setPassword(dataSourceProperties.getPassword());
        datasource.setDriverClassName(dataSourceProperties.getDriverClassName());
        datasource.setInitialSize(dataSourceProperties.getInitialSize());
        datasource.setMinIdle(dataSourceProperties.getMinIdle());
        datasource.setMaxActive(dataSourceProperties.getMaxActive());
        datasource.setMaxWait(dataSourceProperties.getMaxWait());
        datasource.setTimeBetweenEvictionRunsMillis(dataSourceProperties.getTimeBetweenEvictionRunsMillis());
        datasource.setMinEvictableIdleTimeMillis(dataSourceProperties.getMinEvictableIdleTimeMillis());
        datasource.setValidationQuery(dataSourceProperties.getValidationQuery());
        datasource.setTestWhileIdle(dataSourceProperties.isTestWhileIdle());
        datasource.setTestOnBorrow(dataSourceProperties.isTestOnBorrow());
        datasource.setTestOnReturn(dataSourceProperties.isTestOnReturn());
        datasource.setPoolPreparedStatements(dataSourceProperties.isPoolPreparedStatements());
        try {
            datasource.setFilters(dataSourceProperties.getFilters());
        } catch (SQLException e) {
            logger.error("Druid configuration initialization filter error.", e);
        }
        return datasource;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="24" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.286</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> CartSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-cart\src\main\java\com\jerusalem\cart\config\CartSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.cart.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class CartSentinelConfig {

    public CartSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="25" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.288</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> CouponSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-coupon\src\main\java\com\jerusalem\coupon\config\CouponSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.coupon.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class CouponSentinelConfig {

    public CouponSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="26" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.289</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> GoodsSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-goods\src\main\java\com\jerusalem\goods\config\GoodsSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.goods.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class GoodsSentinelConfig {

    public GoodsSentinelConfig(){

        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="27" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.290</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> Oauth2SentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-oauth2\src\main\java\com\jerusalem\oauth2\config\Oauth2SentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.oauth2.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class Oauth2SentinelConfig {

    public Oauth2SentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="28" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.291</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> OrderSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-order\src\main\java\com\jerusalem\order\config\OrderSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.order.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class OrderSentinelConfig {

    public OrderSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="29" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.293</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> SearchSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-search\src\main\java\com\jerusalem\search\config\SearchSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.search.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class SearchSentinelConfig {

    public SearchSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="30" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.294</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> SeckillSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-seckill\src\main\java\com\jerusalem\seckill\config\SeckillSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.seckill.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class SeckillSentinelConfig {

    public SeckillSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="31" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.296</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> ThirdSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-third-services\src\main\java\com\jerusalem\third\config\ThirdSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.third.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class ThirdSentinelConfig {

    public ThirdSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="32" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.297</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> UserSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-user\src\main\java\com\jerusalem\user\config\UserSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.user.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class UserSentinelConfig {

    public UserSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="33" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.298</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> WareSentinelConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-ware\src\main\java\com\jerusalem\ware\config\WareSentinelConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.ware.config;

import com.alibaba.csp.sentinel.adapter.servlet.callback.UrlBlockHandler;
import com.alibaba.csp.sentinel.adapter.servlet.callback.WebCallbackManager;
import com.alibaba.csp.sentinel.slots.block.BlockException;
import com.alibaba.fastjson.JSON;
import com.jerusalem.common.exception.BizCodeEnume;
import com.jerusalem.common.utils.R;
import org.springframework.context.annotation.Configuration;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/****
 * @Author: jerusalem
 * @Description: SeckillSentinelConfig
 * 自定义流控响应
 * @Date 2020/11/20 16:48
 *****/
@Configuration
public class WareSentinelConfig {

    public WareSentinelConfig(){
        WebCallbackManager.setUrlBlockHandler(new UrlBlockHandler() {
            @Override
            public void blocked(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws IOException {
                R error = R.error(BizCodeEnume.TOO_MANY_REQUEST.getCode(), BizCodeEnume.TOO_MANY_REQUEST.getMsg());
                httpServletResponse.setCharacterEncoding("UTF-8");
                httpServletResponse.setContentType("application");
                httpServletResponse.getWriter().write(JSON.toJSONString(error));
            }
        });
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="34" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.302</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> WebMvcConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-account-service\src\main\java\com\wanxin\account\config\WebMvcConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.account.config;

import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.fasterxml.jackson.databind.ser.std.ToStringSerializer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import java.text.SimpleDateFormat;
import java.util.List;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@Configuration
public class WebMvcConfiguration implements WebMvcConfigurer {
    /**
     * 定义时间格式以及类型转换 转换器
     *
     * @return
     */
    @Bean
    public MappingJackson2HttpMessageConverter jackson2HttpMessageConverter() {
        MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter();
        ObjectMapper mapper = new ObjectMapper();
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));

        SimpleModule simpleModule = new SimpleModule();
        simpleModule.addSerializer(Long.class, ToStringSerializer.instance);
        simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);
        mapper.registerModule(simpleModule);

        converter.setObjectMapper(mapper);
        return converter;
    }

    /**
     * 添加转换器
     *
     * @param converters
     */
    @Override
    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        converters.add(jackson2HttpMessageConverter());
    }

    /**
     * 添加静态资源文件, 外部可以直接访问地址
     *
     * @param registry
     */
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/**").addResourceLocations("classpath:/static/");

        // 解决swagger无法访问
        registry
                .addResourceHandler("/swagger-ui.html")
                .addResourceLocations("classpath:/META-INF/resources/");
        // 解决swagger的js文件无法访问
        registry
                .addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/");
        registry
                .addResourceHandler("doc.html")
                .addResourceLocations("classpath:/META-INF/resources/");
    }
}



</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="35" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.307</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> WebMvcConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-consumer-service\src\main\java\com\wanxin\consumer\config\WebMvcConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.consumer.config;

import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.fasterxml.jackson.databind.ser.std.ToStringSerializer;
import com.wanxin.consumer.interceptor.TokenInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import java.text.SimpleDateFormat;
import java.util.List;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@Configuration
public class WebMvcConfiguration implements WebMvcConfigurer {

    /**
     * 添加自定义拦截器
     *
     * @param registry 拦截器注册对象
     */
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new TokenInterceptor()).addPathPatterns("/**");
    }

    /**
     * 定义时间格式以及类型转换 转换器
     *
     * @return
     */
    @Bean
    public MappingJackson2HttpMessageConverter jackson2HttpMessageConverter() {
        MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter();
        ObjectMapper mapper = new ObjectMapper();
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));

        SimpleModule simpleModule = new SimpleModule();
        simpleModule.addSerializer(Long.class, ToStringSerializer.instance);
        simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);
        mapper.registerModule(simpleModule);

        converter.setObjectMapper(mapper);
        return converter;
    }

    /**
     * 添加转换器
     *
     * @param converters
     */
    @Override
    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        converters.add(jackson2HttpMessageConverter());

    }

    /**
     * 添加静态资源文件, 外部可以直接访问地址
     *
     * @param registry
     */
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/**").addResourceLocations("classpath:/static/");

        // 解决swagger无法访问
        registry
                .addResourceHandler("/swagger-ui.html")
                .addResourceLocations("classpath:/META-INF/resources/");
        // 解决swagger的js文件无法访问
        registry
                .addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/");
        registry
                .addResourceHandler("doc.html")
                .addResourceLocations("classpath:/META-INF/resources/");
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="36" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.317</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> WebConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-transaction-service\src\main\java\com\wanxin\transaction\config\WebConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.transaction.config;

import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.fasterxml.jackson.databind.ser.std.ToStringSerializer;
import com.wanxin.transaction.interceptor.TokenInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import java.text.SimpleDateFormat;
import java.util.List;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@Configuration
public class WebConfig implements WebMvcConfigurer {
    /**
     * 添加自定义拦截器
     *
     * @param registry 拦截器注册对象
     */
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new TokenInterceptor()).addPathPatterns("/**");
    }

    /**
     * 定义时间格式以及类型转换 转换器
     *
     * @return
     */
    @Bean
    public MappingJackson2HttpMessageConverter jackson2HttpMessageConverter() {
        MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter();
        ObjectMapper mapper = new ObjectMapper();
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));

        SimpleModule simpleModule = new SimpleModule();
        simpleModule.addSerializer(Long.class, ToStringSerializer.instance);
        simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);
        mapper.registerModule(simpleModule);

        converter.setObjectMapper(mapper);
        return converter;
    }

    /**
     * 添加转换器
     *
     * @param converters
     */
    @Override
    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        converters.add(jackson2HttpMessageConverter());
    }

    /**
     * 添加静态资源文件, 外部可以直接访问地址
     *
     * @param registry
     */
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/**").addResourceLocations("classpath:/static/");

        // 解决swagger无法访问
        registry
                .addResourceHandler("/swagger-ui.html")
                .addResourceLocations("classpath:/META-INF/resources/");
        // 解决swagger的js文件无法访问
        registry
                .addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/");
        registry
                .addResourceHandler("doc.html")
                .addResourceLocations("classpath:/META-INF/resources/");
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="37" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.321</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> youlai</a><br />
<b> <a> File: </a> </b>  <a> SwaggerConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mall-oms\oms-boot\src\main\java\com\youlai\mall\oms\config\SwaggerConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.youlai.mall.oms.config;

import com.google.common.collect.Lists;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.OAuthBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.*;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author haoxr
 * @Date 2021-02-25 15:36
 * @Version 1.0.0
 */
@Configuration
@EnableSwagger2WebMvc
@Import(BeanValidatorPluginsConfiguration.class)
public class SwaggerConfiguration {

    @Bean
    public Docket restApi() {
        //schema
        List&lt;GrantType&gt; grantTypes=new ArrayList&lt;&gt;();
        //密码模式
        String passwordTokenUrl="http://localhost:9999/youlai-auth/oauth/token";
        ResourceOwnerPasswordCredentialsGrant resourceOwnerPasswordCredentialsGrant=new ResourceOwnerPasswordCredentialsGrant(passwordTokenUrl);
        grantTypes.add(resourceOwnerPasswordCredentialsGrant);
        OAuth oAuth=new OAuthBuilder().name("oauth2")
                .grantTypes(grantTypes).build();
        //context
        //scope方位
        List&lt;AuthorizationScope&gt; scopes=new ArrayList&lt;&gt;();
        scopes.add(new AuthorizationScope("read","read  resources"));
        scopes.add(new AuthorizationScope("write","write resources"));
        scopes.add(new AuthorizationScope("reads","read all resources"));
        scopes.add(new AuthorizationScope("writes","write all resources"));

        SecurityReference securityReference=new SecurityReference("oauth2",scopes.toArray(new AuthorizationScope[]{}));
        SecurityContext securityContext=new SecurityContext(Lists.newArrayList(securityReference),PathSelectors.ant("/**"));
        //schemas
        List&lt;SecurityScheme&gt; securitySchemes=Lists.newArrayList(oAuth);
        //securyContext
        List&lt;SecurityContext&gt; securityContexts=Lists.newArrayList(securityContext);
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.youlai.mall.oms.controller"))
                .paths(PathSelectors.any())
                .build()
                .securityContexts(securityContexts)
                .securitySchemes(securitySchemes)
                .apiInfo(apiInfo());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("订单中心")
                .description("&lt;div style='font-size:14px;color:red;'&gt;订单提交、秒杀接口&lt;/div&gt;")
                .termsOfServiceUrl("https://www.youlai.tech")
                .contact(new Contact("有来技术团队", "https://github.com/hxrui", "1490493387@qq.com"))
                .license("Open Source")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0")
                .version("1.0.0")
                .build();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="38" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.322</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> youlai</a><br />
<b> <a> File: </a> </b>  <a> SwaggerConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mall-pms\pms-boot\src\main\java\com\youlai\mall\pms\config\SwaggerConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.youlai.mall.pms.config;

import com.google.common.collect.Lists;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.OAuthBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.*;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author haoxr
 * @Date 2021-02-25 15:36
 * @Version 1.0.0
 */
@Configuration
@EnableSwagger2WebMvc
@Import(BeanValidatorPluginsConfiguration.class)
public class SwaggerConfiguration {

    @Bean
    public Docket restApi() {
        //schema
        List&lt;GrantType&gt; grantTypes=new ArrayList&lt;&gt;();
        //密码模式
        String passwordTokenUrl="http://localhost:9999/youlai-auth/oauth/token";
        ResourceOwnerPasswordCredentialsGrant resourceOwnerPasswordCredentialsGrant=new ResourceOwnerPasswordCredentialsGrant(passwordTokenUrl);
        grantTypes.add(resourceOwnerPasswordCredentialsGrant);
        OAuth oAuth=new OAuthBuilder().name("oauth2")
                .grantTypes(grantTypes).build();
        //context
        //scope方位
        List&lt;AuthorizationScope&gt; scopes=new ArrayList&lt;&gt;();
        scopes.add(new AuthorizationScope("read","read  resources"));
        scopes.add(new AuthorizationScope("write","write resources"));
        scopes.add(new AuthorizationScope("reads","read all resources"));
        scopes.add(new AuthorizationScope("writes","write all resources"));

        SecurityReference securityReference=new SecurityReference("oauth2",scopes.toArray(new AuthorizationScope[]{}));
        SecurityContext securityContext=new SecurityContext(Lists.newArrayList(securityReference),PathSelectors.ant("/**"));
        //schemas
        List&lt;SecurityScheme&gt; securitySchemes=Lists.newArrayList(oAuth);
        //securyContext
        List&lt;SecurityContext&gt; securityContexts=Lists.newArrayList(securityContext);
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.youlai.mall.pms.controller"))
                .paths(PathSelectors.any())
                .build()
                .securityContexts(securityContexts)
                .securitySchemes(securitySchemes)
                .apiInfo(apiInfo());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("商品中心")
                .description("&lt;div style='font-size:14px;color:red;'&gt;商品管理、库存、分类、品牌、规格、参数等接口&lt;/div&gt;")
                .termsOfServiceUrl("https://www.youlai.tech")
                .contact(new Contact("有来技术团队", "https://github.com/hxrui", "1490493387@qq.com"))
                .license("Open Source")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0")
                .version("1.0.0")
                .build();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="39" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.323</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> youlai</a><br />
<b> <a> File: </a> </b>  <a> SwaggerConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mall-sms\sms-boot\src\main\java\com\youlai\mall\sms\config\SwaggerConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.youlai.mall.sms.config;

import com.google.common.collect.Lists;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.OAuthBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.*;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author haoxr
 * @Date 2021-02-25 15:36
 * @Version 1.0.0
 */
@Configuration
@EnableSwagger2WebMvc
@Import(BeanValidatorPluginsConfiguration.class)
public class SwaggerConfiguration {

    @Bean
    public Docket restApi() {
        //schema
        List&lt;GrantType&gt; grantTypes=new ArrayList&lt;&gt;();
        //密码模式
        String passwordTokenUrl="http://localhost:9999/youlai-auth/oauth/token";
        ResourceOwnerPasswordCredentialsGrant resourceOwnerPasswordCredentialsGrant=new ResourceOwnerPasswordCredentialsGrant(passwordTokenUrl);
        grantTypes.add(resourceOwnerPasswordCredentialsGrant);
        OAuth oAuth=new OAuthBuilder().name("oauth2")
                .grantTypes(grantTypes).build();
        //context
        //scope方位
        List&lt;AuthorizationScope&gt; scopes=new ArrayList&lt;&gt;();
        scopes.add(new AuthorizationScope("read","read  resources"));
        scopes.add(new AuthorizationScope("write","write resources"));
        scopes.add(new AuthorizationScope("reads","read all resources"));
        scopes.add(new AuthorizationScope("writes","write all resources"));

        SecurityReference securityReference=new SecurityReference("oauth2",scopes.toArray(new AuthorizationScope[]{}));
        SecurityContext securityContext=new SecurityContext(Lists.newArrayList(securityReference),PathSelectors.ant("/**"));
        //schemas
        List&lt;SecurityScheme&gt; securitySchemes=Lists.newArrayList(oAuth);
        //securyContext
        List&lt;SecurityContext&gt; securityContexts=Lists.newArrayList(securityContext);
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.youlai.mall.sms.controller"))
                .paths(PathSelectors.any())
                .build()
                .securityContexts(securityContexts)
                .securitySchemes(securitySchemes)
                .apiInfo(apiInfo());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder().title("营销中心")
                .description("&lt;div style='font-size:14px;color:red;'&gt;首页广告接口&lt;/div&gt;")
                .termsOfServiceUrl("https://www.youlai.tech")
                .contact(new Contact("有来技术团队", "https://github.com/hxrui", "1490493387@qq.com"))
                .license("Open Source")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0")
                .version("1.0.0")
                .build();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="40" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.324</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> youlai</a><br />
<b> <a> File: </a> </b>  <a> SwaggerConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mall-ums\ums-boot\src\main\java\com\youlai\mall\ums\config\SwaggerConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.youlai.mall.ums.config;

import com.google.common.collect.Lists;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.OAuthBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.*;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author haoxr
 * @Date 2021-02-25 15:36
 * @Version 1.0.0
 */
@Configuration
@EnableSwagger2WebMvc
@Import(BeanValidatorPluginsConfiguration.class)
public class SwaggerConfiguration {


    @Bean
    public Docket restApi() {
        //schema
        List&lt;GrantType&gt; grantTypes=new ArrayList&lt;&gt;();
        //密码模式
        String passwordTokenUrl="http://localhost:9999/youlai-auth/oauth/token";
        ResourceOwnerPasswordCredentialsGrant resourceOwnerPasswordCredentialsGrant=new ResourceOwnerPasswordCredentialsGrant(passwordTokenUrl);
        grantTypes.add(resourceOwnerPasswordCredentialsGrant);
        OAuth oAuth=new OAuthBuilder().name("oauth2")
                .grantTypes(grantTypes).build();
        //context
        //scope方位
        List&lt;AuthorizationScope&gt; scopes=new ArrayList&lt;&gt;();
        scopes.add(new AuthorizationScope("read","read  resources"));
        scopes.add(new AuthorizationScope("write","write resources"));
        scopes.add(new AuthorizationScope("reads","read all resources"));
        scopes.add(new AuthorizationScope("writes","write all resources"));

        SecurityReference securityReference=new SecurityReference("oauth2",scopes.toArray(new AuthorizationScope[]{}));
        SecurityContext securityContext=new SecurityContext(Lists.newArrayList(securityReference),PathSelectors.ant("/**"));
        //schemas
        List&lt;SecurityScheme&gt; securitySchemes=Lists.newArrayList(oAuth);
        //securyContext
        List&lt;SecurityContext&gt; securityContexts=Lists.newArrayList(securityContext);
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.youlai.mall.ums.controller"))
                .paths(PathSelectors.any())
                .build()
                .securityContexts(securityContexts)
                .securitySchemes(securitySchemes)
                .apiInfo(apiInfo());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("会员中心")
                .description("&lt;div style='font-size:14px;color:red;'&gt;会员管理、地址接口&lt;/div&gt;")
                .termsOfServiceUrl("https://www.youlai.tech")
                .contact(new Contact("有来技术团队", "https://github.com/hxrui", "1490493387@qq.com"))
                .license("Open Source")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0")
                .version("1.0.0")
                .build();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="41" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.325</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> youlai</a><br />
<b> <a> File: </a> </b>  <a> SwaggerConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>youlai-admin\admin-boot\src\main\java\com\youlai\admin\config\SwaggerConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.youlai.admin.config;

import com.google.common.collect.Lists;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.OAuthBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.*;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author haoxr
 * @Date 2021-02-25 15:36
 * @Version 1.0.0
 */
@Configuration
@EnableSwagger2WebMvc
@Import(BeanValidatorPluginsConfiguration.class)
@Slf4j
public class SwaggerConfiguration {

    @Bean
    public Docket restApi() {
        //schema
        List&lt;GrantType&gt; grantTypes=new ArrayList&lt;&gt;();
        //密码模式
        String passwordTokenUrl="http://localhost:9999/youlai-auth/oauth/token";
        ResourceOwnerPasswordCredentialsGrant resourceOwnerPasswordCredentialsGrant=new ResourceOwnerPasswordCredentialsGrant(passwordTokenUrl);
        grantTypes.add(resourceOwnerPasswordCredentialsGrant);
        OAuth oAuth=new OAuthBuilder().name("oauth2")
                .grantTypes(grantTypes).build();
        //context
        //scope方位
        List&lt;AuthorizationScope&gt; scopes=new ArrayList&lt;&gt;();
        scopes.add(new AuthorizationScope("read","read  resources"));
        scopes.add(new AuthorizationScope("write","write resources"));
        scopes.add(new AuthorizationScope("reads","read all resources"));
        scopes.add(new AuthorizationScope("writes","write all resources"));

        SecurityReference securityReference=new SecurityReference("oauth2",scopes.toArray(new AuthorizationScope[]{}));
        SecurityContext securityContext=new SecurityContext(Lists.newArrayList(securityReference),PathSelectors.ant("/**"));
        //schemas
        List&lt;SecurityScheme&gt; securitySchemes=Lists.newArrayList(oAuth);
        //securyContext
        List&lt;SecurityContext&gt; securityContexts=Lists.newArrayList(securityContext);
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.youlai.admin.controller"))
                .paths(PathSelectors.any())
                .build()
                .securityContexts(securityContexts)
                .securitySchemes(securitySchemes)
                .apiInfo(apiInfo());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("系统管理")
                .description("&lt;div style='font-size:14px;color:red;'&gt;用户、角色、部门、菜单、权限、字典、客户端接口&lt;/div&gt;")
                .termsOfServiceUrl("https://www.youlai.tech")
                .contact(new Contact("有来技术团队", "https://github.com/hxrui", "1490493387@qq.com"))
                .license("Open Source")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0")
                .version("1.0.0")
                .build();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="42" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.326</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> youlai</a><br />
<b> <a> File: </a> </b>  <a> SwaggerConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>youlai-auth\src\main\java\com\youlai\auth\config\SwaggerConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.youlai.auth.config;

import com.google.common.collect.Lists;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.OAuthBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.*;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author haoxr
 * @Date 2021-02-25 15:36
 * @Version 1.0.0
 */
@Configuration
@EnableSwagger2WebMvc
public class SwaggerConfiguration {

    @Bean
    public Docket restApi() {
        //schema
        List&lt;GrantType&gt; grantTypes=new ArrayList&lt;&gt;();
        //密码模式
        String passwordTokenUrl="http://localhost:9999/youlai-auth/oauth/token";
        ResourceOwnerPasswordCredentialsGrant resourceOwnerPasswordCredentialsGrant=new ResourceOwnerPasswordCredentialsGrant(passwordTokenUrl);
        grantTypes.add(resourceOwnerPasswordCredentialsGrant);
        OAuth oAuth=new OAuthBuilder().name("oauth2")
                .grantTypes(grantTypes).build();
        //context
        //scope方位
        List&lt;AuthorizationScope&gt; scopes=new ArrayList&lt;&gt;();
        scopes.add(new AuthorizationScope("read","read  resources"));
        scopes.add(new AuthorizationScope("write","write resources"));
        scopes.add(new AuthorizationScope("reads","read all resources"));
        scopes.add(new AuthorizationScope("writes","write all resources"));

        SecurityReference securityReference=new SecurityReference("oauth2",scopes.toArray(new AuthorizationScope[]{}));
        SecurityContext securityContext=new SecurityContext(Lists.newArrayList(securityReference),PathSelectors.ant("/**"));
        //schemas
        List&lt;SecurityScheme&gt; securitySchemes=Lists.newArrayList(oAuth);
        //securyContext
        List&lt;SecurityContext&gt; securityContexts=Lists.newArrayList(securityContext);
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.youlai.auth.controller"))
                .paths(PathSelectors.any())
                .build()
                .securityContexts(securityContexts)
                .securitySchemes(securitySchemes)
                .apiInfo(apiInfo());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder().title("OAuth2认证中心")
                .description("&lt;div style='font-size:14px;color:red;'&gt;OAuth2认证、注销、获取验签公钥接口&lt;/div&gt;")
                .termsOfServiceUrl("https://www.youlai.tech")
                .contact(new Contact("有来技术团队", "https://github.com/hxrui", "1490493387@qq.com"))
                .license("Open Source")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0")
                .version("1.0.0")
                .build();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="43" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.327</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> youlai</a><br />
<b> <a> File: </a> </b>  <a> SwaggerConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>youlai-laboratory\src\main\java\com\youlai\laboratory\base\config\SwaggerConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.youlai.laboratory.base.config;

import lombok.extern.slf4j.Slf4j;

import com.google.common.collect.Lists;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.OAuthBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.*;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.service.contexts.SecurityContext;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;

import java.util.ArrayList;
import java.util.List;

/**
 * @author &lt;a href="mailto:2256222053@qq.com"&gt;zc&lt;/a&gt;
 * @data 2021/11/28 0028 11:19
 */
@Configuration
@EnableSwagger2WebMvc
@Import(BeanValidatorPluginsConfiguration.class)
@Slf4j
public class SwaggerConfiguration {
    @Bean
    public Docket restApi() {
        //schema
        List&lt;GrantType&gt; grantTypes=new ArrayList&lt;&gt;();
        //密码模式
        String passwordTokenUrl="http://localhost:9999/youlai-auth/oauth/token";
        ResourceOwnerPasswordCredentialsGrant resourceOwnerPasswordCredentialsGrant=new ResourceOwnerPasswordCredentialsGrant(passwordTokenUrl);
        grantTypes.add(resourceOwnerPasswordCredentialsGrant);
        OAuth oAuth=new OAuthBuilder().name("oauth2")
                .grantTypes(grantTypes).build();
        //context
        //scope方位
        List&lt;AuthorizationScope&gt; scopes=new ArrayList&lt;&gt;();
        scopes.add(new AuthorizationScope("read","read  resources"));
        scopes.add(new AuthorizationScope("write","write resources"));
        scopes.add(new AuthorizationScope("reads","read all resources"));
        scopes.add(new AuthorizationScope("writes","write all resources"));

        SecurityReference securityReference=new SecurityReference("oauth2",scopes.toArray(new AuthorizationScope[]{}));
        SecurityContext securityContext=new SecurityContext(Lists.newArrayList(securityReference),PathSelectors.ant("/**"));
        //schemas
        List&lt;SecurityScheme&gt; securitySchemes=Lists.newArrayList(oAuth);
        //securyContext
        List&lt;SecurityContext&gt; securityContexts=Lists.newArrayList(securityContext);
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.youlai.laboratory.**.controller"))
                .paths(PathSelectors.any())
                .build()
                .securityContexts(securityContexts)
                .securitySchemes(securitySchemes)
                .apiInfo(apiInfo());
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("系统管理")
                .description("&lt;div style='font-size:14px;color:red;'&gt;提供学习canal,elasticsearch,jvm,mybatis,mysql,netty,rabbitmq,redis,seata,sentinel,spring的环境&lt;/div&gt;")
                .termsOfServiceUrl("https://www.youlai.tech")
                .contact(new Contact("有来技术团队", "https://github.com/hxrui", "1490493387@qq.com"))
                .license("Open Source")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0")
                .version("1.0.0")
                .build();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="44" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.332</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> FEBS_Cloud</a><br />
<b> <a> File: </a> </b>  <a> FebsRouteEnhanceConfigure.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>febs-gateway\src\main\java\cc\mrbird\febs\gateway\enhance\configure\FebsRouteEnhanceConfigure.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cc.mrbird.febs.gateway.enhance.configure;

import cc.mrbird.febs.common.core.entity.constant.FebsConstant;
import cc.mrbird.febs.gateway.enhance.runner.FebsRouteEnhanceRunner;
import cc.mrbird.febs.gateway.enhance.service.BlackListService;
import cc.mrbird.febs.gateway.enhance.service.RateLimitRuleService;
import cc.mrbird.febs.gateway.enhance.service.RouteEnhanceCacheService;
import org.springframework.boot.ApplicationRunner;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.mongodb.repository.config.EnableReactiveMongoRepositories;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import java.util.concurrent.ThreadPoolExecutor;

/**
 * @author MrBird
 */
@EnableAsync
@Configuration
@EnableReactiveMongoRepositories(basePackages = "cc.mrbird.febs.gateway.enhance.mapper")
@ConditionalOnProperty(name = "febs.gateway.enhance", havingValue = "true")
public class FebsRouteEnhanceConfigure {

    @Bean(FebsConstant.ASYNC_POOL)
    public ThreadPoolTaskExecutor asyncThreadPoolTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(20);
        executor.setQueueCapacity(100);
        executor.setKeepAliveSeconds(30);
        executor.setThreadNamePrefix("Febs-Gateway-Async-Thread");
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(60);
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }

    @Bean
    public ApplicationRunner febsRouteEnhanceRunner(RouteEnhanceCacheService cacheService,
                                                    BlackListService blackListService,
                                                    RateLimitRuleService rateLimitRuleService) {
        return new FebsRouteEnhanceRunner(cacheService, blackListService, rateLimitRuleService);
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="45" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.334</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> FEBS_Cloud</a><br />
<b> <a> File: </a> </b>  <a> FebsJobConfigure.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>febs-server\febs-server-job\src\main\java\cc\mrbird\febs\server\job\configure\FebsJobConfigure.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cc.mrbird.febs.server.job.configure;

import com.baomidou.dynamic.datasource.DynamicRoutingDataSource;
import lombok.RequiredArgsConstructor;
import org.quartz.impl.StdSchedulerFactory;
import org.quartz.impl.jdbcjobstore.JobStoreTX;
import org.quartz.simpl.SimpleThreadPool;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import org.springframework.scheduling.quartz.SchedulerFactoryBean;

import javax.sql.DataSource;
import java.util.Properties;
import java.util.concurrent.ThreadPoolExecutor;

/**
 * 定时任务配置
 * http://www.quartz-scheduler.org/documentation/quartz-2.3.0/configuration/
 *
 * @author MrBird
 */
@Configuration
@RequiredArgsConstructor
public class FebsJobConfigure {

    private final DynamicRoutingDataSource dynamicRoutingDataSource;

    @Bean
    public ThreadPoolTaskExecutor scheduleJobExecutorService() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(20);
        executor.setKeepAliveSeconds(30);
        executor.setThreadNamePrefix("Febs-Job-Thread");
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(60);
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }

    @Bean
    public SchedulerFactoryBean schedulerFactoryBean() {
        SchedulerFactoryBean factory = new SchedulerFactoryBean();
        // 设置数据源
        DataSource job = dynamicRoutingDataSource.getDataSource("job");
        factory.setDataSource(job);
        Properties prop = new Properties();
        // 任务调度实例名称，集群时多个实例名称保持一致
        prop.put(StdSchedulerFactory.PROP_SCHED_INSTANCE_NAME, "FebsCloudScheduler");
        // 任务调度实例ID，指定为AUTO时，将自动生成ID
        prop.put(StdSchedulerFactory.PROP_SCHED_INSTANCE_ID, StdSchedulerFactory.AUTO_GENERATE_INSTANCE_ID);
        // quartz提供的简单线程池，适用于绝大部分场景
        prop.put(StdSchedulerFactory.PROP_THREAD_POOL_CLASS, SimpleThreadPool.class);
        // 并发执行任务的线程数，取决于服务器系统资源
        prop.put("org.quartz.threadPool.threadCount", "20");
        // 可以是Thread.MIN_PRIORITY（1）和Thread.MAX_PRIORITY（10）之间的任何int值 。
        // 默认值为Thread.NORM_PRIORITY（5）
        prop.put("org.quartz.threadPool.threadPriority", "5");
        // 指定任务存储策略，这里使用关系型数据库
        prop.put(StdSchedulerFactory.PROP_JOB_STORE_CLASS, JobStoreTX.class);
        // 是否开启集群
        prop.put("org.quartz.jobStore.isClustered", "true");
        // 集群中任务调度实例失效的检查时间间隔，单位为毫秒
        prop.put("org.quartz.jobStore.clusterCheckinInterval", "15000");
        prop.put("org.quartz.jobStore.maxMisfiresToHandleAtATime", "1");
        prop.put("org.quartz.jobStore.misfireThreshold", "12000");
        // 数据表前缀
        prop.put("org.quartz.jobStore.tablePrefix", "QRTZ_");
        factory.setQuartzProperties(prop);
        factory.setSchedulerName("FEBS_Cloud_Scheduler");
        // 延时启动
        factory.setStartupDelay(1);
        factory.setApplicationContextSchedulerContextKey("applicationContextKey");
        // 启动时更新己存在的 Job
        factory.setOverwriteExistingJobs(true);
        // 设置自动启动，默认为 true
        factory.setAutoStartup(true);
        return factory;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="46" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.335</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> FEBS_Cloud</a><br />
<b> <a> File: </a> </b>  <a> FebsWebConfigure.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>febs-server\febs-server-system\src\main\java\cc\mrbird\febs\server\system\configure\FebsWebConfigure.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cc.mrbird.febs.server.system.configure;

import cc.mrbird.febs.common.core.entity.constant.FebsConstant;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import java.util.concurrent.ThreadPoolExecutor;

/**
 * @author MrBird
 */
@Configuration
public class FebsWebConfigure {

    /**
     * 注册异步线程池
     */
    @Bean(FebsConstant.ASYNC_POOL)
    public ThreadPoolTaskExecutor asyncThreadPoolTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(20);
        executor.setQueueCapacity(100);
        executor.setKeepAliveSeconds(30);
        executor.setThreadNamePrefix("Febs-Async-Thread");
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(60);
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="47" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.340</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> light_reading</a><br />
<b> <a> File: </a> </b>  <a> MybatisConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>reading-cloud-account\src\main\java\cn\zealon\readingcloud\account\common\config\MybatisConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cn.zealon.readingcloud.account.common.config;

import com.github.pagehelper.PageHelper;
import org.apache.ibatis.plugin.Interceptor;
import org.apache.ibatis.session.SqlSessionFactory;
import org.mybatis.spring.SqlSessionFactoryBean;
import org.mybatis.spring.SqlSessionTemplate;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.core.io.support.ResourcePatternResolver;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

import javax.sql.DataSource;
import java.util.Properties;

/**
 * MyBatis配置
 * @author: zealon
 * @since: 2020/4/2
 */
@Configuration
@MapperScan(basePackages = "cn.zealon.readingcloud.account.dao",
        sqlSessionTemplateRef="accountCenterSqlSessionTemplate")
public class MybatisConfig {

    private final static String MAPPER_LOCATIONS = "classpath*:mappers/*.xml";

    /** 工厂配置 */
    @Bean
    public SqlSessionFactory sqlSessionFactoryBean(@Qualifier("accountCenterDataSource") DataSource dataSource) throws Exception {
        // 设置数据源
        SqlSessionFactoryBean factory = new SqlSessionFactoryBean();
        factory.setDataSource(dataSource);

        // 添加XML映射
        ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        factory.setMapperLocations(resolver.getResources(MAPPER_LOCATIONS));

        //添加插件
        factory.setPlugins(new Interceptor[]{ this.getPageHelper() });
        return factory.getObject();
    }

    /** 会话模板 */
    @Bean(name = "accountCenterSqlSessionTemplate")
    public SqlSessionTemplate setSqlSessionTemplate(SqlSessionFactory sqlSessionFactory) {
        return new SqlSessionTemplate(sqlSessionFactory);
    }

    /** 分页插件 */
    private PageHelper getPageHelper(){
        //配置分页插件，详情请查阅官方文档
        PageHelper pageHelper = new PageHelper();
        Properties properties = new Properties();
        //分页尺寸为0时查询所有纪录不再执行分页
        properties.setProperty("pageSizeZero", "true");
        //页码&lt;=0 查询第一页，页码&gt;=总页数查询最后一页
        properties.setProperty("reasonable", "true");
        //支持通过 Mapper 接口参数来传递分页参数
        properties.setProperty("supportMethodsArguments", "true");
        properties.setProperty("params", "count=countSql");
        //切换数据源，自动解析不同数据库的分页
        properties.setProperty("autoRuntimeDialect", "true");
        pageHelper.setProperties(properties);
        return pageHelper;
    }

    /**
     * swagger 配置类
     * http://localhost:8080/swagger-ui.html
     * @author zealon
     * @since 2019-07-04
     */
    @Configuration
    @EnableSwagger2
    public static class AccountSwaggerConfig {

        /**
         * swagger生成
         * @return Docket
         */
        @Bean
        public Docket customDocket() {
            Docket docket = new Docket(DocumentationType.SWAGGER_2)
                    .select()
                    .apis(RequestHandlerSelectors.basePackage("cn.zealon.readingcloud.account.controller"))
                    .paths(PathSelectors.any())
                    .build()
                    .apiInfo(apiInfo());
            return docket;
        }

        /**
         * swagger基础信息
         * @return ApiInfo swagger信息
         */
        private ApiInfo apiInfo() {
            return new ApiInfoBuilder()
                    .title("账户中心接口")
                    .description("账户中心")
                    .termsOfServiceUrl("")
                    .contact(new Contact("", "", ""))
                    .license("")
                    .licenseUrl("")
                    .version("1.0.0")
                    .build();
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="48" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.341</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> light_reading</a><br />
<b> <a> File: </a> </b>  <a> RedisConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>reading-cloud-account\src\main\java\cn\zealon\readingcloud\account\common\config\RedisConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cn.zealon.readingcloud.account.common.config;

import com.fasterxml.jackson.annotation.JsonAutoDetect;
import com.fasterxml.jackson.annotation.PropertyAccessor;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.cache.CacheManager;
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.cache.interceptor.KeyGenerator;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.cache.RedisCacheConfiguration;
import org.springframework.data.redis.cache.RedisCacheManager;
import org.springframework.data.redis.cache.RedisCacheWriter;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.*;

import java.lang.reflect.Method;
import java.time.Duration;

/**
 * 基础redis配置
 * @author: zealon
 * @since: 2020/4/2
 */
@EnableCaching
@Configuration
public class RedisConfig {

    @Bean
    public RedisTemplate redisTemplate(RedisConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, Object&gt; redis = new RedisTemplate&lt;&gt;();
        redis.setConnectionFactory(redisConnectionFactory);
        this.setSerializer(redis);
        return redis;
    }

    /** 配置Key的生成方式 */
    @Bean
    public KeyGenerator keyGenerator() {
        return new KeyGenerator() {
            @Override
            public Object generate(Object o, Method method, Object... objects) {
                StringBuilder stringBuilder = new StringBuilder();
                stringBuilder.append(o.getClass().getName()).append(method.getName());
                for (Object object : objects) {
                    stringBuilder.append(object.toString());
                }
                return stringBuilder.toString();
            }
        };
    }

    /** 缓存管理器 */
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) {
        //初始化一个RedisCacheWriter
        RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory);
        //设置CacheManager的值序列化方式为json序列化
        RedisSerializer&lt;Object&gt; jsonSerializer = new GenericJackson2JsonRedisSerializer();
        RedisSerializationContext.SerializationPair&lt;Object&gt; pair = RedisSerializationContext.SerializationPair.fromSerializer(jsonSerializer);
        RedisCacheConfiguration defaultCacheConfig = RedisCacheConfiguration.defaultCacheConfig().serializeValuesWith(pair);
        //设置默认超过期时间是30秒
        defaultCacheConfig = defaultCacheConfig.entryTtl(Duration.ofSeconds(300));
        //初始化RedisCacheManager
        return new RedisCacheManager(redisCacheWriter, defaultCacheConfig);
    }

    /** 设置RedisTemplate的序列化方式 */
    public void setSerializer(RedisTemplate redisTemplate) {
        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();
        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);
        //设置键（key）的序列化方式
        redisTemplate.setKeySerializer(stringRedisSerializer);
        //设置值（value）的序列化方式
        redisTemplate.setHashKeySerializer(stringRedisSerializer);
        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);
        redisTemplate.afterPropertiesSet();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="49" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.342</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> light_reading</a><br />
<b> <a> File: </a> </b>  <a> MybatisConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>reading-cloud-book\src\main\java\cn\zealon\readingcloud\book\common\config\MybatisConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cn.zealon.readingcloud.book.common.config;

import com.github.pagehelper.PageHelper;
import org.apache.ibatis.session.SqlSessionFactory;
import org.mybatis.spring.SqlSessionFactoryBean;
import org.mybatis.spring.SqlSessionTemplate;
import org.apache.ibatis.plugin.Interceptor;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.core.io.support.ResourcePatternResolver;
import javax.sql.DataSource;
import java.util.Properties;

/**
 * MyBatis配置
 * @author: zealon
 * @since: 2020/4/2
 */
@Configuration
@MapperScan(basePackages = "cn.zealon.readingcloud.book.dao",
        sqlSessionTemplateRef="bookCenterSqlSessionTemplate")
public class MybatisConfig {

    private final static String MAPPER_LOCATIONS = "classpath*:mappers/*.xml";

    /** 工厂配置 */
    @Bean
    public SqlSessionFactory sqlSessionFactoryBean(@Qualifier("bookCenterDataSource") DataSource dataSource) throws Exception {
        // 设置数据源
        SqlSessionFactoryBean factory = new SqlSessionFactoryBean();
        factory.setDataSource(dataSource);

        // 添加XML映射
        ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        factory.setMapperLocations(resolver.getResources(MAPPER_LOCATIONS));

        //添加插件
        factory.setPlugins(new Interceptor[]{ this.getPageHelper() });
        return factory.getObject();
    }

    /** 会话模板 */
    @Bean(name = "bookCenterSqlSessionTemplate")
    public SqlSessionTemplate setSqlSessionTemplate(SqlSessionFactory sqlSessionFactory) {
        return new SqlSessionTemplate(sqlSessionFactory);
    }

    /** 分页插件 */
    private PageHelper getPageHelper(){
        //配置分页插件，详情请查阅官方文档
        PageHelper pageHelper = new PageHelper();
        Properties properties = new Properties();
        //分页尺寸为0时查询所有纪录不再执行分页
        properties.setProperty("pageSizeZero", "true");
        //页码&lt;=0 查询第一页，页码&gt;=总页数查询最后一页
        properties.setProperty("reasonable", "true");
        //支持通过 Mapper 接口参数来传递分页参数
        properties.setProperty("supportMethodsArguments", "true");
        properties.setProperty("params", "count=countSql");
        //切换数据源，自动解析不同数据库的分页
        properties.setProperty("autoRuntimeDialect", "true");
        pageHelper.setProperties(properties);
        return pageHelper;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="50" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.343</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> light_reading</a><br />
<b> <a> File: </a> </b>  <a> RedisConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>reading-cloud-book\src\main\java\cn\zealon\readingcloud\book\common\config\RedisConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cn.zealon.readingcloud.book.common.config;

import com.fasterxml.jackson.annotation.JsonAutoDetect;
import com.fasterxml.jackson.annotation.PropertyAccessor;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.cache.CacheManager;
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.cache.interceptor.KeyGenerator;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.cache.RedisCacheConfiguration;
import org.springframework.data.redis.cache.RedisCacheManager;
import org.springframework.data.redis.cache.RedisCacheWriter;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.*;
import java.lang.reflect.Method;
import java.time.Duration;

/**
 * 基础redis配置
 * @author: zealon
 * @since: 2020/4/2
 */
@EnableCaching
@Configuration
public class RedisConfig {

    @Bean
    public RedisTemplate redisTemplate(RedisConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, Object&gt; redis = new RedisTemplate&lt;&gt;();
        redis.setConnectionFactory(redisConnectionFactory);
        this.setSerializer(redis);
        return redis;
    }

    /** 配置Key的生成方式 */
    @Bean
    public KeyGenerator keyGenerator() {
        return new KeyGenerator() {
            @Override
            public Object generate(Object o, Method method, Object... objects) {
                StringBuilder stringBuilder = new StringBuilder();
                stringBuilder.append(o.getClass().getName()).append(method.getName());
                for (Object object : objects) {
                    stringBuilder.append(object.toString());
                }
                return stringBuilder.toString();
            }
        };
    }

    /** 缓存管理器 */
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) {
        //初始化一个RedisCacheWriter
        RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory);
        //设置CacheManager的值序列化方式为json序列化
        RedisSerializer&lt;Object&gt; jsonSerializer = new GenericJackson2JsonRedisSerializer();
        RedisSerializationContext.SerializationPair&lt;Object&gt; pair = RedisSerializationContext.SerializationPair.fromSerializer(jsonSerializer);
        RedisCacheConfiguration defaultCacheConfig = RedisCacheConfiguration.defaultCacheConfig().serializeValuesWith(pair);
        //设置默认超过期时间是30秒
        defaultCacheConfig = defaultCacheConfig.entryTtl(Duration.ofSeconds(300));
        //初始化RedisCacheManager
        return new RedisCacheManager(redisCacheWriter, defaultCacheConfig);
    }

    /** 设置RedisTemplate的序列化方式 */
    public void setSerializer(RedisTemplate redisTemplate) {
        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();
        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);
        //设置键（key）的序列化方式
        redisTemplate.setKeySerializer(stringRedisSerializer);
        //设置值（value）的序列化方式
        redisTemplate.setHashKeySerializer(stringRedisSerializer);
        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);
        redisTemplate.afterPropertiesSet();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="51" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.347</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> MateResourceServerConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-core\mate-starter-security\src\main\java\vip\mate\core\security\config\MateResourceServerConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package vip.mate.core.security.config;

import lombok.RequiredArgsConstructor;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration;
import org.springframework.context.annotation.Bean;
import org.springframework.core.annotation.Order;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configurers.ExpressionUrlAuthorizationConfigurer;
import org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer;
import org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter;
import org.springframework.security.oauth2.config.annotation.web.configurers.ResourceServerSecurityConfigurer;
import org.springframework.security.oauth2.provider.token.store.redis.RedisTokenStore;
import vip.mate.core.security.handle.MateAccessDeniedHandler;
import vip.mate.core.security.handle.MateAuthenticationEntryPoint;

/**
 * 资源服务配置
 *
 * @author pangu
 */
@Order(5)
@EnableResourceServer
@RequiredArgsConstructor
@EnableAutoConfiguration(exclude = UserDetailsServiceAutoConfiguration.class)
public class MateResourceServerConfig extends ResourceServerConfigurerAdapter {

	private final IgnoreUrlPropsConfiguration ignoreUrlPropsConfig;

	private final RedisConnectionFactory redisConnectionFactory;

	/**
	 * 配置token存储到redis中
	 */
	@Bean
	public RedisTokenStore redisTokenStore() {
		return new RedisTokenStore(redisConnectionFactory);
	}

	@Override
	public void configure(HttpSecurity http) throws Exception {
		ExpressionUrlAuthorizationConfigurer&lt;HttpSecurity&gt;.ExpressionInterceptUrlRegistry config
				= http.requestMatchers().anyRequest()
				.and()
				.authorizeRequests();
		ignoreUrlPropsConfig.getUrls().forEach(url -&gt; {
			config.antMatchers(url).permitAll();
		});
		ignoreUrlPropsConfig.getIgnoreSecurity().forEach(url -&gt; {
			config.antMatchers(url).permitAll();
		});
		config
				//任何请求
				.anyRequest()
				//都需要身份认证
				.authenticated()
				//csrf跨站请求
				.and()
				.csrf().disable();
	}

	@Override
	public void configure(ResourceServerSecurityConfigurer resources) throws Exception {
		resources.authenticationEntryPoint(new MateAuthenticationEntryPoint())
				.accessDeniedHandler(new MateAccessDeniedHandler());
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="52" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.351</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> SecurityConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-uaa\src\main\java\vip\mate\uaa\config\SecurityConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
/*
 * Copyright 2019-2028 Beijing Daotiandi Technology Co., Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * Author: xuzhanfu (7333791@qq.com)
 */
package vip.mate.uaa.config;

import lombok.SneakyThrows;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.core.annotation.Order;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.annotation.web.configurers.ExpressionUrlAuthorizationConfigurer;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.factory.PasswordEncoderFactories;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.authentication.AuthenticationFailureHandler;
import org.springframework.security.web.authentication.AuthenticationSuccessHandler;
import vip.mate.core.security.config.IgnoreUrlPropsConfiguration;
import vip.mate.core.security.handle.MateAuthenticationFailureHandler;
import vip.mate.core.security.handle.MateAuthenticationSuccessHandler;
import vip.mate.uaa.service.impl.UserDetailsServiceImpl;
import vip.mate.uaa.sms.SmsCodeAuthenticationSecurityConfig;
import vip.mate.uaa.social.SocialAuthenticationSecurityConfig;

import javax.annotation.Resource;

/**
 * 安全配置中心
 *
 * @author xuzhanfu
 * @date 2019-10-11 23:25
 **/
@Order(3)
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

	@Autowired
	private IgnoreUrlPropsConfiguration ignoreUrlPropsConfig;

	@Bean
	public PasswordEncoder passwordEncoder() {
		return PasswordEncoderFactories.createDelegatingPasswordEncoder();
	}

	@Resource
	private SmsCodeAuthenticationSecurityConfig smsCodeAuthenticationSecurityConfig;

	@Resource
	private SocialAuthenticationSecurityConfig socialAuthenticationSecurityConfig;

	/**
	 * 必须要定义，否则不支持grant_type=password模式
	 *
	 * @return AuthenticationManager
	 */
	@Bean
	@Override
	@SneakyThrows
	public AuthenticationManager authenticationManagerBean() {
		return super.authenticationManagerBean();
	}

	@Bean
	public AuthenticationSuccessHandler mateAuthenticationSuccessHandler() {
		return new MateAuthenticationSuccessHandler();
	}

	@Bean
	public AuthenticationFailureHandler mateAuthenticationFailureHandler() {
		return new MateAuthenticationFailureHandler();
	}

	@Override
	@Bean
	public UserDetailsService userDetailsService() {
		return new UserDetailsServiceImpl();
	}

	@Override
	protected void configure(HttpSecurity http) throws Exception {
		ExpressionUrlAuthorizationConfigurer&lt;HttpSecurity&gt;.ExpressionInterceptUrlRegistry config
				= http.requestMatchers().anyRequest()
				.and()
				.formLogin()
				.and()
				.apply(smsCodeAuthenticationSecurityConfig)
				.and()
				.apply(socialAuthenticationSecurityConfig)
				.and()
				.authorizeRequests();
		ignoreUrlPropsConfig.getUrls().forEach(url -&gt; {
			config.antMatchers(url).permitAll();
		});
		ignoreUrlPropsConfig.getIgnoreSecurity().forEach(url -&gt; {
			config.antMatchers(url).permitAll();
		});
		config
				//任何请求
				.anyRequest()
				//都需要身份认证
				.authenticated()
				//csrf跨站请求
				.and()
				.csrf().disable();
	}

	@Override
	protected void configure(AuthenticationManagerBuilder auth) throws Exception {
		auth.
				userDetailsService(userDetailsService())
				.passwordEncoder(passwordEncoder());
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="53" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.367</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> JwtConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_blog\src\main\java\com\fly\blog\config\JwtConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.blog.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.ClassPathResource;
import org.springframework.core.io.Resource;
import org.springframework.security.oauth2.provider.token.TokenStore;
import org.springframework.security.oauth2.provider.token.store.JwtAccessTokenConverter;
import org.springframework.security.oauth2.provider.token.store.JwtTokenStore;
import org.springframework.util.FileCopyUtils;

import java.io.IOException;

/**
 * Description: &lt;JwtConfiguration&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
@Configuration
public class JwtConfiguration {
    @Autowired
    JwtAccessTokenConverter jwtAccessTokenConverter;

    @Bean
    @Qualifier("tokenStore")
    public TokenStore tokenStore() {

        System.out.println("Created JwtTokenStore");
        return new JwtTokenStore(jwtAccessTokenConverter);
    }

    @Bean
    protected JwtAccessTokenConverter jwtTokenEnhancer() {
        JwtAccessTokenConverter converter =  new JwtAccessTokenConverter();
        Resource resource = new ClassPathResource("public.cert");
        String publicKey ;
        try {
            publicKey = new String(FileCopyUtils.copyToByteArray(resource.getInputStream()));
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        converter.setVerifierKey(publicKey);
        return converter;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="54" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.371</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> JwtConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_news\src\main\java\com\fly\news\config\JwtConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.news.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.ClassPathResource;
import org.springframework.core.io.Resource;
import org.springframework.security.oauth2.provider.token.TokenStore;
import org.springframework.security.oauth2.provider.token.store.JwtAccessTokenConverter;
import org.springframework.security.oauth2.provider.token.store.JwtTokenStore;
import org.springframework.util.FileCopyUtils;

import java.io.IOException;

/**
 * Description: &lt;JwtConfiguration&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
@Configuration
public class JwtConfiguration {
    @Autowired
    JwtAccessTokenConverter jwtAccessTokenConverter;

    @Bean
    @Qualifier("tokenStore")
    public TokenStore tokenStore() {

        System.out.println("Created JwtTokenStore");
        return new JwtTokenStore(jwtAccessTokenConverter);
    }

    @Bean
    protected JwtAccessTokenConverter jwtTokenEnhancer() {
        JwtAccessTokenConverter converter =  new JwtAccessTokenConverter();
        Resource resource = new ClassPathResource("public.cert");
        String publicKey ;
        try {
            publicKey = new String(FileCopyUtils.copyToByteArray(resource.getInputStream()));
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        converter.setVerifierKey(publicKey);
        return converter;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="55" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.375</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> JwtConfiguration.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_user\src\main\java\com\fly\user\config\JwtConfiguration.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.user.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.ClassPathResource;
import org.springframework.core.io.Resource;
import org.springframework.security.oauth2.provider.token.TokenStore;
import org.springframework.security.oauth2.provider.token.store.JwtAccessTokenConverter;
import org.springframework.security.oauth2.provider.token.store.JwtTokenStore;
import org.springframework.util.FileCopyUtils;

import java.io.IOException;

/**
 * Description: &lt;JwtConfiguration&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
@Configuration
public class JwtConfiguration {
    @Autowired
    JwtAccessTokenConverter jwtAccessTokenConverter;

    @Bean
    @Qualifier("tokenStore")
    public TokenStore tokenStore() {

        System.out.println("Created JwtTokenStore");
        return new JwtTokenStore(jwtAccessTokenConverter);
    }

    @Bean
    protected JwtAccessTokenConverter jwtTokenEnhancer() {
        JwtAccessTokenConverter converter =  new JwtAccessTokenConverter();
        Resource resource = new ClassPathResource("public.cert");
        String publicKey ;
        try {
            publicKey = new String(FileCopyUtils.copyToByteArray(resource.getInputStream()));
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        converter.setVerifierKey(publicKey);
        return converter;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="56" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.378</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> staffjoy</a><br />
<b> <a> File: </a> </b>  <a> AppConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>account-svc\src\main\java\xyz\staffjoy\account\config\AppConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package xyz.staffjoy.account.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import xyz.staffjoy.common.async.ContextCopyingDecorator;
import xyz.staffjoy.common.config.StaffjoyRestConfig;

import java.util.concurrent.Executor;

@Configuration
@EnableAsync
@Import(value = {StaffjoyRestConfig.class})
@SuppressWarnings(value = "Duplicates")
public class AppConfig {

    public static final String ASYNC_EXECUTOR_NAME = "asyncExecutor";

    @Bean(name=ASYNC_EXECUTOR_NAME)
    public Executor asyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        // for passing in request scope context
        executor.setTaskDecorator(new ContextCopyingDecorator());
        executor.setCorePoolSize(3);
        executor.setMaxPoolSize(5);
        executor.setQueueCapacity(100);
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setThreadNamePrefix("AsyncThread-");
        executor.initialize();
        return executor;
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="57" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.379</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> staffjoy</a><br />
<b> <a> File: </a> </b>  <a> TestConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>account-svc\src\test\java\xyz\staffjoy\account\TestConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package xyz.staffjoy.account;

import feign.RequestInterceptor;
import feign.RequestTemplate;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.util.StringUtils;
import xyz.staffjoy.common.auth.AuthConstant;

import java.util.UUID;

/**
 * Pass CURRENT_USER_HEADER via Feign for testing
 */
@Configuration
public class TestConfig {

    public static String TEST_USER_ID = UUID.randomUUID().toString();

    @Bean
    public RequestInterceptor requestInterceptor() {
        return new RequestInterceptor() {
            @Override
            public void apply(RequestTemplate template) {
                if (!StringUtils.isEmpty(TEST_USER_ID)) {
                    template.header(AuthConstant.CURRENT_USER_HEADER, TEST_USER_ID);
                }
            }
        };
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="58" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.380</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> staffjoy</a><br />
<b> <a> File: </a> </b>  <a> AppConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>bot-svc\src\main\java\xyz\staffjoy\bot\config\AppConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package xyz.staffjoy.bot.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import xyz.staffjoy.common.async.ContextCopyingDecorator;
import xyz.staffjoy.common.config.StaffjoyRestConfig;

import java.util.concurrent.Executor;

@Configuration
@EnableAsync
@Import(value = {StaffjoyRestConfig.class})
@SuppressWarnings(value = "Duplicates")
public class AppConfig {
    public static final String ASYNC_EXECUTOR_NAME = "asyncExecutor";

    @Bean(name=ASYNC_EXECUTOR_NAME)
    public Executor asyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setTaskDecorator(new ContextCopyingDecorator());
        executor.setCorePoolSize(3);
        executor.setMaxPoolSize(5);
        executor.setQueueCapacity(100);
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setThreadNamePrefix("AsyncThread-");
        executor.initialize();
        return executor;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="59" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.381</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> staffjoy</a><br />
<b> <a> File: </a> </b>  <a> AppConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>company-svc\src\main\java\xyz\staffjoy\company\config\AppConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package xyz.staffjoy.company.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import xyz.staffjoy.common.async.ContextCopyingDecorator;
import xyz.staffjoy.common.config.StaffjoyRestConfig;

import java.util.concurrent.Executor;

@Configuration
@EnableAsync
@Import(value = {StaffjoyRestConfig.class})
@SuppressWarnings(value = "Duplicates")
public class AppConfig {

    public static final String ASYNC_EXECUTOR_NAME = "asyncExecutor";

    @Bean(name=ASYNC_EXECUTOR_NAME)
    public Executor asyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        // for passing in request scope context
        executor.setTaskDecorator(new ContextCopyingDecorator());
        executor.setCorePoolSize(3);
        executor.setMaxPoolSize(5);
        executor.setQueueCapacity(100);
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setThreadNamePrefix("AsyncThread-");
        executor.initialize();
        return executor;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="60" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.382</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> staffjoy</a><br />
<b> <a> File: </a> </b>  <a> TestConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>company-svc\src\test\java\xyz\staffjoy\company\TestConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package xyz.staffjoy.company;

import feign.RequestInterceptor;
import feign.RequestTemplate;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.util.StringUtils;
import xyz.staffjoy.common.auth.AuthConstant;

import java.util.UUID;

/**
 * Pass CURRENT_USER_HEADER via Feign for testing
 */
@Configuration
public class TestConfig {

    public static String TEST_USER_ID = UUID.randomUUID().toString();

    @Bean
    public RequestInterceptor requestInterceptor() {
        return new RequestInterceptor() {
            @Override
            public void apply(RequestTemplate template) {
                if (!StringUtils.isEmpty(TEST_USER_ID)) {
                    template.header(AuthConstant.CURRENT_USER_HEADER, TEST_USER_ID);
                }
            }
        };
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="61" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.383</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> staffjoy</a><br />
<b> <a> File: </a> </b>  <a> AppConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mail-svc\src\main\java\xyz\staffjoy\mail\config\AppConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package xyz.staffjoy.mail.config;

import com.aliyuncs.DefaultAcsClient;
import com.aliyuncs.IAcsClient;
import com.aliyuncs.profile.DefaultProfile;
import com.aliyuncs.profile.IClientProfile;
import org.springframework.context.annotation.Import;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import xyz.staffjoy.common.config.StaffjoyRestConfig;
import xyz.staffjoy.mail.MailConstant;
import xyz.staffjoy.mail.props.AppProps;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.EnableAsync;

import java.util.concurrent.Executor;

@Configuration
@EnableAsync
@Import(value = StaffjoyRestConfig.class)
@SuppressWarnings(value = "Duplicates")
public class AppConfig {

    public static final String ASYNC_EXECUTOR_NAME = "asyncExecutor";

    @Autowired
    AppProps appProps;

    @Bean
    public IAcsClient acsClient() {
        IClientProfile profile = DefaultProfile.getProfile(MailConstant.ALIYUN_REGION_ID,
                appProps.getAliyunAccessKey(), appProps.getAliyunAccessSecret());
        IAcsClient client = new DefaultAcsClient(profile);
        return client;
    }

    @Bean(name=ASYNC_EXECUTOR_NAME)
    public Executor asyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(3);
        executor.setMaxPoolSize(5);
        executor.setQueueCapacity(100);
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setThreadNamePrefix("AsyncThread-");
        executor.initialize();
        return executor;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="62" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.384</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> staffjoy</a><br />
<b> <a> File: </a> </b>  <a> TestConfig.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Config File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>whoami-svc\src\test\java\xyz\staffjoy\whoami\TestConfig.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package xyz.staffjoy.whoami;

import feign.RequestInterceptor;
import feign.RequestTemplate;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.util.StringUtils;
import xyz.staffjoy.common.auth.AuthConstant;

/**
 * Pass CURRENT_USER_HEADER via Feign for testing
 */
@Configuration
public class TestConfig {

    public static String TEST_USER_ID = "";

    @Bean
    public RequestInterceptor requestInterceptor() {
        return new RequestInterceptor() {
            @Override
            public void apply(RequestTemplate template) {
                if (!StringUtils.isEmpty(TEST_USER_ID)) {
                    template.header(AuthConstant.CURRENT_USER_HEADER, TEST_USER_ID);
                }
            }
        };
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>



                        <div>
                            <div id="divpager-1"></div>
                        </div>

                    </div>
                    <div class="layui-tab-item">
<div class="layui-card" id="63" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.256</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> ExceptionHandle.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-message\src\main\java\com\stalary\pf\message\exception\ExceptionHandle.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.stalary.pf.message.exception;

import com.stalary.pf.message.data.vo.ResponseMessage;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import java.io.PrintWriter;
import java.io.StringWriter;

/**
 * @author Stalary
 * @description
 * @date 2018/04/14
 */
@ControllerAdvice
@Slf4j
public class ExceptionHandle {

    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public ResponseMessage handle(Exception e) {
        if (e instanceof MyException) {
            MyException myException = (MyException) e;
            return ResponseMessage.error(myException.getCode(), myException.getMessage());
        } else {
            log.error("[系统异常]", e);
            StringWriter sw = new StringWriter();
            e.printStackTrace(new PrintWriter(sw));
            return ResponseMessage.error(500, "message 运行时异常！" + sw.toString());
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="64" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.259</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> ExceptionHandle.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-outside\src\main\java\com\stalary\pf\outside\exception\ExceptionHandle.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.stalary.pf.outside.exception;

import com.stalary.pf.outside.data.ResponseMessage;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import java.io.PrintWriter;
import java.io.StringWriter;

/**
 * @author Stalary
 * @description
 * @date 2018/04/14
 */
@ControllerAdvice
@Slf4j
public class ExceptionHandle {

    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public ResponseMessage handle(Exception e) {
        if (e instanceof MyException) {
            MyException myException = (MyException) e;
            return ResponseMessage.error(myException.getCode(), myException.getMessage());
        } else {
            log.error("[系统异常]", e);
            StringWriter sw = new StringWriter();
            e.printStackTrace(new PrintWriter(sw));
            return ResponseMessage.error(500, "outside 运行时异常！" + sw.toString());
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="65" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.264</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> ExceptionHandle.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-recruit\src\main\java\com\stalary\pf\recruit\exception\ExceptionHandle.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.stalary.pf.recruit.exception;

import com.stalary.pf.recruit.data.vo.ResponseMessage;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import java.io.PrintWriter;
import java.io.StringWriter;

/**
 * @author Stalary
 * @description
 * @date 2018/04/14
 */
@ControllerAdvice
@Slf4j
public class ExceptionHandle {

    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public ResponseMessage handle(Exception e) {
        if (e instanceof MyException) {
            MyException myException = (MyException) e;
            return ResponseMessage.error(myException.getCode(), myException.getMessage());
        } else {
            log.error("[系统异常]", e);
            StringWriter sw = new StringWriter();
            e.printStackTrace(new PrintWriter(sw));
            return ResponseMessage.error(500, "recruit 运行时异常！" + sw.toString());
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="66" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.267</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> ExceptionHandle.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-resume\src\main\java\com\stalary\pf\resume\exception\ExceptionHandle.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.stalary.pf.resume.exception;

import com.stalary.pf.resume.data.vo.ResponseMessage;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import java.io.PrintWriter;
import java.io.StringWriter;

/**
 * @author Stalary
 * @description
 * @date 2018/04/14
 */
@ControllerAdvice
@Slf4j
public class ExceptionHandle {

    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public ResponseMessage handle(Exception e) {
        if (e instanceof MyException) {
            MyException myException = (MyException) e;
            return ResponseMessage.error(myException.getCode(), myException.getMessage());
        } else {
            log.error("[系统异常]", e);
            StringWriter sw = new StringWriter();
            e.printStackTrace(new PrintWriter(sw));
            return ResponseMessage.error(500, "resume 运行时异常！" + sw.toString());
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="67" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.270</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> recruit</a><br />
<b> <a> File: </a> </b>  <a> ExceptionHandle.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pf-user\src\main\java\com\stalary\pf\user\exception\ExceptionHandle.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.stalary.pf.user.exception;

import com.stalary.pf.user.data.vo.ResponseMessage;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import java.io.PrintWriter;
import java.io.StringWriter;

/**
 * @author Stalary
 * @description
 * @date 2018/04/14
 */
@ControllerAdvice
@Slf4j
public class ExceptionHandle {

    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public ResponseMessage handle(Exception e) {
        if (e instanceof MyException) {
            MyException myException = (MyException) e;
            return ResponseMessage.error(myException.getCode(), myException.getMessage());
        } else {
            log.error("[系统异常]", e);
            StringWriter sw = new StringWriter();
            e.printStackTrace(new PrintWriter(sw));
            return ResponseMessage.error(500, "user 运行时异常！" + sw.toString());
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="68" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.301</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> GlobalExceptionHandler.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-account-service\src\main\java\com\wanxin\account\common\GlobalExceptionHandler.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.account.common;

import com.wanxin.common.domain.BusinessException;
import com.wanxin.common.domain.CommonErrorCode;
import com.wanxin.common.domain.RestResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.lang.Nullable;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.servlet.NoHandlerFoundException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(value = Exception.class)
    public RestResponse&lt;Nullable&gt; exceptionGet(HttpServletRequest req, HttpServletResponse response, Exception e) {
        if (e instanceof BusinessException) {
            BusinessException be = (BusinessException) e;
            if (CommonErrorCode.CUSTOM.equals(be.getErrorCode())) {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getMessage());
            } else {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getErrorCode().getDesc());
            }

        } else if (e instanceof NoHandlerFoundException) {
            return new RestResponse&lt;Nullable&gt;(404, "找不到资源");
        } else if (e instanceof HttpRequestMethodNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(405, "method 方法不支持");
        } else if (e instanceof HttpMediaTypeNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(415, "不支持媒体类型");
        }

        log.error("[系统异常]-" + e.getMessage());
        return new RestResponse&lt;Nullable&gt;(CommonErrorCode.UNKOWN.getCode(), CommonErrorCode.UNKOWN.getDesc());
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="69" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.305</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> GlobalExceptionHandler.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-consumer-service\src\main\java\com\wanxin\consumer\common\GlobalExceptionHandler.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.consumer.common;

import com.wanxin.common.domain.BusinessException;
import com.wanxin.common.domain.CommonErrorCode;
import com.wanxin.common.domain.RestResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.lang.Nullable;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.NoHandlerFoundException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@Slf4j
@ControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public RestResponse&lt;Nullable&gt; exceptionGet(HttpServletRequest req, HttpServletResponse response, Exception e) {
        if (e instanceof BusinessException) {
            BusinessException be = (BusinessException) e;
            if (CommonErrorCode.CUSTOM.equals(be.getErrorCode())) {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getMessage());
            } else {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getErrorCode().getDesc());
            }

        } else if (e instanceof NoHandlerFoundException) {
            return new RestResponse&lt;Nullable&gt;(404, "找不到资源");
        } else if (e instanceof HttpRequestMethodNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(405, "method 方法不支持");
        } else if (e instanceof HttpMediaTypeNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(415, "不支持媒体类型");
        }

        log.error("[系统异常]-" + e.getMessage());
        return new RestResponse&lt;Nullable&gt;(CommonErrorCode.UNKOWN.getCode(), CommonErrorCode.UNKOWN.getDesc());
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="70" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.311</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> GlobalExceptionHandler.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-content-search-service\src\main\java\com\wanxin\search\common\intercept\GlobalExceptionHandler.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.search.common.intercept;

import com.wanxin.common.domain.BusinessException;
import com.wanxin.common.domain.CommonErrorCode;
import com.wanxin.common.domain.RestResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.lang.Nullable;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.NoHandlerFoundException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@ControllerAdvice
public class GlobalExceptionHandler {

    private final static Logger LOGGER = LoggerFactory.getLogger(GlobalExceptionHandler.class);

    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public RestResponse&lt;Nullable&gt; exceptionGet(HttpServletRequest req, HttpServletResponse response, Exception e) {
        if (e instanceof BusinessException) {
            BusinessException be = (BusinessException) e;
            if (CommonErrorCode.CUSTOM.equals(be.getErrorCode())) {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getMessage());
            } else {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getErrorCode().getDesc());
            }

        } else if (e instanceof NoHandlerFoundException) {
            return new RestResponse&lt;Nullable&gt;(404, "找不到资源");
        } else if (e instanceof HttpRequestMethodNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(405, "method 方法不支持");
        } else if (e instanceof HttpMediaTypeNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(415, "不支持媒体类型");
        }

        LOGGER.error("[系统异常]-{}", e);
        return new RestResponse&lt;Nullable&gt;(CommonErrorCode.UNKOWN.getCode(), CommonErrorCode.UNKOWN.getDesc());
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="71" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.312</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> GlobalExceptionHandler.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-depository-agent-service\src\main\java\com\wanxin\depository\common\intercept\GlobalExceptionHandler.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.depository.common.intercept;

import com.wanxin.common.domain.BusinessException;
import com.wanxin.common.domain.CommonErrorCode;
import com.wanxin.common.domain.RestResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.lang.Nullable;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.servlet.NoHandlerFoundException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @author yuelimin
 * @since 1.8
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(value = Exception.class)
    public RestResponse&lt;Nullable&gt; exceptionGet(HttpServletRequest req, HttpServletResponse response, Exception e) {
        if (e instanceof BusinessException) {
            BusinessException be = (BusinessException) e;
            if (CommonErrorCode.CUSTOM.equals(be.getErrorCode())) {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getMessage());
            } else {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getErrorCode().getDesc());
            }

        } else if (e instanceof NoHandlerFoundException) {
            return new RestResponse&lt;Nullable&gt;(404, "找不到资源");
        } else if (e instanceof HttpRequestMethodNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(405, "method 方法不支持");
        } else if (e instanceof HttpMediaTypeNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(415, "不支持媒体类型");
        }
        log.error("[系统异常]-{}", e);
        return new RestResponse&lt;Nullable&gt;(CommonErrorCode.UNKOWN.getCode(), CommonErrorCode.UNKOWN.getDesc());
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="72" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.315</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> GlobalExceptionHandler.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-transaction-service\src\main\java\com\wanxin\transaction\common\intercept\GlobalExceptionHandler.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.transaction.common.intercept;

import com.wanxin.common.domain.BusinessException;
import com.wanxin.common.domain.CommonErrorCode;
import com.wanxin.common.domain.RestResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.lang.Nullable;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.servlet.NoHandlerFoundException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(value = Exception.class)
    public RestResponse&lt;Nullable&gt; exceptionGet(HttpServletRequest req, HttpServletResponse response, Exception e) {
        if (e instanceof BusinessException) {
            BusinessException be = (BusinessException) e;
            if (CommonErrorCode.CUSTOM.equals(be.getErrorCode())) {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getMessage());
            } else {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getErrorCode().getDesc());
            }

        } else if (e instanceof NoHandlerFoundException) {
            return new RestResponse&lt;Nullable&gt;(404, "找不到资源");
        } else if (e instanceof HttpRequestMethodNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(405, "method 方法不支持");
        } else if (e instanceof HttpMediaTypeNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(415, "不支持媒体类型");
        }

        log.error("[系统异常]-{}", e);
        return new RestResponse&lt;Nullable&gt;(CommonErrorCode.UNKOWN.getCode(), CommonErrorCode.UNKOWN.getDesc());
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="73" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.319</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> GlobalExceptionHandler.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Exception Handling File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-uaa-service\src\main\java\com\wanxin\uaa\common\intercept\GlobalExceptionHandler.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.uaa.common.intercept;

import com.wanxin.common.domain.BusinessException;
import com.wanxin.common.domain.CommonErrorCode;
import com.wanxin.common.domain.RestResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.lang.Nullable;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.servlet.NoHandlerFoundException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
@RestControllerAdvice
public class GlobalExceptionHandler {

    private final static Logger LOGGER = LoggerFactory.getLogger(GlobalExceptionHandler.class);

    @ExceptionHandler(value = Exception.class)
    public RestResponse&lt;Nullable&gt; exceptionGet(HttpServletRequest req, HttpServletResponse response, Exception e) {
        if (e instanceof BusinessException) {
            BusinessException be = (BusinessException) e;
            if (CommonErrorCode.CUSTOM.equals(be.getErrorCode())) {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getMessage());
            } else {
                return new RestResponse&lt;Nullable&gt;(be.getErrorCode().getCode(), be.getErrorCode().getDesc());
            }

        } else if (e instanceof NoHandlerFoundException) {
            return new RestResponse&lt;Nullable&gt;(404, "找不到资源");
        } else if (e instanceof HttpRequestMethodNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(405, "method 方法不支持");
        } else if (e instanceof AccessDeniedException) {
            return new RestResponse&lt;Nullable&gt;(304, "没有权限访问");
        } else if (e instanceof HttpMediaTypeNotSupportedException) {
            return new RestResponse&lt;Nullable&gt;(415, "不支持媒体类型");
        }

        LOGGER.error("[系统异常]-{0}", e);
        return new RestResponse&lt;Nullable&gt;(CommonErrorCode.UNKOWN.getCode(), CommonErrorCode.UNKOWN.getDesc());
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>



                        <div>
                            <div id="divpager-2"></div>
                        </div>
                    </div>
                    <div class="layui-tab-item">

<div class="layui-card" id="74" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.299</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> train-ticket</a><br />
<b> <a> File: </a> </b>  <a> CookieUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>ts-inside-payment-service\src\main\java\inside_payment\util\CookieUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package inside_payment.util;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.HashMap;
import java.util.Map;

/**
 * @author fdse
 */
public class CookieUtil {

    private CookieUtil() {
        throw new IllegalStateException("Utility class");
    }

    public static void addCookie(HttpServletResponse response, String name, String value, int maxAge){
        Cookie cookie = new Cookie(name,value);
        // against Cross-Site Scripting (XSS) attacks
        cookie.setHttpOnly(true);
        cookie.setPath("/");
        if(maxAge&gt;0) {
            cookie.setMaxAge(maxAge);
        }
        response.addCookie(cookie);
    }

    public static Cookie getCookieByName(HttpServletRequest request, String name){
        Map&lt;String,Cookie&gt; cookieMap = readCookieMap(request);
        if(cookieMap.containsKey(name)){
            return cookieMap.get(name);
        }else{
            return null;
        }
    }

    private static Map&lt;String,Cookie&gt; readCookieMap(HttpServletRequest request){
        Map&lt;String,Cookie&gt; cookieMap = new HashMap&lt;&gt;();
        Cookie[] cookies = request.getCookies();
        if(null!=cookies){
            for(Cookie cookie : cookies){
                cookieMap.put(cookie.getName(), cookie);
            }
        }
        return cookieMap;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="75" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.300</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> train-ticket</a><br />
<b> <a> File: </a> </b>  <a> CookieUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>ts-verification-code-service\src\main\java\verifycode\util\CookieUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package verifycode.util;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.HashMap;
import java.util.Map;

/**
 * @author fdse
 */
public class CookieUtil {

    private CookieUtil() {
        throw new IllegalStateException("Utility class");
    }

    public static void addCookie(HttpServletResponse response, String name, String value, int maxAge){
        Cookie cookie = new Cookie(name,value);
        // against Cross-Site Scripting (XSS) attacks.
        cookie.setHttpOnly(true);
        cookie.setPath("/");
        if(maxAge&gt;0) {
            cookie.setMaxAge(maxAge);
        }
        response.addCookie(cookie);
    }

    public static Cookie getCookieByName(HttpServletRequest request, String name){
        Map&lt;String,Cookie&gt; cookieMap = readCookieMap(request);
        return cookieMap.getOrDefault(name, null);
    }

    private static Map&lt;String,Cookie&gt; readCookieMap(HttpServletRequest request){
        Map&lt;String,Cookie&gt; cookieMap = new HashMap&lt;&gt;();
        Cookie[] cookies = request.getCookies();
        if(null!=cookies){
            for(Cookie cookie : cookies){
                cookieMap.put(cookie.getName(), cookie);
            }
        }
        return cookieMap;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="76" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.303</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> Base64Util.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-common\src\main\java\com\wanxin\common\util\Base64Util.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.common.util;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class Base64Util {
    private static final char last2byte = (char) Integer.parseInt("00000011", 2);
    private static final char last4byte = (char) Integer.parseInt("00001111", 2);
    private static final char last6byte = (char) Integer.parseInt("00111111", 2);
    private static final char lead6byte = (char) Integer.parseInt("11111100", 2);
    private static final char lead4byte = (char) Integer.parseInt("11110000", 2);
    private static final char lead2byte = (char) Integer.parseInt("11000000", 2);
    private static final char[] encodeTable = new char[]{'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '/'};

    public Base64Util() {
    }

    public static String encode(byte[] from) {
        StringBuilder to = new StringBuilder((int) ((double) from.length * 1.34D) + 3);
        int num = 0;
        char currentByte = 0;

        int i;
        for (i = 0; i &lt; from.length; ++i) {
            for (num %= 8; num &lt; 8; num += 6) {
                switch (num) {
                    case 0:
                        currentByte = (char) (from[i] & lead6byte);
                        currentByte = (char) (currentByte &gt;&gt;&gt; 2);
                    case 1:
                    case 3:
                    case 5:
                    default:
                        break;
                    case 2:
                        currentByte = (char) (from[i] & last6byte);
                        break;
                    case 4:
                        currentByte = (char) (from[i] & last4byte);
                        currentByte = (char) (currentByte &lt;&lt; 2);
                        if (i + 1 &lt; from.length) {
                            currentByte = (char) (currentByte | (from[i + 1] & lead2byte) &gt;&gt;&gt; 6);
                        }
                        break;
                    case 6:
                        currentByte = (char) (from[i] & last2byte);
                        currentByte = (char) (currentByte &lt;&lt; 4);
                        if (i + 1 &lt; from.length) {
                            currentByte = (char) (currentByte | (from[i + 1] & lead4byte) &gt;&gt;&gt; 4);
                        }
                }

                to.append(encodeTable[currentByte]);
            }
        }

        if (to.length() % 4 != 0) {
            for (i = 4 - to.length() % 4; i &gt; 0; --i) {
                to.append("=");
            }
        }

        return to.toString();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="77" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.304</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> HttpUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-common\src\main\java\com\wanxin\common\util\HttpUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.common.util;

import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.List;
import java.util.Map;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class HttpUtil {

    public static String getAccessToken(String ak, String sk) throws Exception {
        // 获取token地址
        String authHost = "https://aip.baidubce.com/oauth/2.0/token?";
        String getAccessTokenUrl = authHost
                // 1.grant_type为固定参数
                + "grant_type=client_credentials"
                // 2.官网获取的 API Key
                + "&client_id=" + ak
                // 3.官网获取的 Secret Key
                + "&client_secret=" + sk;
        URL realUrl = new URL(getAccessTokenUrl);
        // 打开和URL之间的连接
        HttpURLConnection connection = (HttpURLConnection) realUrl.openConnection();
        connection.setRequestMethod("GET");
        connection.connect();
        // 获取所有响应头字段
            /*Map&lt;String, List&lt;String&gt;&gt; map = connection.getHeaderFields();
            // 遍历所有的响应头字段
            for (String key : map.keySet()) {
                System.err.println(key + "---&gt;" + map.get(key));
            }*/
        // 定义 BufferedReader输入流来读取URL的响应
        BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream()));
        String result = "";
        String line;
        while ((line = in.readLine()) != null) {
            result += line;
        }
        in.close();
        connection.disconnect();
        /**
         * 返回结果
         */
        Map&lt;String, Object&gt; resultMap = JsonUtil.jsonToMap(result);
        return resultMap.get("access_token").toString();
    }

    public static String post(String requestUrl, String accessToken, String params)
            throws Exception {
        String contentType = "application/x-www-form-urlencoded";
        return HttpUtil.post(requestUrl, accessToken, contentType, params);
    }

    public static String post(String requestUrl, String accessToken, String contentType, String params)
            throws Exception {
        String encoding = "UTF-8";
        if (requestUrl.contains("nlp")) {
            encoding = "GBK";
        }
        return HttpUtil.post(requestUrl, accessToken, contentType, params, encoding);
    }

    public static String post(String requestUrl, String accessToken, String contentType, String params, String encoding)
            throws Exception {
        String url = requestUrl + "?access_token=" + accessToken;
        return HttpUtil.postGeneralUrl(url, contentType, params, encoding);
    }

    public static String postGeneralUrl(String generalUrl, String contentType, String params, String encoding)
            throws Exception {
        URL url = new URL(generalUrl);
        // 打开和URL之间的连接
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        connection.setRequestMethod("POST");
        // 设置通用的请求属性
        connection.setRequestProperty("Content-Type", contentType);
        connection.setRequestProperty("Connection", "Keep-Alive");
        connection.setUseCaches(false);
        connection.setDoOutput(true);
        connection.setDoInput(true);
        connection.setConnectTimeout(20000);
        connection.setReadTimeout(20000);

        // 得到请求的输出流对象
        DataOutputStream out = new DataOutputStream(connection.getOutputStream());
        out.write(params.getBytes(encoding));
        out.flush();
        out.close();

        // 建立实际的连接
        connection.connect();
        // 获取所有响应头字段
        Map&lt;String, List&lt;String&gt;&gt; headers = connection.getHeaderFields();
        // 遍历所有的响应头字段
        /*for (String key : headers.keySet()) {
            System.err.println(key + "---&gt;" + headers.get(key));
        }*/
        // 定义 BufferedReader输入流来读取URL的响应
        BufferedReader in = null;
        in = new BufferedReader(
                new InputStreamReader(connection.getInputStream(), encoding));
        String result = "";
        String getLine;
        while ((getLine = in.readLine()) != null) {
            result += getLine;
        }
        in.close();
        connection.disconnect();
        // System.err.println("result:" + result);
        return result;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="78" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.306</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> SecurityUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-consumer-service\src\main\java\com\wanxin\consumer\common\SecurityUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.consumer.common;

import com.alibaba.fastjson.JSONObject;
import com.wanxin.api.account.model.LoginUser;
import com.wanxin.common.util.EncryptUtil;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;
import java.util.Map;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class SecurityUtil {

    /**
     * 获取当前登录用户
     */
    public static LoginUser getUser() {
        ServletRequestAttributes servletRequestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        LoginUser loginUser = new LoginUser();
        if (servletRequestAttributes != null) {
            HttpServletRequest request = servletRequestAttributes.getRequest();

            Map jwt = JSONObject.parseObject(EncryptUtil.decodeBase64(request.getHeader("jsonToken")), Map.class);
            if (jwt.get("mobile").toString() != null && !"".equals(jwt.get("mobile").toString())) {
                loginUser.setMobile(jwt.get("mobile").toString());
            }

            if (jwt.get("client_id").toString() != null && !"".equals(jwt.get("client_id").toString())) {
                loginUser.setClientId(jwt.get("client_id").toString());
            }
        }

        return loginUser;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="79" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.309</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> Base64Util.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-consumer-service\src\main\java\com\wanxin\consumer\utils\Base64Util.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.consumer.utils;

/**
 * Base64 工具类
 *
 * @author yuelimin
 * @since 1.8
 */
public class Base64Util {
    private static final char last2byte = (char) Integer.parseInt("00000011", 2);
    private static final char last4byte = (char) Integer.parseInt("00001111", 2);
    private static final char last6byte = (char) Integer.parseInt("00111111", 2);
    private static final char lead6byte = (char) Integer.parseInt("11111100", 2);
    private static final char lead4byte = (char) Integer.parseInt("11110000", 2);
    private static final char lead2byte = (char) Integer.parseInt("11000000", 2);
    private static final char[] encodeTable = new char[]{'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '/'};

    public Base64Util() {
    }

    public static String encode(byte[] from) {
        StringBuilder to = new StringBuilder((int) ((double) from.length * 1.34D) + 3);
        int num = 0;
        char currentByte = 0;

        int i;
        for (i = 0; i &lt; from.length; ++i) {
            for (num %= 8; num &lt; 8; num += 6) {
                switch (num) {
                    case 0:
                        currentByte = (char) (from[i] & lead6byte);
                        currentByte = (char) (currentByte &gt;&gt;&gt; 2);
                    case 1:
                    case 3:
                    case 5:
                    default:
                        break;
                    case 2:
                        currentByte = (char) (from[i] & last6byte);
                        break;
                    case 4:
                        currentByte = (char) (from[i] & last4byte);
                        currentByte = (char) (currentByte &lt;&lt; 2);
                        if (i + 1 &lt; from.length) {
                            currentByte = (char) (currentByte | (from[i + 1] & lead2byte) &gt;&gt;&gt; 6);
                        }
                        break;
                    case 6:
                        currentByte = (char) (from[i] & last2byte);
                        currentByte = (char) (currentByte &lt;&lt; 4);
                        if (i + 1 &lt; from.length) {
                            currentByte = (char) (currentByte | (from[i + 1] & lead4byte) &gt;&gt;&gt; 4);
                        }
                }

                to.append(encodeTable[currentByte]);
            }
        }

        if (to.length() % 4 != 0) {
            for (i = 4 - to.length() % 4; i &gt; 0; --i) {
                to.append("=");
            }
        }

        return to.toString();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="80" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.310</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> HttpUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-consumer-service\src\main\java\com\wanxin\consumer\utils\HttpUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.consumer.utils;

import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

/**
 * http 工具类
 *
 * @author yuelimin
 * @since 1.8
 */
public class HttpUtil {

    public static String post(String requestUrl, String accessToken, String params)
            throws Exception {
        String contentType = "application/x-www-form-urlencoded";
        return HttpUtil.post(requestUrl, accessToken, contentType, params);
    }

    public static String post(String requestUrl, String accessToken, String contentType, String params)
            throws Exception {
        String encoding = "UTF-8";
        if (requestUrl.contains("nlp")) {
            encoding = "GBK";
        }
        return HttpUtil.post(requestUrl, accessToken, contentType, params, encoding);
    }

    public static String post(String requestUrl, String accessToken, String contentType, String params, String encoding)
            throws Exception {
        String url = requestUrl + "?access_token=" + accessToken;
        return HttpUtil.postGeneralUrl(url, contentType, params, encoding);
    }

    public static String postGeneralUrl(String generalUrl, String contentType, String params, String encoding)
            throws Exception {
        URL url = new URL(generalUrl);
        // 打开和URL之间的连接
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        connection.setRequestMethod("POST");
        // 设置通用的请求属性
        connection.setRequestProperty("Content-Type", contentType);
        connection.setRequestProperty("Connection", "Keep-Alive");
        connection.setUseCaches(false);
        connection.setDoOutput(true);
        connection.setDoInput(true);

        // 得到请求的输出流对象
        DataOutputStream out = new DataOutputStream(connection.getOutputStream());
        out.write(params.getBytes(encoding));
        out.flush();
        out.close();

        // 建立实际的连接
        connection.connect();
        // 定义 BufferedReader输入流来读取URL的响应
        BufferedReader in = null;
        in = new BufferedReader(
                new InputStreamReader(connection.getInputStream(), encoding));
        String result = "";
        String getLine;
        while ((getLine = in.readLine()) != null) {
            result += getLine;
        }
        in.close();
        return result;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="81" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.313</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> ClientDefaultAccessTokenConverter.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-gateway-server\src\main\java\com\wanxin\gateway\config\ClientDefaultAccessTokenConverter.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.gateway.config;

import com.alibaba.fastjson.JSON;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.AuthorityUtils;
import org.springframework.security.oauth2.common.DefaultOAuth2AccessToken;
import org.springframework.security.oauth2.common.OAuth2AccessToken;
import org.springframework.security.oauth2.provider.OAuth2Authentication;
import org.springframework.security.oauth2.provider.OAuth2Request;
import org.springframework.security.oauth2.provider.token.AccessTokenConverter;
import org.springframework.security.oauth2.provider.token.DefaultUserAuthenticationConverter;
import org.springframework.security.oauth2.provider.token.UserAuthenticationConverter;

import java.util.*;

/**
 * 令牌格式json与spring OAuth2Authentication的转换
 * 增加jwt对client Authorities的支持
 *
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class ClientDefaultAccessTokenConverter implements AccessTokenConverter {

    public static final String CLIENT_AUTHORITIES = "client_authorities";
    private UserAuthenticationConverter userTokenConverter = new DefaultUserAuthenticationConverter();
    private boolean includeGrantType;

    /**
     * Converter for the part of the data in the token representing a user.
     *
     * @param userTokenConverter the userTokenConverter to set
     */
    public void setUserTokenConverter(UserAuthenticationConverter userTokenConverter) {
        this.userTokenConverter = userTokenConverter;
    }

    /**
     * Flag to indicate the the grant type should be included in the converted token.
     *
     * @param includeGrantType the flag value (default false)
     */
    public void setIncludeGrantType(boolean includeGrantType) {
        this.includeGrantType = includeGrantType;
    }

    @Override
    public Map&lt;String, ?&gt; convertAccessToken(OAuth2AccessToken token, OAuth2Authentication authentication) {
        Map&lt;String, Object&gt; response = new HashMap&lt;String, Object&gt;();
        OAuth2Request clientToken = authentication.getOAuth2Request();

        if (!authentication.isClientOnly()) {
            response.putAll(userTokenConverter.convertUserAuthentication(authentication.getUserAuthentication()));

            ///增加对client Authorities支持
            if (authentication.getOAuth2Request().getAuthorities() != null && !authentication.getOAuth2Request().getAuthorities().isEmpty()) {
                response.put(CLIENT_AUTHORITIES,
                        AuthorityUtils.authorityListToSet(authentication.getOAuth2Request().getAuthorities()));
            }
            ///结束增加对client Authorities支持
        } else {
            if (clientToken.getAuthorities() != null && !clientToken.getAuthorities().isEmpty()) {
                response.put(UserAuthenticationConverter.AUTHORITIES,
                        AuthorityUtils.authorityListToSet(clientToken.getAuthorities()));
            }
        }

        if (token.getScope() != null) {
            response.put(SCOPE, token.getScope());
        }
        if (token.getAdditionalInformation().containsKey(JTI)) {
            response.put(JTI, token.getAdditionalInformation().get(JTI));
        }

        if (token.getExpiration() != null) {
            response.put(EXP, token.getExpiration().getTime() / 1000);
        }

        if (includeGrantType && authentication.getOAuth2Request().getGrantType() != null) {
            response.put(GRANT_TYPE, authentication.getOAuth2Request().getGrantType());
        }

        response.putAll(token.getAdditionalInformation());

        response.put(CLIENT_ID, clientToken.getClientId());
        if (clientToken.getResourceIds() != null && !clientToken.getResourceIds().isEmpty()) {
            response.put(AUD, clientToken.getResourceIds());
        }

        return response;
    }

    @Override
    public OAuth2AccessToken extractAccessToken(String value, Map&lt;String, ?&gt; map) {
        DefaultOAuth2AccessToken token = new DefaultOAuth2AccessToken(value);
        Map&lt;String, Object&gt; info = new HashMap&lt;String, Object&gt;(map);
        info.remove(EXP);
        info.remove(AUD);
        info.remove(CLIENT_ID);
        info.remove(SCOPE);
        if (map.containsKey(EXP)) {
            token.setExpiration(new Date((Long) map.get(EXP) * 1000L));
        }
        if (map.containsKey(JTI)) {
            info.put(JTI, map.get(JTI));
        }
        token.setScope(extractScope(map));
        token.setAdditionalInformation(info);
        return token;
    }

    @Override
    public OAuth2Authentication extractAuthentication(Map&lt;String, ?&gt; map) {
        Map&lt;String, String&gt; parameters = new HashMap&lt;String, String&gt;();
        Set&lt;String&gt; scope = extractScope(map);
        Authentication user = userTokenConverter.extractAuthentication(map);
        String clientId = (String) map.get(CLIENT_ID);
        parameters.put(CLIENT_ID, clientId);
        if (includeGrantType && map.containsKey(GRANT_TYPE)) {
            parameters.put(GRANT_TYPE, (String) map.get(GRANT_TYPE));
        }
        Set&lt;String&gt; resourceIds = new LinkedHashSet&lt;String&gt;(map.containsKey(AUD) ? getAudience(map)
                : Collections.&lt;String&gt;emptySet());

        Collection&lt;? extends GrantedAuthority&gt; authorities = null;
        if (user == null && map.containsKey(AUTHORITIES)) {
            @SuppressWarnings("unchecked")
            String[] roles = ((Collection&lt;String&gt;) map.get(AUTHORITIES)).toArray(new String[0]);
            authorities = AuthorityUtils.createAuthorityList(roles);
        }
        // 增加对client Authorities支持
        if (user != null && map.containsKey(CLIENT_AUTHORITIES)) {
            String[] clentRoles = ((Collection&lt;String&gt;) map.get(CLIENT_AUTHORITIES)).toArray(new String[0]);
            authorities = AuthorityUtils.createAuthorityList(clentRoles);
            // 增加额外属性
            parameters.put("mobile", (String) map.get("mobile"));
            parameters.put("tenant_id", (String) map.get("tenant_id"));
            parameters.put("department_id", (String) map.get("department_id"));
            parameters.put("user_authorities", JSON.toJSONString(map.get("user_authorities")));
            parameters.put("payload", JSON.toJSONString(map.get("payload")));
            // 结束增加额外属性
        }
        // 结束增加对client Authorities支持

        OAuth2Request request = new OAuth2Request(parameters, clientId, authorities, true, scope, resourceIds, null, null,
                null);
        return new OAuth2Authentication(request, user);
    }

    private Collection&lt;String&gt; getAudience(Map&lt;String, ?&gt; map) {
        Object auds = map.get(AUD);
        if (auds instanceof Collection) {
            @SuppressWarnings("unchecked")
            Collection&lt;String&gt; result = (Collection&lt;String&gt;) auds;
            return result;
        }
        return Collections.singleton((String) auds);
    }

    private Set&lt;String&gt; extractScope(Map&lt;String, ?&gt; map) {
        Set&lt;String&gt; scope = Collections.emptySet();
        if (map.containsKey(SCOPE)) {
            Object scopeObj = map.get(SCOPE);
            if (String.class.isInstance(scopeObj)) {
                scope = new LinkedHashSet&lt;String&gt;(Arrays.asList(String.class.cast(scopeObj).split(" ")));
            } else if (Collection.class.isAssignableFrom(scopeObj.getClass())) {
                @SuppressWarnings("unchecked")
                Collection&lt;String&gt; scopeColl = (Collection&lt;String&gt;) scopeObj;
                // Preserve ordering
                scope = new LinkedHashSet&lt;String&gt;(scopeColl);
            }
        }
        return scope;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="82" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.316</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> SecurityUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-transaction-service\src\main\java\com\wanxin\transaction\common\utils\SecurityUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.transaction.common.utils;

import com.alibaba.fastjson.JSONObject;
import com.wanxin.api.account.model.LoginUser;
import com.wanxin.common.util.EncryptUtil;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;
import java.util.Map;

/**
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class SecurityUtil {

    /**
     * 获取当前登录用户
     */
    public static LoginUser getUser() {
        ServletRequestAttributes servletRequestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        LoginUser loginUser = new LoginUser();
        if (servletRequestAttributes != null) {
            HttpServletRequest request = servletRequestAttributes.getRequest();

            Map jwt = JSONObject.parseObject(EncryptUtil.decodeBase64(request.getHeader("jsonToken")), Map.class);
            if (jwt.get("mobile").toString() != null && !"".equals(jwt.get("mobile").toString())) {
                loginUser.setMobile(jwt.get("mobile").toString());
            }

            if (jwt.get("client_id").toString() != null && !"".equals(jwt.get("client_id").toString())) {
                loginUser.setClientId(jwt.get("client_id").toString());
            }
        }

        return loginUser;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="83" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.333</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> FEBS_Cloud</a><br />
<b> <a> File: </a> </b>  <a> AddressUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>febs-gateway\src\main\java\cc\mrbird\febs\gateway\enhance\utils\AddressUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cc.mrbird.febs.gateway.enhance.utils;

import cc.mrbird.febs.common.core.entity.constant.FebsConstant;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.io.FileUtils;
import org.apache.commons.lang3.StringUtils;
import org.lionsoul.ip2region.DataBlock;
import org.lionsoul.ip2region.DbConfig;
import org.lionsoul.ip2region.DbSearcher;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.Method;

/**
 * 根据 IP获取地址
 *
 * @author MrBird
 */
@Slf4j
public abstract class AddressUtil {

    public static String getCityInfo(String ip) {
        DbSearcher searcher = null;
        try {
            String dbPath = AddressUtil.class.getResource("/ip2region/ip2region.db").getPath();
            File file = new File(dbPath);
            if (!file.exists()) {
                String tmpDir = System.getProperties().getProperty(FebsConstant.JAVA_TEMP_DIR);
                dbPath = tmpDir + "ip.db";
                file = new File(dbPath);
                InputStream resourceAsStream = AddressUtil.class.getClassLoader().getResourceAsStream("classpath:ip2region/ip2region.db");
                if (resourceAsStream != null) {
                    FileUtils.copyInputStreamToFile(resourceAsStream, file);
                }
            }
            DbConfig config = new DbConfig();
            searcher = new DbSearcher(config, file.getPath());
            Method method = searcher.getClass().getMethod("btreeSearch", String.class);
            DataBlock dataBlock = (DataBlock) method.invoke(searcher, ip);
            return dataBlock.getRegion();
        } catch (Exception e) {
            log.warn("获取地址信息异常,{}", e.getMessage());
            return StringUtils.EMPTY;
        } finally {
            if (searcher != null) {
                try {
                    searcher.close();
                } catch (IOException e) {
                    log.error("ip2region searcher close error", e);
                }
            }
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="84" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.336</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> FEBS_Cloud</a><br />
<b> <a> File: </a> </b>  <a> AddressUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>febs-server\febs-server-system\src\main\java\cc\mrbird\febs\server\system\utils\AddressUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package cc.mrbird.febs.server.system.utils;

import cc.mrbird.febs.common.core.entity.constant.FebsConstant;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.io.FileUtils;
import org.apache.commons.lang3.StringUtils;
import org.lionsoul.ip2region.DataBlock;
import org.lionsoul.ip2region.DbConfig;
import org.lionsoul.ip2region.DbSearcher;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.Method;

/**
 * 根据 IP获取地址
 *
 * @author MrBird
 */
@Slf4j
public abstract class AddressUtil {

    public static String getCityInfo(String ip) {
        DbSearcher searcher = null;
        try {
            String dbPath = AddressUtil.class.getResource("/ip2region/ip2region.db").getPath();
            File file = new File(dbPath);
            if (!file.exists()) {
                String tmpDir = System.getProperties().getProperty(FebsConstant.JAVA_TEMP_DIR);
                dbPath = tmpDir + "ip.db";
                file = new File(dbPath);
                InputStream resourceAsStream = AddressUtil.class.getClassLoader().getResourceAsStream("classpath:ip2region/ip2region.db");
                if (resourceAsStream != null) {
                    FileUtils.copyInputStreamToFile(resourceAsStream, file);
                }
            }
            DbConfig config = new DbConfig();
            searcher = new DbSearcher(config, file.getPath());
            Method method = searcher.getClass().getMethod("btreeSearch", String.class);
            DataBlock dataBlock = (DataBlock) method.invoke(searcher, ip);
            return dataBlock.getRegion();
        } catch (Exception e) {
            log.warn("获取地址信息异常,{}", e.getMessage());
            return StringUtils.EMPTY;
        } finally {
            if (searcher != null) {
                try {
                    searcher.close();
                } catch (IOException e) {
                    log.error("ip2region searcher close error", e);
                }
            }
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="85" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.337</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> gpmall</a><br />
<b> <a> File: </a> </b>  <a> GlobalIdGeneratorUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>comment-service\comment-provider\src\main\java\com\gpmall\comment\utils\GlobalIdGeneratorUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.gpmall.comment.utils;/**
 * Created by mic on 2019/8/1.
 */

import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.RandomStringUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.time.FastDateFormat;
import org.redisson.RedissonScript;
import org.redisson.api.RScript;
import org.redisson.api.RedissonClient;
import org.redisson.codec.JsonJacksonCodec;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import java.io.IOException;
import java.util.Arrays;
import java.util.List;
import java.util.UUID;
import java.util.concurrent.ExecutionException;

/**
 * 腾讯课堂搜索【咕泡学院】
 * 官网：www.gupaoedu.com
 * 风骚的Mic 老师
 * create-date: 2019/8/1-下午9:40
 */
@Slf4j
@Component
public class GlobalIdGeneratorUtil {


    private static final FastDateFormat seqDateFormat = FastDateFormat.getInstance("yyMMddHHmmssSSS");

    @Autowired
    RedissonClient redissonClient;

    private String keyName;

    private int incrby;

    private String sha1;

    private String luaScript="local function get_max_seq()\n" +
            "    local key = tostring(KEYS[1])\n" +
            "    local incr_amoutt = tonumber(KEYS[2])\n" +
            "    local seq = tostring(KEYS[3])\n" +
            "    local month_in_seconds = 24 * 60 * 60 * 30\n" +
            "    if (1 == redis.call('setnx', key, seq))\n" +
            "    then\n" +
            "        redis.call('expire', key, month_in_seconds)\n" +
            "        return seq\n" +
            "    else\n" +
            "        local prev_seq = redis.call('get', key)\n" +
            "        if (prev_seq &lt; seq)\n" +
            "        then\n" +
            "            redis.call('set', key, seq)\n" +
            "            return seq\n" +
            "        else\n" +
            "            redis.call('incrby', key, incr_amoutt)\n" +
            "            return redis.call('get', key)\n" +
            "        end\n" +
            "    end\n" +
            "end\n" +
            "return get_max_seq()";

    public GlobalIdGeneratorUtil() throws IOException {

    }
    @PostConstruct
    private void init() throws Exception {
        sha1 = redissonClient.getScript().scriptLoad(luaScript);
    }

    public String getNextSeq(String keyName, int incrby) {
        if(StringUtils.isBlank(keyName)||incrby&lt;0) {
            throw new RuntimeException("参数不正确");
        }
        this.keyName=keyName;
        this.incrby=incrby;
        try {
            return getMaxSeq();
        }catch (Exception e){//如果redis出现故障，则采用uuid
            e.printStackTrace();
            return UUID.randomUUID().toString().replace("-","");
        }
    }

    private String generateSeq() {
        String seqDate = seqDateFormat.format(System.currentTimeMillis());
        String candidateSeq = new StringBuilder(17).append(seqDate).append(RandomStringUtils.randomNumeric(2)).toString();
        return candidateSeq;
    }

    public String getMaxSeq() throws ExecutionException, InterruptedException {
        List&lt;Object&gt; keys= Arrays.asList(keyName,incrby,generateSeq());
        RedissonScript rScript=(RedissonScript) redissonClient.getScript();
        //这里遇到一个bug，默认情况下使用evalSha，不加Codec属性时，会报错。这个错误很神奇。花了3个小时才搞定。
        Long seqNext=rScript.evalSha(RScript.Mode.READ_ONLY, JsonJacksonCodec.INSTANCE,sha1, RScript.ReturnType.VALUE,keys);
        return seqNext.toString();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="86" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.338</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> gpmall</a><br />
<b> <a> File: </a> </b>  <a> GlobalIdGeneratorUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>order-services\order-provider\src\main\java\com\gpmall\order\utils\GlobalIdGeneratorUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.gpmall.order.utils;/**
 * Created by mic on 2019/8/1.
 */

import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.RandomStringUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.time.FastDateFormat;
import org.redisson.RedissonScript;
import org.redisson.api.RScript;
import org.redisson.api.RedissonClient;
import org.redisson.codec.JsonJacksonCodec;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import java.io.IOException;
import java.util.Arrays;
import java.util.List;
import java.util.UUID;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.Future;

/**
 * 腾讯课堂搜索【咕泡学院】
 * 官网：www.gupaoedu.com
 * 风骚的Mic 老师
 * create-date: 2019/8/1-下午9:40
 */
@Slf4j
@Component
public class GlobalIdGeneratorUtil {


    private static final FastDateFormat seqDateFormat = FastDateFormat.getInstance("yyMMddHHmmssSSS");

    @Autowired
    RedissonClient redissonClient;

    private String keyName;

    private int incrby;

    private String sha1;

    private String luaScript="local function get_max_seq()\n" +
            "    local key = tostring(KEYS[1])\n" +
            "    local incr_amoutt = tonumber(KEYS[2])\n" +
            "    local seq = tostring(KEYS[3])\n" +
            "    local month_in_seconds = 24 * 60 * 60 * 30\n" +
            "    if (1 == redis.call('setnx', key, seq))\n" +
            "    then\n" +
            "        redis.call('expire', key, month_in_seconds)\n" +
            "        return seq\n" +
            "    else\n" +
            "        local prev_seq = redis.call('get', key)\n" +
            "        if (prev_seq &lt; seq)\n" +
            "        then\n" +
            "            redis.call('set', key, seq)\n" +
            "            return seq\n" +
            "        else\n" +
            "            redis.call('incrby', key, incr_amoutt)\n" +
            "            return redis.call('get', key)\n" +
            "        end\n" +
            "    end\n" +
            "end\n" +
            "return get_max_seq()";

    public GlobalIdGeneratorUtil() throws IOException {

    }
    @PostConstruct
    private void init() throws Exception {
        sha1 = redissonClient.getScript().scriptLoad(luaScript);
    }

    public String getNextSeq(String keyName, int incrby) {
        if(StringUtils.isBlank(keyName)||incrby&lt;0) {
            throw new RuntimeException("参数不正确");
        }
        this.keyName=keyName;
        this.incrby=incrby;
        try {
            return getMaxSeq();
        }catch (Exception e){//如果redis出现故障，则采用uuid
            e.printStackTrace();
            return UUID.randomUUID().toString().replace("-","");
        }
    }

    private String generateSeq() {
        String seqDate = seqDateFormat.format(System.currentTimeMillis());
        String candidateSeq = new StringBuilder(17).append(seqDate).append(RandomStringUtils.randomNumeric(2)).toString();
        return candidateSeq;
    }

    public String getMaxSeq() throws ExecutionException, InterruptedException {
        List&lt;Object&gt; keys= Arrays.asList(keyName,incrby,generateSeq());
        RedissonScript rScript=(RedissonScript) redissonClient.getScript();
        //这里遇到一个bug，默认情况下使用evalSha，不加Codec属性时，会报错。这个错误很神奇。花了3个小时才搞定。
        Long seqNext=rScript.evalSha(RScript.Mode.READ_ONLY, JsonJacksonCodec.INSTANCE,sha1, RScript.ReturnType.VALUE,keys);
        return seqNext.toString();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="87" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.339</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> gpmall</a><br />
<b> <a> File: </a> </b>  <a> GlobalIdGeneratorUtil.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pay-service\pay-provider\src\main\java\com\gpmall\pay\utils\GlobalIdGeneratorUtil.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.gpmall.pay.utils;/**
 * Created by mic on 2019/8/1.
 */

import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.RandomStringUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.time.FastDateFormat;
import org.redisson.RedissonScript;
import org.redisson.api.RScript;
import org.redisson.api.RedissonClient;
import org.redisson.codec.JsonJacksonCodec;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import java.io.IOException;
import java.util.Arrays;
import java.util.List;
import java.util.UUID;
import java.util.concurrent.ExecutionException;

/**
 * 腾讯课堂搜索【咕泡学院】
 * 官网：www.gupaoedu.com
 * 风骚的Mic 老师
 * create-date: 2019/8/1-下午9:40
 */
@Slf4j
@Component
public class GlobalIdGeneratorUtil {


    private static final FastDateFormat seqDateFormat = FastDateFormat.getInstance("yyMMddHHmmssSSS");

    @Autowired
    RedissonClient redissonClient;

    private String keyName;

    private int incrby;

    private String sha1;

    private String luaScript="local function get_max_seq()\n" +
            "    local key = tostring(KEYS[1])\n" +
            "    local incr_amoutt = tonumber(KEYS[2])\n" +
            "    local seq = tostring(KEYS[3])\n" +
            "    local month_in_seconds = 24 * 60 * 60 * 30\n" +
            "    if (1 == redis.call('setnx', key, seq))\n" +
            "    then\n" +
            "        redis.call('expire', key, month_in_seconds)\n" +
            "        return seq\n" +
            "    else\n" +
            "        local prev_seq = redis.call('get', key)\n" +
            "        if (prev_seq &lt; seq)\n" +
            "        then\n" +
            "            redis.call('set', key, seq)\n" +
            "            return seq\n" +
            "        else\n" +
            "            redis.call('incrby', key, incr_amoutt)\n" +
            "            return redis.call('get', key)\n" +
            "        end\n" +
            "    end\n" +
            "end\n" +
            "return get_max_seq()";

    public GlobalIdGeneratorUtil() throws IOException {

    }
    @PostConstruct
    private void init() throws Exception {
        sha1 = redissonClient.getScript().scriptLoad(luaScript);
    }

    public String getNextSeq(String keyName, int incrby) {
        if(StringUtils.isBlank(keyName)||incrby&lt;0) {
            throw new RuntimeException("参数不正确");
        }
        this.keyName=keyName;
        this.incrby=incrby;
        try {
            return getMaxSeq();
        }catch (Exception e){//如果redis出现故障，则采用uuid
            e.printStackTrace();
            return UUID.randomUUID().toString().replace("-","");
        }
    }

    private String generateSeq() {
        String seqDate = seqDateFormat.format(System.currentTimeMillis());
        String candidateSeq = new StringBuilder(17).append(seqDate).append(RandomStringUtils.randomNumeric(2)).toString();
        return candidateSeq;
    }

    public String getMaxSeq() throws ExecutionException, InterruptedException {
        List&lt;Object&gt; keys= Arrays.asList(keyName,incrby,generateSeq());
        RedissonScript rScript=(RedissonScript) redissonClient.getScript();
        //这里遇到一个bug，默认情况下使用evalSha，不加Codec属性时，会报错。这个错误很神奇。花了3个小时才搞定。
        Long seqNext=rScript.evalSha(RScript.Mode.READ_ONLY, JsonJacksonCodec.INSTANCE,sha1, RScript.ReturnType.VALUE,keys);
        return seqNext.toString();
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="88" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.344</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> ExecutorBlockStrategyEnum.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-core\mate-starter-job\src\main\java\com\xxl\job\core\enums\ExecutorBlockStrategyEnum.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.xxl.job.core.enums;

/**
 * Created by xuxueli on 17/5/9.
 */
public enum ExecutorBlockStrategyEnum {

    SERIAL_EXECUTION("Serial execution"),
    /*CONCURRENT_EXECUTION("并行"),*/
    DISCARD_LATER("Discard Later"),
    COVER_EARLY("Cover Early");

    private String title;
    private ExecutorBlockStrategyEnum (String title) {
        this.title = title;
    }

    public void setTitle(String title) {
        this.title = title;
    }
    public String getTitle() {
        return title;
    }

    public static ExecutorBlockStrategyEnum match(String name, ExecutorBlockStrategyEnum defaultItem) {
        if (name != null) {
            for (ExecutorBlockStrategyEnum item:ExecutorBlockStrategyEnum.values()) {
                if (item.name().equals(name)) {
                    return item;
                }
            }
        }
        return defaultItem;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="89" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.345</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> ExecutorRegistryThread.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-core\mate-starter-job\src\main\java\com\xxl\job\core\thread\ExecutorRegistryThread.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.xxl.job.core.thread;

import com.xxl.job.core.biz.AdminBiz;
import com.xxl.job.core.biz.model.RegistryParam;
import com.xxl.job.core.biz.model.ReturnT;
import com.xxl.job.core.enums.RegistryConfig;
import com.xxl.job.core.executor.XxlJobExecutor;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.concurrent.TimeUnit;

/**
 * Created by xuxueli on 17/3/2.
 */
public class ExecutorRegistryThread {
    private static Logger logger = LoggerFactory.getLogger(ExecutorRegistryThread.class);

    private static ExecutorRegistryThread instance = new ExecutorRegistryThread();
    public static ExecutorRegistryThread getInstance(){
        return instance;
    }

    private Thread registryThread;
    private volatile boolean toStop = false;
    public void start(final String appname, final String address){

        // valid
        if (appname==null || appname.trim().length()==0) {
            logger.warn("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, executor registry config fail, appname is null.");
            return;
        }
        if (XxlJobExecutor.getAdminBizList() == null) {
            logger.warn("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, executor registry config fail, adminAddresses is null.");
            return;
        }

        registryThread = new Thread(new Runnable() {
            @Override
            public void run() {

                // registry
                while (!toStop) {
                    try {
                        RegistryParam registryParam = new RegistryParam(RegistryConfig.RegistType.EXECUTOR.name(), appname, address);
                        for (AdminBiz adminBiz: XxlJobExecutor.getAdminBizList()) {
                            try {
                                ReturnT&lt;String&gt; registryResult = adminBiz.registry(registryParam);
                                if (registryResult!=null && ReturnT.SUCCESS_CODE == registryResult.getCode()) {
                                    registryResult = ReturnT.SUCCESS;
                                    logger.debug("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job registry success, registryParam:{}, registryResult:{}", new Object[]{registryParam, registryResult});
                                    break;
                                } else {
                                    logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job registry fail, registryParam:{}, registryResult:{}", new Object[]{registryParam, registryResult});
                                }
                            } catch (Exception e) {
                                logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job registry error, registryParam:{}", registryParam, e);
                            }

                        }
                    } catch (Exception e) {
                        if (!toStop) {
                            logger.error(e.getMessage(), e);
                        }

                    }

                    try {
                        if (!toStop) {
                            TimeUnit.SECONDS.sleep(RegistryConfig.BEAT_TIMEOUT);
                        }
                    } catch (InterruptedException e) {
                        if (!toStop) {
                            logger.warn("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, executor registry thread interrupted, error msg:{}", e.getMessage());
                        }
                    }
                }

                // registry remove
                try {
                    RegistryParam registryParam = new RegistryParam(RegistryConfig.RegistType.EXECUTOR.name(), appname, address);
                    for (AdminBiz adminBiz: XxlJobExecutor.getAdminBizList()) {
                        try {
                            ReturnT&lt;String&gt; registryResult = adminBiz.registryRemove(registryParam);
                            if (registryResult!=null && ReturnT.SUCCESS_CODE == registryResult.getCode()) {
                                registryResult = ReturnT.SUCCESS;
                                logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job registry-remove success, registryParam:{}, registryResult:{}", new Object[]{registryParam, registryResult});
                                break;
                            } else {
                                logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job registry-remove fail, registryParam:{}, registryResult:{}", new Object[]{registryParam, registryResult});
                            }
                        } catch (Exception e) {
                            if (!toStop) {
                                logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job registry-remove error, registryParam:{}", registryParam, e);
                            }

                        }

                    }
                } catch (Exception e) {
                    if (!toStop) {
                        logger.error(e.getMessage(), e);
                    }
                }
                logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, executor registry thread destory.");

            }
        });
        registryThread.setDaemon(true);
        registryThread.setName("xxl-job, executor ExecutorRegistryThread");
        registryThread.start();
    }

    public void toStop() {
        toStop = true;

        // interrupt and wait
        if (registryThread != null) {
            registryThread.interrupt();
            try {
                registryThread.join();
            } catch (InterruptedException e) {
                logger.error(e.getMessage(), e);
            }
        }

    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="90" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.346</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> JobLogFileCleanThread.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-core\mate-starter-job\src\main\java\com\xxl\job\core\thread\JobLogFileCleanThread.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.xxl.job.core.thread;

import com.xxl.job.core.log.XxlJobFileAppender;
import com.xxl.job.core.util.FileUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.File;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.concurrent.TimeUnit;

/**
 * job file clean thread
 *
 * @author xuxueli 2017-12-29 16:23:43
 */
public class JobLogFileCleanThread {
    private static Logger logger = LoggerFactory.getLogger(JobLogFileCleanThread.class);

    private static JobLogFileCleanThread instance = new JobLogFileCleanThread();
    public static JobLogFileCleanThread getInstance(){
        return instance;
    }

    private Thread localThread;
    private volatile boolean toStop = false;
    public void start(final long logRetentionDays){

        // limit min value
        if (logRetentionDays &lt; 3 ) {
            return;
        }

        localThread = new Thread(new Runnable() {
            @Override
            public void run() {
                while (!toStop) {
                    try {
                        // clean log dir, over logRetentionDays
                        File[] childDirs = new File(XxlJobFileAppender.getLogPath()).listFiles();
                        if (childDirs!=null && childDirs.length&gt;0) {

                            // today
                            Calendar todayCal = Calendar.getInstance();
                            todayCal.set(Calendar.HOUR_OF_DAY,0);
                            todayCal.set(Calendar.MINUTE,0);
                            todayCal.set(Calendar.SECOND,0);
                            todayCal.set(Calendar.MILLISECOND,0);

                            Date todayDate = todayCal.getTime();

                            for (File childFile: childDirs) {

                                // valid
                                if (!childFile.isDirectory()) {
                                    continue;
                                }
                                if (childFile.getName().indexOf("-") == -1) {
                                    continue;
                                }

                                // file create date
                                Date logFileCreateDate = null;
                                try {
                                    SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd");
                                    logFileCreateDate = simpleDateFormat.parse(childFile.getName());
                                } catch (ParseException e) {
                                    logger.error(e.getMessage(), e);
                                }
                                if (logFileCreateDate == null) {
                                    continue;
                                }

                                if ((todayDate.getTime()-logFileCreateDate.getTime()) &gt;= logRetentionDays * (24 * 60 * 60 * 1000) ) {
                                    FileUtil.deleteRecursively(childFile);
                                }

                            }
                        }

                    } catch (Exception e) {
                        if (!toStop) {
                            logger.error(e.getMessage(), e);
                        }

                    }

                    try {
                        TimeUnit.DAYS.sleep(1);
                    } catch (InterruptedException e) {
                        if (!toStop) {
                            logger.error(e.getMessage(), e);
                        }
                    }
                }
                logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, executor JobLogFileCleanThread thread destory.");

            }
        });
        localThread.setDaemon(true);
        localThread.setName("xxl-job, executor JobLogFileCleanThread");
        localThread.start();
    }

    public void toStop() {
        toStop = true;

        if (localThread == null) {
            return;
        }

        // interrupt and wait
        localThread.interrupt();
        try {
            localThread.join();
        } catch (InterruptedException e) {
            logger.error(e.getMessage(), e);
        }
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="91" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.348</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> ExecutorRouteStrategyEnum.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-support\mate-job-admin\src\main\java\com\xxl\job\admin\core\route\ExecutorRouteStrategyEnum.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.xxl.job.admin.core.route;

import com.xxl.job.admin.core.route.strategy.*;
import com.xxl.job.admin.core.util.I18nUtil;

/**
 * Created by xuxueli on 17/3/10.
 */
public enum ExecutorRouteStrategyEnum {

    FIRST(I18nUtil.getString("jobconf_route_first"), new ExecutorRouteFirst()),
    LAST(I18nUtil.getString("jobconf_route_last"), new ExecutorRouteLast()),
    ROUND(I18nUtil.getString("jobconf_route_round"), new ExecutorRouteRound()),
    RANDOM(I18nUtil.getString("jobconf_route_random"), new ExecutorRouteRandom()),
    CONSISTENT_HASH(I18nUtil.getString("jobconf_route_consistenthash"), new ExecutorRouteConsistentHash()),
    LEAST_FREQUENTLY_USED(I18nUtil.getString("jobconf_route_lfu"), new ExecutorRouteLFU()),
    LEAST_RECENTLY_USED(I18nUtil.getString("jobconf_route_lru"), new ExecutorRouteLRU()),
    FAILOVER(I18nUtil.getString("jobconf_route_failover"), new ExecutorRouteFailover()),
    BUSYOVER(I18nUtil.getString("jobconf_route_busyover"), new ExecutorRouteBusyover()),
    SHARDING_BROADCAST(I18nUtil.getString("jobconf_route_shard"), null);

    ExecutorRouteStrategyEnum(String title, ExecutorRouter router) {
        this.title = title;
        this.router = router;
    }

    private String title;
    private ExecutorRouter router;

    public String getTitle() {
        return title;
    }
    public ExecutorRouter getRouter() {
        return router;
    }

    public static ExecutorRouteStrategyEnum match(String name, ExecutorRouteStrategyEnum defaultItem){
        if (name != null) {
            for (ExecutorRouteStrategyEnum item: ExecutorRouteStrategyEnum.values()) {
                if (item.name().equals(name)) {
                    return item;
                }
            }
        }
        return defaultItem;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="92" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.349</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> JobCompleteHelper.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-support\mate-job-admin\src\main\java\com\xxl\job\admin\core\thread\JobCompleteHelper.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.xxl.job.admin.core.thread;

import com.xxl.job.admin.core.complete.XxlJobCompleter;
import com.xxl.job.admin.core.conf.XxlJobAdminConfig;
import com.xxl.job.admin.core.model.XxlJobLog;
import com.xxl.job.admin.core.util.I18nUtil;
import com.xxl.job.core.biz.model.HandleCallbackParam;
import com.xxl.job.core.biz.model.ReturnT;
import com.xxl.job.core.util.DateUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.Date;
import java.util.List;
import java.util.concurrent.*;

/**
 * job lose-monitor instance
 *
 * @author xuxueli 2015-9-1 18:05:56
 */
public class JobCompleteHelper {
	private static Logger logger = LoggerFactory.getLogger(JobCompleteHelper.class);
	
	private static JobCompleteHelper instance = new JobCompleteHelper();
	public static JobCompleteHelper getInstance(){
		return instance;
	}

	// ---------------------- monitor ----------------------

	private ThreadPoolExecutor callbackThreadPool = null;
	private Thread monitorThread;
	private volatile boolean toStop = false;
	public void start(){

		// for callback
		callbackThreadPool = new ThreadPoolExecutor(
				2,
				20,
				30L,
				TimeUnit.SECONDS,
				new LinkedBlockingQueue&lt;Runnable&gt;(3000),
				new ThreadFactory() {
					@Override
					public Thread newThread(Runnable r) {
						return new Thread(r, "xxl-job, admin JobLosedMonitorHelper-callbackThreadPool-" + r.hashCode());
					}
				},
				new RejectedExecutionHandler() {
					@Override
					public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
						r.run();
						logger.warn("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, callback too fast, match threadpool rejected handler(run now).");
					}
				});


		// for monitor
		monitorThread = new Thread(new Runnable() {

			@Override
			public void run() {

				// wait for JobTriggerPoolHelper-init
				try {
					TimeUnit.MILLISECONDS.sleep(50);
				} catch (InterruptedException e) {
					if (!toStop) {
						logger.error(e.getMessage(), e);
					}
				}

				// monitor
				while (!toStop) {
					try {
						// 任务结果丢失处理：调度记录停留在 "运行中" 状态超过10min，且对应执行器心跳注册失败不在线，则将本地调度主动标记失败；
						Date losedTime = DateUtil.addMinutes(new Date(), -10);
						List&lt;Long&gt; losedJobIds  = XxlJobAdminConfig.getAdminConfig().getXxlJobLogDao().findLostJobIds(losedTime);

						if (losedJobIds!=null && losedJobIds.size()&gt;0) {
							for (Long logId: losedJobIds) {

								XxlJobLog jobLog = new XxlJobLog();
								jobLog.setId(logId);

								jobLog.setHandleTime(new Date());
								jobLog.setHandleCode(ReturnT.FAIL_CODE);
								jobLog.setHandleMsg( I18nUtil.getString("joblog_lost_fail") );

								XxlJobCompleter.updateHandleInfoAndFinish(jobLog);
							}

						}
					} catch (Exception e) {
						if (!toStop) {
							logger.error("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, job fail monitor thread error:{}", e);
						}
					}

                    try {
                        TimeUnit.SECONDS.sleep(60);
                    } catch (Exception e) {
                        if (!toStop) {
                            logger.error(e.getMessage(), e);
                        }
                    }

                }

				logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, JobLosedMonitorHelper stop");

			}
		});
		monitorThread.setDaemon(true);
		monitorThread.setName("xxl-job, admin JobLosedMonitorHelper");
		monitorThread.start();
	}

	public void toStop(){
		toStop = true;

		// stop registryOrRemoveThreadPool
		callbackThreadPool.shutdownNow();

		// stop monitorThread (interrupt and wait)
		monitorThread.interrupt();
		try {
			monitorThread.join();
		} catch (InterruptedException e) {
			logger.error(e.getMessage(), e);
		}
	}


	// ---------------------- helper ----------------------

	public ReturnT&lt;String&gt; callback(List&lt;HandleCallbackParam&gt; callbackParamList) {

		callbackThreadPool.execute(new Runnable() {
			@Override
			public void run() {
				for (HandleCallbackParam handleCallbackParam: callbackParamList) {
					ReturnT&lt;String&gt; callbackResult = callback(handleCallbackParam);
					logger.debug("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; JobApiController.callback {}, handleCallbackParam={}, callbackResult={}",
							(callbackResult.getCode()== ReturnT.SUCCESS_CODE?"success":"fail"), handleCallbackParam, callbackResult);
				}
			}
		});

		return ReturnT.SUCCESS;
	}

	private ReturnT&lt;String&gt; callback(HandleCallbackParam handleCallbackParam) {
		// valid log item
		XxlJobLog log = XxlJobAdminConfig.getAdminConfig().getXxlJobLogDao().load(handleCallbackParam.getLogId());
		if (log == null) {
			return new ReturnT&lt;String&gt;(ReturnT.FAIL_CODE, "log item not found.");
		}
		if (log.getHandleCode() &gt; 0) {
			return new ReturnT&lt;String&gt;(ReturnT.FAIL_CODE, "log repeate callback.");     // avoid repeat callback, trigger child job etc
		}

		// handle msg
		StringBuffer handleMsg = new StringBuffer();
		if (log.getHandleMsg()!=null) {
			handleMsg.append(log.getHandleMsg()).append("&lt;br&gt;");
		}
		if (handleCallbackParam.getHandleMsg() != null) {
			handleMsg.append(handleCallbackParam.getHandleMsg());
		}

		// success, save log
		log.setHandleTime(new Date());
		log.setHandleCode(handleCallbackParam.getHandleCode());
		log.setHandleMsg(handleMsg.toString());
		XxlJobCompleter.updateHandleInfoAndFinish(log);

		return ReturnT.SUCCESS;
	}



}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="93" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.350</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> matecloud</a><br />
<b> <a> File: </a> </b>  <a> JobRegistryHelper.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mate-support\mate-job-admin\src\main\java\com\xxl\job\admin\core\thread\JobRegistryHelper.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.xxl.job.admin.core.thread;

import com.xxl.job.admin.core.conf.XxlJobAdminConfig;
import com.xxl.job.admin.core.model.XxlJobGroup;
import com.xxl.job.admin.core.model.XxlJobRegistry;
import com.xxl.job.core.biz.model.RegistryParam;
import com.xxl.job.core.biz.model.ReturnT;
import com.xxl.job.core.enums.RegistryConfig;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.util.StringUtils;

import java.util.*;
import java.util.concurrent.*;

/**
 * job registry instance
 * @author xuxueli 2016-10-02 19:10:24
 */
public class JobRegistryHelper {
	private static Logger logger = LoggerFactory.getLogger(JobRegistryHelper.class);

	private static JobRegistryHelper instance = new JobRegistryHelper();
	public static JobRegistryHelper getInstance(){
		return instance;
	}

	private ThreadPoolExecutor registryOrRemoveThreadPool = null;
	private Thread registryMonitorThread;
	private volatile boolean toStop = false;

	public void start(){

		// for registry or remove
		registryOrRemoveThreadPool = new ThreadPoolExecutor(
				2,
				10,
				30L,
				TimeUnit.SECONDS,
				new LinkedBlockingQueue&lt;Runnable&gt;(2000),
				new ThreadFactory() {
					@Override
					public Thread newThread(Runnable r) {
						return new Thread(r, "xxl-job, admin JobRegistryMonitorHelper-registryOrRemoveThreadPool-" + r.hashCode());
					}
				},
				new RejectedExecutionHandler() {
					@Override
					public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
						r.run();
						logger.warn("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, registry or remove too fast, match threadpool rejected handler(run now).");
					}
				});

		// for monitor
		registryMonitorThread = new Thread(new Runnable() {
			@Override
			public void run() {
				while (!toStop) {
					try {
						// auto registry group
						List&lt;XxlJobGroup&gt; groupList = XxlJobAdminConfig.getAdminConfig().getXxlJobGroupDao().findByAddressType(0);
						if (groupList!=null && !groupList.isEmpty()) {

							// remove dead address (admin/executor)
							List&lt;Integer&gt; ids = XxlJobAdminConfig.getAdminConfig().getXxlJobRegistryDao().findDead(RegistryConfig.DEAD_TIMEOUT, new Date());
							if (ids!=null && ids.size()&gt;0) {
								XxlJobAdminConfig.getAdminConfig().getXxlJobRegistryDao().removeDead(ids);
							}

							// fresh online address (admin/executor)
							HashMap&lt;String, List&lt;String&gt;&gt; appAddressMap = new HashMap&lt;String, List&lt;String&gt;&gt;();
							List&lt;XxlJobRegistry&gt; list = XxlJobAdminConfig.getAdminConfig().getXxlJobRegistryDao().findAll(RegistryConfig.DEAD_TIMEOUT, new Date());
							if (list != null) {
								for (XxlJobRegistry item: list) {
									if (RegistryConfig.RegistType.EXECUTOR.name().equals(item.getRegistryGroup())) {
										String appname = item.getRegistryKey();
										List&lt;String&gt; registryList = appAddressMap.get(appname);
										if (registryList == null) {
											registryList = new ArrayList&lt;String&gt;();
										}

										if (!registryList.contains(item.getRegistryValue())) {
											registryList.add(item.getRegistryValue());
										}
										appAddressMap.put(appname, registryList);
									}
								}
							}

							// fresh group address
							for (XxlJobGroup group: groupList) {
								List&lt;String&gt; registryList = appAddressMap.get(group.getAppname());
								String addressListStr = null;
								if (registryList!=null && !registryList.isEmpty()) {
									Collections.sort(registryList);
									StringBuilder addressListSB = new StringBuilder();
									for (String item:registryList) {
										addressListSB.append(item).append(",");
									}
									addressListStr = addressListSB.toString();
									addressListStr = addressListStr.substring(0, addressListStr.length()-1);
								}
								group.setAddressList(addressListStr);
								group.setUpdateTime(new Date());

								XxlJobAdminConfig.getAdminConfig().getXxlJobGroupDao().update(group);
							}
						}
					} catch (Exception e) {
						if (!toStop) {
							logger.error("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, job registry monitor thread error:{}", e);
						}
					}
					try {
						TimeUnit.SECONDS.sleep(RegistryConfig.BEAT_TIMEOUT);
					} catch (InterruptedException e) {
						if (!toStop) {
							logger.error("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, job registry monitor thread error:{}", e);
						}
					}
				}
				logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job, job registry monitor thread stop");
			}
		});
		registryMonitorThread.setDaemon(true);
		registryMonitorThread.setName("xxl-job, admin JobRegistryMonitorHelper-registryMonitorThread");
		registryMonitorThread.start();
	}

	public void toStop(){
		toStop = true;

		// stop registryOrRemoveThreadPool
		registryOrRemoveThreadPool.shutdownNow();

		// stop monitir (interrupt and wait)
		registryMonitorThread.interrupt();
		try {
			registryMonitorThread.join();
		} catch (InterruptedException e) {
			logger.error(e.getMessage(), e);
		}
	}


	// ---------------------- helper ----------------------

	public ReturnT&lt;String&gt; registry(RegistryParam registryParam) {

		// valid
		if (!StringUtils.hasText(registryParam.getRegistryGroup())
				|| !StringUtils.hasText(registryParam.getRegistryKey())
				|| !StringUtils.hasText(registryParam.getRegistryValue())) {
			return new ReturnT&lt;String&gt;(ReturnT.FAIL_CODE, "Illegal Argument.");
		}

		// async execute
		registryOrRemoveThreadPool.execute(new Runnable() {
			@Override
			public void run() {
				int ret = XxlJobAdminConfig.getAdminConfig().getXxlJobRegistryDao().registryUpdate(registryParam.getRegistryGroup(), registryParam.getRegistryKey(), registryParam.getRegistryValue(), new Date());
				if (ret &lt; 1) {
					XxlJobAdminConfig.getAdminConfig().getXxlJobRegistryDao().registrySave(registryParam.getRegistryGroup(), registryParam.getRegistryKey(), registryParam.getRegistryValue(), new Date());

					// fresh
					freshGroupRegistryInfo(registryParam);
				}
			}
		});

		return ReturnT.SUCCESS;
	}

	public ReturnT&lt;String&gt; registryRemove(RegistryParam registryParam) {

		// valid
		if (!StringUtils.hasText(registryParam.getRegistryGroup())
				|| !StringUtils.hasText(registryParam.getRegistryKey())
				|| !StringUtils.hasText(registryParam.getRegistryValue())) {
			return new ReturnT&lt;String&gt;(ReturnT.FAIL_CODE, "Illegal Argument.");
		}

		// async execute
		registryOrRemoveThreadPool.execute(new Runnable() {
			@Override
			public void run() {
				int ret = XxlJobAdminConfig.getAdminConfig().getXxlJobRegistryDao().registryDelete(registryParam.getRegistryGroup(), registryParam.getRegistryKey(), registryParam.getRegistryValue());
				if (ret &gt; 0) {
					// fresh
					freshGroupRegistryInfo(registryParam);
				}
			}
		});

		return ReturnT.SUCCESS;
	}

	private void freshGroupRegistryInfo(RegistryParam registryParam){
		// Under consideration, prevent affecting core tables
	}


}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="94" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.358</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> microserver_own</a><br />
<b> <a> File: </a> </b>  <a> Util.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>own-common\src\main\java\com\own\face\util\Util.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.own.face.util;

import com.fasterxml.jackson.databind.ObjectMapper;

import java.io.*;

public class Util {

	public Util() {
	}

	/**
	 * 判断对象是否为空
	 * 
	 * @param object
	 * @return
	 */
	public static boolean isNullOrEmpty(Object object) {
		if (object == null || "".equals(object.toString()))
			return true;
		return false;
	}

	/**
	 * 转字符串，去空格
	 * @param object
	 * @return
	 */
	public static String toStringAndTrim(Object object) {
		if (object == null)
			return "";
		else
			return object.toString().trim();
	}

	/**
	 * 将图片从临时目录移动到真实目录，并删除临时路径图片
	 * @param tmpInfoFilePath 临时图片存放路径
	 * @param realInfofilePath 真实图片存放路径
	 * @param fileNames 移动图片的名称数组 例如 [a.png,b.jpb,c.png]
	 */
	public static void copyFileToRealPath(String tmpInfoFilePath,String realInfofilePath,String[] fileNames){
		File file = null;
		FileInputStream fis = null;
		BufferedInputStream bis = null;
		FileOutputStream fos = null;
		for(String fileName : fileNames){
			try{
				file = new File(tmpInfoFilePath+"/"+fileName);
				if(!file.exists()){
					continue;
				}
				fis = new FileInputStream(file);
				bis=new BufferedInputStream(fis);
				fos = new FileOutputStream(realInfofilePath+"/"+fileName);//写入文件
				byte data[]=new byte[4096];
				int size=0;
				size=bis.read(data);
				while (size!=-1){
					fos.write(data,0,size);
					size=bis.read(data);
				}
				fos.flush();
			}catch(IOException e){
				e.printStackTrace();
				//throw new IFException("500","将图片从临时路径拷贝到真实路径出错...");
			}finally{
				try{
					if(fis != null)
						fis.close();
					if(bis != null)
						bis.close();
					if(fos != null)
						fos.close();
					if(file.exists())
						file.delete();//删除临时路径图片
				}
				catch(Exception e){
					e.printStackTrace();
				}
			}
		}
	}

	public static Object createJson2Bean(String value, Class calsz)
	{
		if(value == null || "".equals(value))
			return null;
		ObjectMapper mapper = new ObjectMapper();
		Object object = null;
		try {
			object = mapper.readValue(value, calsz);
		} catch(IOException e){
			e.printStackTrace();
		}
		return object;
	}


}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="95" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.359</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> moguBlog</a><br />
<b> <a> File: </a> </b>  <a> PicturePieline.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mogu_picture\src\main\java\com\moxi\mogublog\picture\spider\PicturePieline.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.moxi.mogublog.picture.spider;

import cn.hutool.core.collection.CollectionUtil;
import com.alibaba.fastjson.JSON;
import org.springframework.stereotype.Component;
import us.codecraft.webmagic.ResultItems;
import us.codecraft.webmagic.Task;
import us.codecraft.webmagic.pipeline.Pipeline;

import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

@Component
public class PicturePieline implements Pipeline {

    //下载图片
    private static List&lt;String&gt; Download(List&lt;String&gt; listImgSrc) {
        //开始时间
        Date begindate = new Date();
        ArrayList&lt;String&gt; localFile = new ArrayList&lt;&gt;();
        try {
            for (String url : listImgSrc) {
                //开始时间
                Date begindate2 = new Date();
                String imageName = url.substring(url.lastIndexOf("/") + 1, url.length());
                URL uri = new URL(url);
                HttpURLConnection conn = (HttpURLConnection) uri.openConnection();
                conn.setConnectTimeout(50000);
                conn.setReadTimeout(50000);
                conn.addRequestProperty("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36");
                conn.connect();
                InputStream in = conn.getInputStream();
                String pathname = "D:\\123\\" + imageName;
                File file = new File(pathname);
                FileOutputStream fo = new FileOutputStream(file);//文件输出流
                byte[] buf = new byte[1024];
                int length = 0;
                System.out.println("开始下载:" + url);
                while ((length = in.read(buf, 0, buf.length)) != -1) {
                    fo.write(buf, 0, length);
                }
                //关闭流
                in.close();
                fo.close();
                System.out.println(imageName + "下载完成");
                //结束时间
                Date overdate2 = new Date();
                double time = overdate2.getTime() - begindate2.getTime();
                System.out.println("耗时：" + time / 1000 + "s");
                localFile.add(pathname);
            }
            Date overdate = new Date();
            double time = overdate.getTime() - begindate.getTime();
            System.out.println("总耗时：" + time / 1000 + "s");
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
        return localFile;
    }

    @Override
    public void process(ResultItems resultItems, Task task) {
        //获取图片参数
        String imgSrc = resultItems.get("imgSrc");
        //获取关键词
        String searchKey = resultItems.get("searchKey");
        List imgSrcs = JSON.parseObject(imgSrc, List.class);
        if (CollectionUtil.isEmpty(imgSrcs)) {
            return;
        }
        //下载图片并上传到七牛云
        List localFileUrl = Download(imgSrcs);

    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="96" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.360</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> moguBlog</a><br />
<b> <a> File: </a> </b>  <a> PictureProcesser.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mogu_picture\src\main\java\com\moxi\mogublog\picture\spider\PictureProcesser.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.moxi.mogublog.picture.spider;

import cn.hutool.core.collection.CollectionUtil;
import com.alibaba.fastjson.JSON;
import com.google.gson.Gson;
import com.qiniu.common.QiniuException;
import com.qiniu.common.Zone;
import com.qiniu.http.Response;
import com.qiniu.storage.Configuration;
import com.qiniu.storage.UploadManager;
import com.qiniu.storage.model.DefaultPutRet;
import com.qiniu.util.Auth;
import org.springframework.stereotype.Component;
import us.codecraft.webmagic.Page;
import us.codecraft.webmagic.Site;
import us.codecraft.webmagic.processor.PageProcessor;
import us.codecraft.webmagic.selector.Html;

import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.UUID;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

@Component
public class PictureProcesser implements PageProcessor {

    // 获取img标签正则
    private static final String IMGURL_REG = "&lt;img.*?src=.*?photos.*?/&gt;";
    // 获取src路径的正则
    private static final String IMGSRC_REG = "/photos.*?\\?";

    /**
     * 查找输入的关键词
     *
     * @param url
     * @return
     */
    public static String findSearchKey(String url) {
        // 按指定模式在字符串查找
        String reg = "\\?q=.*";
        // 创建 Pattern 对象
        // 现在创建 matcher 对象
        Pattern pattern = Pattern.compile(reg);// 匹配的模式
        Matcher m = pattern.matcher(url);
        if (m.find()) {
            String group = m.group(0);
            String replace = group.replace("?q=", "").replaceFirst("&.*", "");
            return replace;
        } else {
            return url;
        }
    }

    /**
     * 解析html
     *
     * @param url
     * @return
     * @throws Exception
     */
    private static String getHtml(String url) throws Exception {
        URL url1 = new URL(url);//使用java.net.URL
        HttpURLConnection connection = (HttpURLConnection) url1.
                openConnection();
        connection.setRequestProperty("User-Agent", "Mozilla/4.0 (compatible; MSIE 5.0; Windows NT; DigExt)");
        InputStream in = connection.getInputStream();//获取输入流
        InputStreamReader isr = new InputStreamReader(in);//流的包装
        BufferedReader br = new BufferedReader(isr);

        String line;
        StringBuffer sb = new StringBuffer();
        while ((line = br.readLine()) != null) {//整行读取
            sb.append(line, 0, line.length());//添加到StringBuffer中
            sb.append('\n');//添加换行符
        }
        //关闭各种流，先声明的后关闭
        br.close();
        isr.close();
        in.close();
        return sb.toString();
    }

    //获取ImageUrl地址
    private static List&lt;String&gt; getImageUrl(String html) {
        Pattern compile = Pattern.compile(IMGURL_REG);
        Matcher matcher = compile.matcher(html);
        List&lt;String&gt; listimgurl = new ArrayList&lt;String&gt;();
        while (matcher.find()) {
            listimgurl.add(matcher.group());
        }
        return listimgurl;
    }

    //获取ImageSrc地址
    private static List&lt;String&gt; getImageSrc(List&lt;String&gt; listimageurl) {
        List&lt;String&gt; listImageSrc = new ArrayList&lt;String&gt;();
        for (String image : listimageurl) {
            Matcher matcher = Pattern.compile(IMGSRC_REG).matcher(image);
            while (matcher.find()) {
                listImageSrc.add("https://foter.com" + matcher.group().substring(0, matcher.group().length() - 1));
            }
        }
        return listImageSrc;
    }

    /**
     * 获取UUID，去掉了-
     *
     * @return
     */
    public static String getUUID() {
        String uuid = UUID.randomUUID().toString().replaceAll("-", "");
        return uuid;
    }

    //下载图片
    private static List&lt;String&gt; Download(List&lt;String&gt; listImgSrc) {
        //开始时间
        Date begindate = new Date();
        ArrayList&lt;String&gt; localFile = new ArrayList&lt;&gt;();
        try {
            for (String url : listImgSrc) {
                //开始时间
                Date begindate2 = new Date();
                String imageName = url.substring(url.lastIndexOf("/") + 1, url.length());
                URL uri = new URL(url);
                HttpURLConnection conn = (HttpURLConnection) uri.openConnection();
                conn.setConnectTimeout(50000);
                conn.setReadTimeout(50000);
                conn.addRequestProperty("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36");
                conn.connect();
                InputStream in = conn.getInputStream();
                String pathname = "D:\\123\\" + imageName;
                File file = new File(pathname);
                FileOutputStream fo = new FileOutputStream(file);//文件输出流
                byte[] buf = new byte[1024];
                int length = 0;
                System.out.println("开始下载:" + url);
                while ((length = in.read(buf, 0, buf.length)) != -1) {
                    fo.write(buf, 0, length);
                }
                //关闭流
                in.close();
                fo.close();
                System.out.println(imageName + "下载完成");
                //结束时间
                Date overdate2 = new Date();
                double time = overdate2.getTime() - begindate2.getTime();
                System.out.println("耗时：" + time / 1000 + "s");
                localFile.add(pathname);
            }
            Date overdate = new Date();
            double time = overdate.getTime() - begindate.getTime();
            System.out.println("总耗时：" + time / 1000 + "s");
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
        return localFile;
    }

    private static void add(List&lt;String&gt; localFile) throws QiniuException {
        for (String ss : localFile) {
            //构造一个带指定Zone对象的配置类
            Configuration cfg = new Configuration(Zone.zone2());
            //生成上传凭证，然后准备上传
            String accessKey = "KPTcX6IBYXrR8wpE0VvcUXBu4XkC0XyhquFivGYe";
            String secretKey = "bQcxUBc_c8evOPKZMxiJ2luHTROcRha3krWJmvR3";
            String bucket = "mogublogforsjf";
            //...其他参数参考类注释
            UploadManager uploadManager = new UploadManager(cfg);
            String key = getUUID();
            Auth auth = Auth.create(accessKey, secretKey);
            String upToken = auth.uploadToken(bucket);
            File localFilePath = new File(ss);
            Response response = uploadManager.put(localFilePath, key, upToken);
            //解析上传成功的结果
            DefaultPutRet putRet = new Gson().fromJson(response.bodyString(), DefaultPutRet.class);
        }
    }

    @Override
    public void process(Page page) {
        int i = 50;
        //page计数是从2开始的
        //https://foter.com/search/instant/?q=cat&page=2
        Html html = page.getHtml();
        String url = page.getRequest().getUrl();
        List&lt;String&gt; list = html.regex("&lt;img.*?src=.*?photos.*?/&gt;").all();
        List&lt;String&gt; imageSrc = getImageSrc(list);
        String jsonString = JSON.toJSONString(imageSrc);
        if (CollectionUtil.isEmpty(imageSrc)) {
            page.putField("imgSrc", jsonString);
            page.putField("searchKey", findSearchKey(url));
        } else {
            //跳过爬取
            page.setSkip(true);
        }
    }

    @Override
    public Site getSite() {
        return Site.me().setCharset("utf8").setRetryTimes(2).setSleepTime(2000).setTimeOut(4000);
    }

    public String uploadQiniu(File localFilePath) throws QiniuException {
        //构造一个带指定Zone对象的配置类
        Configuration cfg = new Configuration(Zone.zone2());
        //生成上传凭证，然后准备上传
        String accessKey = "KPTcX6IBYXrR8wpE0VvcUXBu4XkC0XyhquFivGYe";
        String secretKey = "bQcxUBc_c8evOPKZMxiJ2luHTROcRha3krWJmvR3";
        String bucket = "mogublogforsjf";
        //...其他参数参考类注释
        UploadManager uploadManager = new UploadManager(cfg);
        String key = getUUID();
        Auth auth = Auth.create(accessKey, secretKey);
        String upToken = auth.uploadToken(bucket);
        Response response = uploadManager.put(localFilePath, key, upToken);
        //解析上传成功的结果
        DefaultPutRet putRet = new Gson().fromJson(response.bodyString(), DefaultPutRet.class);
        return putRet.key;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="97" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.361</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> moguBlog</a><br />
<b> <a> File: </a> </b>  <a> PicturePieline.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mogu_spider\src\main\java\com\moxi\mogublog\spider\pipeline\PicturePieline.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.moxi.mogublog.spider.pipeline;

import cn.hutool.core.collection.CollectionUtil;
import com.alibaba.fastjson.JSON;
import org.springframework.stereotype.Component;
import us.codecraft.webmagic.ResultItems;
import us.codecraft.webmagic.Task;
import us.codecraft.webmagic.pipeline.Pipeline;

import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

/**
 * 图片传输管道
 *
 * @author 陌溪
 * @date 2021年1月8日16:41:32
 */
@Component
public class PicturePieline implements Pipeline {

    //下载图片
    private static List&lt;String&gt; Download(List&lt;String&gt; listImgSrc) {
        //开始时间
        Date begindate = new Date();
        ArrayList&lt;String&gt; localFile = new ArrayList&lt;&gt;();
        try {
            for (String url : listImgSrc) {
                //开始时间
                Date begindate2 = new Date();
                String imageName = url.substring(url.lastIndexOf("/") + 1);
                URL uri = new URL(url);
                HttpURLConnection conn = (HttpURLConnection) uri.openConnection();
                conn.setConnectTimeout(50000);
                conn.setReadTimeout(50000);
                conn.addRequestProperty("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36");
                conn.connect();
                InputStream in = conn.getInputStream();
                String pathname = "D:\\123\\" + imageName;
                File file = new File(pathname);
                FileOutputStream fo = new FileOutputStream(file);//文件输出流
                byte[] buf = new byte[1024];
                int length = 0;
                System.out.println("开始下载:" + url);
                while ((length = in.read(buf, 0, buf.length)) != -1) {
                    fo.write(buf, 0, length);
                }
                //关闭流
                in.close();
                fo.close();
                System.out.println(imageName + "下载完成");
                //结束时间
                Date overdate2 = new Date();
                double time = overdate2.getTime() - begindate2.getTime();
                System.out.println("耗时：" + time / 1000 + "s");
                localFile.add(pathname);
            }
            Date overdate = new Date();
            double time = overdate.getTime() - begindate.getTime();
            System.out.println("总耗时：" + time / 1000 + "s");
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
        return localFile;
    }

    @Override
    public void process(ResultItems resultItems, Task task) {
        //获取图片参数
        String imgSrc = resultItems.get("imgSrc");
        //获取关键词
        String searchKey = resultItems.get("searchKey");
        List imgSrcs = JSON.parseObject(imgSrc, List.class);
        if (CollectionUtil.isEmpty(imgSrcs)) {
            return;
        }
        //下载图片并上传到七牛云
        List localFileUrl = Download(imgSrcs);

    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="98" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.362</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> moguBlog</a><br />
<b> <a> File: </a> </b>  <a> PictureProcesser.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mogu_spider\src\main\java\com\moxi\mogublog\spider\processer\PictureProcesser.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.moxi.mogublog.spider.processer;

import cn.hutool.core.collection.CollectionUtil;
import com.alibaba.fastjson.JSON;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import us.codecraft.webmagic.Page;
import us.codecraft.webmagic.Site;
import us.codecraft.webmagic.processor.PageProcessor;
import us.codecraft.webmagic.selector.Html;

import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * 爬取的图片页面处理
 *
 * @author 陌溪
 * @date 2021年1月8日16:47:34
 */
@Component
@Slf4j
public class PictureProcesser implements PageProcessor {

    // 获取img标签正则
    private static final String IMGURL_REG = "&lt;(img|IMG)(.*?)&gt;";
    // 获取src路径的正则
    private static final String IMGSRC_REG = "(src|SRC)=\"(.*?)\"";

    /**
     * 查找输入的关键词
     *
     * @param url
     * @return
     */
    public static String findSearchKey(String url) {
        // 按指定模式在字符串查找
        String reg = "\\?q=.*";
        // 创建 Pattern 对象
        // 现在创建 matcher对象 匹配的模式
        Pattern pattern = Pattern.compile(reg);
        Matcher m = pattern.matcher(url);
        if (m.find()) {
            String group = m.group(0);
            String replace = group.replace("?q=", "").replaceFirst("&.*", "");
            return replace;
        } else {
            return url;
        }
    }

    //下载图片
    private static List&lt;String&gt; Download(List&lt;String&gt; listImgSrc) {
        //开始时间
        Date begindate = new Date();
        ArrayList&lt;String&gt; localFile = new ArrayList&lt;&gt;();
        try {
            for (String url : listImgSrc) {
                //开始时间
                Date begindate2 = new Date();
                String imageName = url.substring(url.lastIndexOf("/") + 1);
                URL uri = new URL(url);
                HttpURLConnection conn = (HttpURLConnection) uri.openConnection();
                conn.setConnectTimeout(50000);
                conn.setReadTimeout(50000);
                conn.addRequestProperty("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36");
                conn.connect();
                InputStream in = conn.getInputStream();
                String pathname = "D:\\123\\" + imageName;
                File file = new File(pathname);
                FileOutputStream fo = new FileOutputStream(file);//文件输出流
                byte[] buf = new byte[1024];
                int length = 0;
                System.out.println("开始下载:" + url);
                while ((length = in.read(buf, 0, buf.length)) != -1) {
                    fo.write(buf, 0, length);
                }
                //关闭流
                in.close();
                fo.close();
                System.out.println(imageName + "下载完成");
                //结束时间
                Date overdate2 = new Date();
                double time = overdate2.getTime() - begindate2.getTime();
                System.out.println("耗时：" + time / 1000 + "s");
                localFile.add(pathname);
            }
            Date overdate = new Date();
            double time = overdate.getTime() - begindate.getTime();
            System.out.println("总耗时：" + time / 1000 + "s");
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
        return localFile;
    }

    public static void main(String[] args) throws Exception {
        PictureProcesser pictureProcesser = new PictureProcesser();
        String html = pictureProcesser.getHtml("https://www.hippopx.com/zh/query?q=cat");
        List&lt;String&gt; imageUrl = pictureProcesser.getImageUrl(html);
        List&lt;String&gt; imageSrc = pictureProcesser.getImageSrc(imageUrl);
        System.out.println(JSON.toJSONString(imageSrc));
    }

    //获取ImageSrc地址
    public List&lt;String&gt; getImageSrc(List&lt;String&gt; listimageurl) {
        List&lt;String&gt; listImageSrc = new ArrayList&lt;&gt;();
        for (String image : listimageurl) {
            Matcher matcher = Pattern.compile(IMGSRC_REG).matcher(image);
            while (matcher.find()) {
                listImageSrc.add(matcher.group(2).trim());
            }
        }
        return listImageSrc;
    }

    @Override
    public void process(Page page) {
        int i = 50;
        //page计数是从2开始的
        //https://foter.com/search/instant/?q=cat&page=2
        Html html = page.getHtml();
        String url = page.getRequest().getUrl();
        List&lt;String&gt; list = html.regex("&lt;img.*?src=.*?photos.*?/&gt;").all();
        List&lt;String&gt; imageSrc = getImageSrc(list);
        String jsonString = JSON.toJSONString(imageSrc);
        if (CollectionUtil.isEmpty(imageSrc)) {
            page.putField("imgSrc", jsonString);
            page.putField("searchKey", findSearchKey(url));
        } else {
            //跳过爬取
            page.setSkip(true);
        }
    }

    @Override
    public Site getSite() {
        return Site.me().setCharset("utf8").setRetryTimes(2).setSleepTime(2000).setTimeOut(4000);
    }

    /**
     * 解析html
     *
     * @param url
     * @return
     * @throws Exception
     */
    public String getHtml(String url) {
        InputStream in = null;
        InputStreamReader isr = null;
        BufferedReader br = null;
        StringBuffer sb = new StringBuffer();
        try {
            //使用java.net.URL
            URL url1 = new URL(url);
            HttpURLConnection connection = (HttpURLConnection) url1.
                    openConnection();
            connection.setRequestProperty("User-Agent", "Mozilla/4.0 (compatible; MSIE 5.0; Windows NT; DigExt)");
            connection.setRequestProperty("Charsert", "UTF-8");
            connection.setRequestProperty("Accept-Language", "zh-CN,zh;q=0.9,en;q=0.8");
            //获取输入流
            in = connection.getInputStream();
            //流的包装
            isr = new InputStreamReader(in);
            br = new BufferedReader(isr);
            String line;
            //整行读取
            while ((line = br.readLine()) != null) {
                //添加到StringBuffer中
                sb.append(line, 0, line.length());
                //添加换行符
                sb.append('\n');
            }

        } catch (Exception e) {
            log.error("获取图片出现异常:{}", e.getMessage());
            e.printStackTrace();
        } finally {
            //关闭各种流，先声明的后关闭
            try {
                if (in != null) {
                    in.close();
                }
                if (br != null) {
                    br.close();
                }
                if (isr != null) {
                    isr.close();
                }
            } catch (IOException e) {
                log.error("获取图片出现异常:{}", e.getMessage());
                e.printStackTrace();
            }
        }
        return sb.toString();
    }

    //获取ImageUrl地址
    public List&lt;String&gt; getImageUrl(String html) {
        Pattern compile = Pattern.compile(IMGURL_REG);
        Matcher matcher = compile.matcher(html);
        List&lt;String&gt; listimgurl = new ArrayList&lt;&gt;();
        int temp = 0;
        while (matcher.find()) {
            temp ++;
            // 跳过第一张logo图片
            if (temp == 1) {
                continue;
            }
            listimgurl.add(matcher.group());
        }
        return listimgurl;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="99" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.363</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> moguBlog</a><br />
<b> <a> File: </a> </b>  <a> IdWorker.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mogu_spider\src\main\java\com\moxi\mogublog\spider\util\IdWorker.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.moxi.mogublog.spider.util;

import java.lang.management.ManagementFactory;
import java.net.InetAddress;
import java.net.NetworkInterface;

/**
 * &lt;p&gt;名称：IdWorker.java&lt;/p&gt;
 * &lt;p&gt;描述：分布式自增长ID&lt;/p&gt;
 * &lt;pre&gt;
 *     Twitter的 Snowflake　JAVA实现方案
 * &lt;/pre&gt;
 * 核心代码为其IdWorker这个类实现，其原理结构如下，我分别用一个0表示一位，用—分割开部分的作用：
 * 1||0---0000000000 0000000000 0000000000 0000000000 0 --- 00000 ---00000 ---000000000000
 * 在上面的字符串中，第一位为未使用（实际上也可作为long的符号位），接下来的41位为毫秒级时间，
 * 然后5位datacenter标识位，5位机器ID（并不算标识符，实际是为线程标识），
 * 然后12位该毫秒内的当前毫秒内的计数，加起来刚好64位，为一个Long型。
 * 这样的好处是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞（由datacenter和机器ID作区分），
 * 并且效率较高，经测试，snowflake每秒能够产生26万ID左右，完全满足需要。
 * &lt;p&gt;
 * 64位ID (42(毫秒)+5(机器ID)+5(业务编码)+12(重复累加))
 *
 * @author Polim
 */
public class IdWorker {
    /**
     * 时间起始标记点，作为基准，一般取系统的最近时间（一旦确定不能变动）
     */
    private final static long twepoch = 1288834974657L;
    // 机器标识位数
    private final static long workerIdBits = 5L;
    // 数据中心标识位数
    private final static long datacenterIdBits = 5L;
    // 机器ID最大值
    private final static long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits);
    // 数据中心ID最大值
    private final static long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits);
    // 毫秒内自增位
    private final static long sequenceBits = 12L;
    // 机器ID偏左移12位
    private final static long workerIdShift = sequenceBits;
    // 数据中心ID左移17位
    private final static long datacenterIdShift = sequenceBits + workerIdBits;
    // 时间毫秒左移22位
    private final static long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;

    private final static long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits);
    /* 上次生产id时间戳 */
    private static long lastTimestamp = -1L;
    private final long workerId;
    // 数据标识id部分
    private final long datacenterId;
    // 0，并发控制
    private long sequence = 0L;

    public IdWorker() {
        this.datacenterId = getDatacenterId(maxDatacenterId);
        this.workerId = getMaxWorkerId(datacenterId, maxWorkerId);
    }

    /**
     * @param workerId     工作机器ID
     * @param datacenterId 序列号
     */
    public IdWorker(long workerId, long datacenterId) {
        if (workerId &gt; maxWorkerId || workerId &lt; 0) {
            throw new IllegalArgumentException(String.format("worker Id can't be greater than %d or less than 0", maxWorkerId));
        }
        if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) {
            throw new IllegalArgumentException(String.format("datacenter Id can't be greater than %d or less than 0", maxDatacenterId));
        }
        this.workerId = workerId;
        this.datacenterId = datacenterId;
    }

    /**
     * &lt;p&gt;
     * 获取 maxWorkerId
     * &lt;/p&gt;
     */
    protected static long getMaxWorkerId(long datacenterId, long maxWorkerId) {
        StringBuffer mpid = new StringBuffer();
        mpid.append(datacenterId);
        String name = ManagementFactory.getRuntimeMXBean().getName();
        if (!name.isEmpty()) {
            /*
             * GET jvmPid
             */
            mpid.append(name.split("@")[0]);
        }
        /*
         * MAC + PID 的 hashcode 获取16个低位
         */
        return (mpid.toString().hashCode() & 0xffff) % (maxWorkerId + 1);
    }

    /**
     * &lt;p&gt;
     * 数据标识id部分
     * &lt;/p&gt;
     */
    protected static long getDatacenterId(long maxDatacenterId) {
        long id = 0L;
        try {
            InetAddress ip = InetAddress.getLocalHost();
            NetworkInterface network = NetworkInterface.getByInetAddress(ip);
            if (network == null) {
                id = 1L;
            } else {
                byte[] mac = network.getHardwareAddress();
                id = ((0x000000FF & (long) mac[mac.length - 1])
                        | (0x0000FF00 & (((long) mac[mac.length - 2]) &lt;&lt; 8))) &gt;&gt; 6;
                id = id % (maxDatacenterId + 1);
            }
        } catch (Exception e) {
            System.out.println(" getDatacenterId: " + e.getMessage());
        }
        return id;
    }

    public static void main(String[] args) {
        //推特  26万个不重复的ID
        IdWorker idWorker = new IdWorker(0, 0);
        for (int i = 0; i &lt; 2600; i++) {
            System.out.println(idWorker.nextId());
        }
    }

    /**
     * 获取下一个ID
     *
     * @return
     */
    public synchronized long nextId() {
        long timestamp = timeGen();
        if (timestamp &lt; lastTimestamp) {
            throw new RuntimeException(String.format("Clock moved backwards.  Refusing to generate id for %d milliseconds", lastTimestamp - timestamp));
        }

        if (lastTimestamp == timestamp) {
            // 当前毫秒内，则+1
            sequence = (sequence + 1) & sequenceMask;
            if (sequence == 0) {
                // 当前毫秒内计数满了，则等待下一秒
                timestamp = tilNextMillis(lastTimestamp);
            }
        } else {
            sequence = 0L;
        }
        lastTimestamp = timestamp;
        // ID偏移组合生成最终的ID，并返回ID
        long nextId = ((timestamp - twepoch) &lt;&lt; timestampLeftShift)
                | (datacenterId &lt;&lt; datacenterIdShift)
                | (workerId &lt;&lt; workerIdShift) | sequence;

        return nextId;
    }

    private long tilNextMillis(final long lastTimestamp) {
        long timestamp = this.timeGen();
        while (timestamp &lt;= lastTimestamp) {
            timestamp = this.timeGen();
        }
        return timestamp;
    }

    private long timeGen() {
        return System.currentTimeMillis();
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="100" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.364</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> moguBlog</a><br />
<b> <a> File: </a> </b>  <a> IdWorkerUtils.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mogu_utils\src\main\java\com\moxi\mogublog\utils\IdWorkerUtils.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.moxi.mogublog.utils;

import java.lang.management.ManagementFactory;
import java.net.InetAddress;
import java.net.NetworkInterface;

/**
 * &lt;p&gt;名称：IdWorker.java&lt;/p&gt;
 * &lt;p&gt;描述：分布式自增长ID&lt;/p&gt;
 * &lt;pre&gt;
 *     Twitter的 Snowflake　JAVA实现方案
 * &lt;/pre&gt;
 * 核心代码为其IdWorker这个类实现，其原理结构如下，我分别用一个0表示一位，用—分割开部分的作用：
 * 1||0---0000000000 0000000000 0000000000 0000000000 0 --- 00000 ---00000 ---000000000000
 * 在上面的字符串中，第一位为未使用（实际上也可作为long的符号位），接下来的41位为毫秒级时间，
 * 然后5位datacenter标识位，5位机器ID（并不算标识符，实际是为线程标识），
 * 然后12位该毫秒内的当前毫秒内的计数，加起来刚好64位，为一个Long型。
 * 这样的好处是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞（由datacenter和机器ID作区分），
 * 并且效率较高，经测试，snowflake每秒能够产生26万ID左右，完全满足需要。
 * &lt;p&gt;
 * 64位ID (42(毫秒)+5(机器ID)+5(业务编码)+12(重复累加))
 *
 * @author Polim
 */
public class IdWorkerUtils {
    // 时间起始标记点，作为基准，一般取系统的最近时间（一旦确定不能变动）
    private final static long twepoch = 1288834974657L;
    // 机器标识位数
    private final static long workerIdBits = 5L;
    // 数据中心标识位数
    private final static long datacenterIdBits = 5L;
    // 机器ID最大值
    private final static long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits);
    // 数据中心ID最大值
    private final static long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits);
    // 毫秒内自增位
    private final static long sequenceBits = 12L;
    // 机器ID偏左移12位
    private final static long workerIdShift = sequenceBits;
    // 数据中心ID左移17位
    private final static long datacenterIdShift = sequenceBits + workerIdBits;
    // 时间毫秒左移22位
    private final static long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;

    private final static long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits);
    /* 上次生产id时间戳 */
    private static long lastTimestamp = -1L;
    private final long workerId;
    // 数据标识id部分
    private final long datacenterId;
    // 0，并发控制
    private long sequence = 0L;

    public IdWorkerUtils() {
        this.datacenterId = getDatacenterId(maxDatacenterId);
        this.workerId = getMaxWorkerId(datacenterId, maxWorkerId);
    }

    /**
     * @param workerId     工作机器ID
     * @param datacenterId 序列号
     */
    public IdWorkerUtils(long workerId, long datacenterId) {
        if (workerId &gt; maxWorkerId || workerId &lt; 0) {
            throw new IllegalArgumentException(String.format("worker Id can't be greater than %d or less than 0", maxWorkerId));
        }
        if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) {
            throw new IllegalArgumentException(String.format("datacenter Id can't be greater than %d or less than 0", maxDatacenterId));
        }
        this.workerId = workerId;
        this.datacenterId = datacenterId;
    }

    /**
     * &lt;p&gt;
     * 获取 maxWorkerId
     * &lt;/p&gt;
     */
    protected static long getMaxWorkerId(long datacenterId, long maxWorkerId) {
        StringBuffer mpid = new StringBuffer();
        mpid.append(datacenterId);
        String name = ManagementFactory.getRuntimeMXBean().getName();
        if (!name.isEmpty()) {
            /*
             * GET jvmPid
             */
            mpid.append(name.split("@")[0]);
        }
        /*
         * MAC + PID 的 hashcode 获取16个低位
         */
        return (mpid.toString().hashCode() & 0xffff) % (maxWorkerId + 1);
    }

    /**
     * &lt;p&gt;
     * 数据标识id部分
     * &lt;/p&gt;
     */
    protected static long getDatacenterId(long maxDatacenterId) {
        long id = 0L;
        try {
            InetAddress ip = InetAddress.getLocalHost();
            NetworkInterface network = NetworkInterface.getByInetAddress(ip);
            if (network == null) {
                id = 1L;
            } else {
                byte[] mac = network.getHardwareAddress();
                id = ((0x000000FF & (long) mac[mac.length - 1])
                        | (0x0000FF00 & (((long) mac[mac.length - 2]) &lt;&lt; 8))) &gt;&gt; 6;
                id = id % (maxDatacenterId + 1);
            }
        } catch (Exception e) {
            System.out.println(" getDatacenterId: " + e.getMessage());
        }
        return id;
    }

    /**
     * 获取下一个ID
     *
     * @return
     */
    public synchronized long nextId() {
        long timestamp = timeGen();
        if (timestamp &lt; lastTimestamp) {
            throw new RuntimeException(String.format("Clock moved backwards.  Refusing to generate id for %d milliseconds", lastTimestamp - timestamp));
        }

        if (lastTimestamp == timestamp) {
            // 当前毫秒内，则+1
            sequence = (sequence + 1) & sequenceMask;
            if (sequence == 0) {
                // 当前毫秒内计数满了，则等待下一秒
                timestamp = tilNextMillis(lastTimestamp);
            }
        } else {
            sequence = 0L;
        }
        lastTimestamp = timestamp;
        // ID偏移组合生成最终的ID，并返回ID
        long nextId = ((timestamp - twepoch) &lt;&lt; timestampLeftShift)
                | (datacenterId &lt;&lt; datacenterIdShift)
                | (workerId &lt;&lt; workerIdShift) | sequence;

        return nextId;
    }

    private long tilNextMillis(final long lastTimestamp) {
        long timestamp = this.timeGen();
        while (timestamp &lt;= lastTimestamp) {
            timestamp = this.timeGen();
        }
        return timestamp;
    }

    private long timeGen() {
        return System.currentTimeMillis();
    }


}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="101" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.365</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> moguBlog</a><br />
<b> <a> File: </a> </b>  <a> SnowflakeIdWorker.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mogu_utils\src\main\java\com\moxi\mogublog\utils\SnowflakeIdWorker.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.moxi.mogublog.utils;

/**
 * 雪花ID生成器
 *
 * @author: 陌溪
 * @create: 2020-11-13-10:36
 *
 * Twitter开源的分布式Id生成器，使用雪花算法
 * SnowFlake的结构如下(每部分用-分开):&lt;br&gt;
 * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt;
 * 1位标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是0，负数是1，所以id一般是正数，最高位是0&lt;br&gt;
 * 41位时间截(毫秒级)，注意，41位时间截不是存储当前时间的时间截，而是存储时间截的差值（当前时间截 - 开始时间截)
 * 得到的值），这里的的开始时间截，一般是我们的id生成器开始使用的时间，
 * 由我们程序来指定的（如下下面程序IdWorker类的startTime属性）。41位的时间截，
 * 可以使用69年，年T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt;
 * 10位的数据机器位，可以部署在1024个节点，包括5位datacenterId和5位workerId&lt;br&gt;
 * 12位序列，毫秒内的计数，12位的计数顺序号支持每个节点每毫秒(同一机器，同一时间截)产生4096个ID序号&lt;br&gt;
 * 加起来刚好64位，为一个Long型。&lt;br&gt;
 * SnowFlake的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据中心ID和机器ID作区分)，
 * 并且效率较高，经测试，SnowFlake每秒能够产生26万ID左右
 */
public class SnowflakeIdWorker {
    // ==============================Fields===========================================
    /**
     * 开始时间截 (2015-01-01)
     */
    private final long twepoch = 1420041600000L;

    /**
     * 机器id所占的位数 默认5L
     */
    private final long workerIdBits = 5L;

    /**
     * 数据标识id所占的位数 默认5L
     */
    private final long dataCenterIdBits = 5L;

    /**
     * 序列在id中占的位数 默认12L
     */
    private final long sequenceBits = 12L;

    /**
     * 支持的最大机器id，结果是31 (这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数)
     */
    private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits);

    /**
     * 支持的最大数据标识id，结果是31
     */
    private final long maxDataCenterId = -1L ^ (-1L &lt;&lt; dataCenterIdBits);

    /**
     * 机器ID向左移12位
     */
    private final long workerIdShift = sequenceBits;

    /**
     * 数据标识id向左移17位(12+5)
     */
    private final long datacenterIdShift = sequenceBits + workerIdBits;

    /**
     * 时间截向左移22位(5+5+12)
     */
    private final long timestampLeftShift = sequenceBits + workerIdBits + dataCenterIdBits;

    /**
     * 生成序列的掩码，这里为4095 (0b111111111111=0xfff=4095)
     */
    private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits);

    /**
     * 工作机器ID(0~31)
     */
    private long workerId ;

    /**
     * 数据中心ID(0~31)
     */
    private long dataCenterId;

    /**
     * 毫秒内序列(0~4095)
     */
    private long sequence = 0L;

    /**
     * 上次生成ID的时间截
     */
    private long lastTimestamp = -1L;

    //==============================Constructors=====================================

    /**
     * 构造函数
     *
     * @param workerId     工作ID (0~31)
     * @param dataCenterId 数据中心ID (0~31)
     */

    public SnowflakeIdWorker(long workerId, long dataCenterId) {
        if (workerId &gt; maxWorkerId || workerId &lt; 0) {
            throw new IllegalArgumentException(String.format("worker Id can't be greater than %d or less than 0", maxWorkerId));
        }
        if (dataCenterId &gt; maxDataCenterId || dataCenterId &lt; 0) {
            throw new IllegalArgumentException(String.format("datacenter Id can't be greater than %d or less than 0", maxDataCenterId));
        }
        this.workerId = workerId;
        this.dataCenterId = dataCenterId;
    }

    // ==============================Methods==========================================

    /**
     * 获得下一个ID (该方法是线程安全的)
     *
     * @return SnowflakeId
     */
    public synchronized long nextId() {
        long timestamp = timeGen();

        //如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常
        if (timestamp &lt; lastTimestamp) {
            throw new RuntimeException(
                    String.format("Clock moved backwards.  Refusing to generate id for %d milliseconds", lastTimestamp - timestamp));
        }

        //如果是同一时间生成的，则进行毫秒内序列
        if (lastTimestamp == timestamp) {
            sequence = (sequence + 1) & sequenceMask;
            //毫秒内序列溢出
            if (sequence == 0) {
                //阻塞到下一个毫秒,获得新的时间戳
                timestamp = tilNextMillis(lastTimestamp);
            }
        }
        //时间戳改变，毫秒内序列重置
        else {
            sequence = 0L;
        }

        //上次生成ID的时间截
        lastTimestamp = timestamp;

        //移位并通过或运算拼到一起组成64位的ID
        return ((timestamp - twepoch) &lt;&lt; timestampLeftShift)
                | (dataCenterId &lt;&lt; datacenterIdShift)
                | (workerId &lt;&lt; workerIdShift)
                | sequence;
    }

    /**
     * 阻塞到下一个毫秒，直到获得新的时间戳
     *
     * @param lastTimestamp 上次生成ID的时间截
     * @return 当前时间戳
     */
    private long tilNextMillis(long lastTimestamp) {
        long timestamp = timeGen();
        while (timestamp &lt;= lastTimestamp) {
            timestamp = timeGen();
        }
        return timestamp;
    }

    /**
     * 返回以毫秒为单位的当前时间
     *
     * @return 当前时间(毫秒)
     */
    private long timeGen() {
        return System.currentTimeMillis();
    }


    /**
     * 测试
     */
    public static void main(String[] args) {
        SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0);
        for (int i = 0; i &lt; 1000; i++) {
            long id = idWorker.nextId();
            System.out.println(Long.toBinaryString(id));
            System.out.println(id);
        }
    }
}

</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="102" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.368</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> HttpUtils.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_blog\src\main\java\com\fly\blog\util\HttpUtils.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.blog.util;


import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;
import java.util.Enumeration;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * Description: &lt;&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
public class HttpUtils {


    /**
     * 尝试获取当前请求的HttpServletRequest实例
     *
     * @return HttpServletRequest
     */
    public static HttpServletRequest getHttpServletRequest() {
        try {
            return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        } catch (Exception e) {
            return null;
        }
    }


    public static Map&lt;String, String&gt; getHeaders(HttpServletRequest request) {
        Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();
        Enumeration&lt;String&gt; enumeration = request.getHeaderNames();
        while (enumeration.hasMoreElements()) {
            String key = enumeration.nextElement();
            String value = request.getHeader(key);
            map.put(key, value);
        }
        return map;
    }

    /**
     * 获取请求客户端的真实ip地址
     *
     * @param request 请求对象
     * @return ip地址
     */
    public static String getIpAddress(HttpServletRequest request) {

        // 获取请求主机IP地址,如果通过代理进来，则透过防火墙获取真实IP地址
        String ip = request.getHeader("X-Forwarded-For");

        if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("Proxy-Client-IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("WL-Proxy-Client-IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("HTTP_CLIENT_IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("HTTP_X_FORWARDED_FOR");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getRemoteAddr();
            }
        } else if (ip.length() &gt; 15) {
            String[] ips = ip.split(",");
            for (int index = 0; index &lt; ips.length; index++) {
                String strIp = (String) ips[index];
                if (!("unknown".equalsIgnoreCase(strIp))) {
                    ip = strIp;
                    break;
                }
            }
        }
        return ip;
    }

    /**
     * 获取请求客户端的真实ip地址
     *
     * @param
     * @return ip地址
     */
    public static String getIpAddress() {
        // 获取请求主机IP地址,如果通过代理进来，则透过防火墙获取真实IP地址
        return getIpAddress(getHttpServletRequest());
    }

    


}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="103" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.369</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> UserUtils.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_blog\src\main\java\com\fly\blog\util\UserUtils.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.blog.util;


import org.springframework.security.core.Authentication;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.context.SecurityContextHolder;

import java.util.List;

/**
 * Description: &lt;&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
public class UserUtils {

    private static final String AUTHORIZATION = "authorization";

    /**
     * 获取当前请求的token
     *
     * @return
     */
    public static String getCurrentToken() {
        return HttpUtils.getHeaders(HttpUtils.getHttpServletRequest()).get(AUTHORIZATION);
    }

    /**
     * 获取当前请求的用户Id
     *
     * @return
     */
    public static String getCurrentPrinciple() {
        return (String) SecurityContextHolder.getContext().getAuthentication().getPrincipal();
    }

    /**
     * 判读当前token用户是否为接口所需的参数username
     *
     * @param username
     * @return
     */
    public static boolean isMyself(String username) {
        return username.equals(getCurrentPrinciple());
    }

    /**
     * 获取当前请求Authentication
     *
     * @return
     */
    public static Authentication getCurrentAuthentication() {
        return SecurityContextHolder.getContext().getAuthentication();
    }

    /**
     * 获取当前请求的权限信息
     *
     * @return
     */
    public static List&lt;SimpleGrantedAuthority&gt; getCurrentAuthorities() {
        return (List&lt;SimpleGrantedAuthority&gt;) SecurityContextHolder.getContext().getAuthentication().getAuthorities();
    }

    /**
     * @param role
     * @return
     */
    public static boolean hasRole(String role) {
        if (!role.startsWith("ROLE_")) {
            role = "ROLE_" + role;
        }
        boolean hasRole = false;
        List&lt;SimpleGrantedAuthority&gt; list = getCurrentAuthorities();
        for (SimpleGrantedAuthority s : list) {
            if (role.equals(s.getAuthority())) {
                hasRole = true;
                break;
            }
        }
        return hasRole;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="104" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.372</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> HttpUtils.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_news\src\main\java\com\fly\news\util\HttpUtils.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.news.util;


import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;
import java.util.Enumeration;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * Description: &lt;&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
public class HttpUtils {


    /**
     * 尝试获取当前请求的HttpServletRequest实例
     *
     * @return HttpServletRequest
     */
    public static HttpServletRequest getHttpServletRequest() {
        try {
            return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        } catch (Exception e) {
            return null;
        }
    }


    public static Map&lt;String, String&gt; getHeaders(HttpServletRequest request) {
        Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();
        Enumeration&lt;String&gt; enumeration = request.getHeaderNames();
        while (enumeration.hasMoreElements()) {
            String key = enumeration.nextElement();
            String value = request.getHeader(key);
            map.put(key, value);
        }
        return map;
    }

    /**
     * 获取请求客户端的真实ip地址
     *
     * @param request 请求对象
     * @return ip地址
     */
    public static String getIpAddress(HttpServletRequest request) {

        // 获取请求主机IP地址,如果通过代理进来，则透过防火墙获取真实IP地址
        String ip = request.getHeader("X-Forwarded-For");

        if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("Proxy-Client-IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("WL-Proxy-Client-IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("HTTP_CLIENT_IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("HTTP_X_FORWARDED_FOR");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getRemoteAddr();
            }
        } else if (ip.length() &gt; 15) {
            String[] ips = ip.split(",");
            for (int index = 0; index &lt; ips.length; index++) {
                String strIp = (String) ips[index];
                if (!("unknown".equalsIgnoreCase(strIp))) {
                    ip = strIp;
                    break;
                }
            }
        }
        return ip;
    }

    /**
     * 获取请求客户端的真实ip地址
     *
     * @param
     * @return ip地址
     */
    public static String getIpAddress() {
        // 获取请求主机IP地址,如果通过代理进来，则透过防火墙获取真实IP地址
        return getIpAddress(getHttpServletRequest());
    }

    


}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="105" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.373</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> UserUtils.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_news\src\main\java\com\fly\news\util\UserUtils.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.news.util;


import org.springframework.security.core.Authentication;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.context.SecurityContextHolder;

import java.util.List;

/**
 * Description: &lt;&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
public class UserUtils {

    private static final String AUTHORIZATION = "authorization";

    /**
     * 获取当前请求的token
     *
     * @return
     */
    public static String getCurrentToken() {
        return HttpUtils.getHeaders(HttpUtils.getHttpServletRequest()).get(AUTHORIZATION);
    }

    /**
     * 获取当前请求的用户Id
     *
     * @return
     */
    public static String getCurrentPrinciple() {
        return (String) SecurityContextHolder.getContext().getAuthentication().getPrincipal();
    }

    /**
     * 判读当前token用户是否为接口所需的参数username
     *
     * @param username
     * @return
     */
    public static boolean isMyself(String username) {
        return username.equals(getCurrentPrinciple());
    }

    /**
     * 获取当前请求Authentication
     *
     * @return
     */
    public static Authentication getCurrentAuthentication() {
        return SecurityContextHolder.getContext().getAuthentication();
    }

    /**
     * 获取当前请求的权限信息
     *
     * @return
     */
    public static List&lt;SimpleGrantedAuthority&gt; getCurrentAuthorities() {
        return (List&lt;SimpleGrantedAuthority&gt;) SecurityContextHolder.getContext().getAuthentication().getAuthorities();
    }

    /**
     * @param role
     * @return
     */
    public static boolean hasRole(String role) {
        if (!role.startsWith("ROLE_")) {
            role = "ROLE_" + role;
        }
        boolean hasRole = false;
        List&lt;SimpleGrantedAuthority&gt; list = getCurrentAuthorities();
        for (SimpleGrantedAuthority s : list) {
            if (role.equals(s.getAuthority())) {
                hasRole = true;
                break;
            }
        }
        return hasRole;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="106" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.376</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> HttpUtils.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_user\src\main\java\com\fly\user\util\HttpUtils.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.user.util;



import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;
import javax.servlet.http.HttpServletRequest;
import java.util.Enumeration;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * Description: &lt;HttpUtils&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
public class HttpUtils {


    /**
     * 尝试获取当前请求的HttpServletRequest实例
     *
     * @return HttpServletRequest
     */
    public static HttpServletRequest getHttpServletRequest() {
        try {
            return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        } catch (Exception e) {
            return null;
        }
    }


    public static Map&lt;String, String&gt; getHeaders(HttpServletRequest request) {
        Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();
        Enumeration&lt;String&gt; enumeration = request.getHeaderNames();
        while (enumeration.hasMoreElements()) {
            String key = enumeration.nextElement();
            String value = request.getHeader(key);
            map.put(key, value);
        }
        return map;
    }

    /**
     * 获取请求客户端的真实ip地址
     *
     * @param request 请求对象
     * @return ip地址
     */
    public static String getIpAddress(HttpServletRequest request) {

        // 获取请求主机IP地址,如果通过代理进来，则透过防火墙获取真实IP地址
        String ip = request.getHeader("X-Forwarded-For");

        if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("Proxy-Client-IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("WL-Proxy-Client-IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("HTTP_CLIENT_IP");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getHeader("HTTP_X_FORWARDED_FOR");
            }
            if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
                ip = request.getRemoteAddr();
            }
        } else if (ip.length() &gt; 15) {
            String[] ips = ip.split(",");
            for (int index = 0; index &lt; ips.length; index++) {
                String strIp = (String) ips[index];
                if (!("unknown".equalsIgnoreCase(strIp))) {
                    ip = strIp;
                    break;
                }
            }
        }
        return ip;
    }

    /**
     * 获取请求客户端的真实ip地址
     *
     * @param
     * @return ip地址
     */
    public static String getIpAddress() {
        // 获取请求主机IP地址,如果通过代理进来，则透过防火墙获取真实IP地址
        return getIpAddress(getHttpServletRequest());
    }


}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="107" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.377</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> UserUtils.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Utility File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_user\src\main\java\com\fly\user\util\UserUtils.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.user.util;


import org.springframework.security.core.Authentication;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.context.SecurityContextHolder;
import java.util.List;

/**
 * Description: &lt;UserUtils&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
public class UserUtils {

    private static final String AUTHORIZATION = "authorization";

    /**
     * 获取当前请求的token
     * @return
     */
    public static String getCurrentToken() {
        return HttpUtils.getHeaders(HttpUtils.getHttpServletRequest()).get(AUTHORIZATION);
    }

    /**
     * 获取当前请求的用户Id
     * @return
     */
    public static String getCurrentPrinciple() {
        return (String) SecurityContextHolder.getContext().getAuthentication().getPrincipal();
    }

    /**
     * 判读当前token用户是否为接口所需的参数username
     *
     * @param username
     * @return
     */
    public static boolean isMyself(String username) {
        return username.equals(getCurrentPrinciple());
    }

    /**
     * 获取当前请求Authentication
     *
     * @return
     */
    public static Authentication getCurrentAuthentication() {
        return SecurityContextHolder.getContext().getAuthentication();
    }

    /**
     * 获取当前请求的权限信息
     * @return
     */
    public static List&lt;SimpleGrantedAuthority&gt; getCurrentAuthorities() {
        return (List&lt;SimpleGrantedAuthority&gt;) SecurityContextHolder.getContext().getAuthentication().getAuthorities();
    }

    /**
     * @param role
     * @return
     */
    public static boolean hasRole(String role) {
        if (!role.startsWith("ROLE_")) {
            role = "ROLE_" + role;
        }
        boolean hasRole = false;
        List&lt;SimpleGrantedAuthority&gt; list = getCurrentAuthorities();
        for (SimpleGrantedAuthority s : list) {
            if (role.equals(s.getAuthority())) {
                hasRole = true;
                break;
            }
        }
        return hasRole;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>



                        <div>
                            <div id="divpager-3"></div>
                        </div>
                    </div>
                    <div class="layui-tab-item">

<div class="layui-card" id="108" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.247</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> HeaderGenerator.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>order-service\src\main\java\com\rainbowforest\orderservice\http\header\HeaderGenerator.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.rainbowforest.orderservice.http.header;

import java.net.URI;
import java.net.URISyntaxException;
import javax.servlet.http.HttpServletRequest;
import org.springframework.http.HttpHeaders;
import org.springframework.stereotype.Service;

@Service
public class HeaderGenerator {
	
	public HttpHeaders getHeadersForSuccessGetMethod() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForError() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/problem+json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForSuccessPostMethod(HttpServletRequest request, Long newResourceId) {
		HttpHeaders httpHeaders = new HttpHeaders();
		try {
			httpHeaders.setLocation(new URI(request.getRequestURI() + "/" + newResourceId));
		} catch (URISyntaxException e) {
			e.printStackTrace();
		}
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="109" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.249</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> HeaderGenerator.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>product-catalog-service\src\main\java\com\rainbowforest\productcatalogservice\http\header\HeaderGenerator.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.rainbowforest.productcatalogservice.http.header;

import java.net.URI;
import java.net.URISyntaxException;

import javax.servlet.http.HttpServletRequest;

import org.springframework.http.HttpHeaders;
import org.springframework.stereotype.Service;

@Service
public class HeaderGenerator {
	
	public HttpHeaders getHeadersForSuccessGetMethod() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForError() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/problem+json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForSuccessPostMethod(HttpServletRequest request, Long newResourceId) {
		HttpHeaders httpHeaders = new HttpHeaders();
		try {
			httpHeaders.setLocation(new URI(request.getRequestURI() + "/" + newResourceId));
		} catch (URISyntaxException e) {
			e.printStackTrace();
		}
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="110" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.251</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> HeaderGenerator.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>product-recommendation-service\src\main\java\com\rainbowforest\recommendationservice\http\header\HeaderGenerator.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.rainbowforest.recommendationservice.http.header;

import java.net.URI;
import java.net.URISyntaxException;

import javax.servlet.http.HttpServletRequest;

import org.springframework.http.HttpHeaders;
import org.springframework.stereotype.Service;

@Service
public class HeaderGenerator {
	
	public HttpHeaders getHeadersForSuccessGetMethod() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForError() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/problem+json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForSuccessPostMethod(HttpServletRequest request, Long newResourceId) {
		HttpHeaders httpHeaders = new HttpHeaders();
		try {
			httpHeaders.setLocation(new URI(request.getRequestURI() + "/" + newResourceId));
		} catch (URISyntaxException e) {
			e.printStackTrace();
		}
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="111" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.253</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> e-commerce</a><br />
<b> <a> File: </a> </b>  <a> HeaderGenerator.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>user-service\src\main\java\com\rainbowforest\userservice\http\header\HeaderGenerator.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.rainbowforest.userservice.http.header;

import java.net.URI;
import java.net.URISyntaxException;
import javax.servlet.http.HttpServletRequest;
import org.springframework.http.HttpHeaders;
import org.springframework.stereotype.Service;

@Service
public class HeaderGenerator {
	
	public HttpHeaders getHeadersForSuccessGetMethod() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForError() {
		HttpHeaders httpHeaders = new HttpHeaders();
		httpHeaders.add("Content-Type", "application/problem+json; charset=UTF-8");
		return httpHeaders;
	}
	
	public HttpHeaders getHeadersForSuccessPostMethod(HttpServletRequest request, Long newResourceId) {
		HttpHeaders httpHeaders = new HttpHeaders();
		try {
			httpHeaders.setLocation(new URI(request.getRequestURI() + "/" + newResourceId));
		} catch (URISyntaxException e) {
			e.printStackTrace();
		}
		httpHeaders.add("Content-Type", "application/json; charset=UTF-8");
		return httpHeaders;
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="112" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.254</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> swarm</a><br />
<b> <a> File: </a> </b>  <a> FlagValidatorClass.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mall-admin\src\main\java\com\macro\mall\validator\FlagValidatorClass.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.macro.mall.validator;

import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;

/**
 * 状态标记校验器
 * Created by macro on 2018/4/26.
 */
public class FlagValidatorClass implements ConstraintValidator&lt;FlagValidator,Integer&gt; {
    private String[] values;
    @Override
    public void initialize(FlagValidator flagValidator) {
        this.values = flagValidator.value();
    }

    @Override
    public boolean isValid(Integer value, ConstraintValidatorContext constraintValidatorContext) {
        boolean isValid = false;
        if(value==null){
            //当状态为空时使用默认值
            return true;
        }
        for(int i=0;i&lt;values.length;i++){
            if(values[i].equals(String.valueOf(value))){
                isValid = true;
                break;
            }
        }
        return isValid;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="113" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.255</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> swarm</a><br />
<b> <a> File: </a> </b>  <a> FlagValidatorClass.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>mall-demo\src\main\java\com\macro\mall\demo\validator\FlagValidatorClass.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.macro.mall.demo.validator;

import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;

/**
 * 状态标记校验器
 */
public class FlagValidatorClass implements ConstraintValidator&lt;FlagValidator,Integer&gt; {
    private String[] values;
    @Override
    public void initialize(FlagValidator flagValidator) {
        this.values = flagValidator.value();
    }

    @Override
    public boolean isValid(Integer value, ConstraintValidatorContext constraintValidatorContext) {
        boolean isValid = false;
        for(int i=0;i&lt;values.length;i++){
            if(values[i].equals(String.valueOf(value))){
                isValid = true;
                break;
            }
        }
        return isValid;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="114" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.272</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> NetworkDisk</a><br />
<b> <a> File: </a> </b>  <a> PreFilter.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pan-core-service\pan-core-zuul\src\main\java\top\quhailong\pan\core\zuul\filter\PreFilter.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package top.quhailong.pan.core.zuul.filter;

import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import io.jsonwebtoken.Claims;
import org.apache.commons.codec.binary.Base64;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;
import top.quhailong.pan.response.UserInfoDTO;
import top.quhailong.pan.utils.CookieUtils;
import top.quhailong.pan.utils.JSONUtils;
import top.quhailong.pan.utils.JWTUtils;

import javax.servlet.http.HttpServletRequest;

/**
 * token过滤器，校验token必输项方法，token不能为空
 *
 * @author guooo
 */
@Component
public class PreFilter extends ZuulFilter {

    private static Logger log = LoggerFactory.getLogger(PreFilter.class);

    /*
     * 过滤器的具体逻辑。可用很复杂，包括查sql，nosql去判断该请求到底有没有权限访问。
     *
     * @see com.netflix.zuul.IZuulFilter#run()
     */
    private String getBase64Credentials(String username, String password) {
        String plainCreds = username + ":" + password;
        byte[] plainCredsBytes = plainCreds.getBytes();
        byte[] base64CredsBytes = Base64.encodeBase64(plainCredsBytes);
        return new String(base64CredsBytes);
    }
    @Override
    public Object run() {
        RequestContext ctx = RequestContext.getCurrentContext();
        ctx.addZuulRequestHeader("Authorization","Basic " + getBase64Credentials("admin","admin123"));
        HttpServletRequest request = ctx.getRequest();
        String curOrigin = request.getHeader("Origin");
        log.info(String.format("%s &gt;&gt;&gt; %s &gt;&gt;&gt; %s", request.getMethod(), request.getRequestURI(), curOrigin));
        if (request.getRequestURI().contains("/api/user")) {
            if (request.getRequestURI().contains("logout") || request.getRequestURI().contains("changepwd") || request.getRequestURI().contains("loadimg") || request.getRequestURI().contains("uploadpic")) {
                verifyToken(ctx);
            }
        }
        if(request.getRequestURI().contains("/api/core")){
            verifyToken(ctx);
        }

        //---------------------------------------------------------------------------------------------------------------------------------------
            /*if (request.getRequestURI().contains("/regcheckusername") || request.getRequestURI().contains("/regcheckphone") || request.getRequestURI().contains("/getpass") || request.getRequestURI().contains("/css") || request.getRequestURI().contains("/js") || request.getRequestURI().contains("/css") || request.getRequestURI().contains("/images")) {
                ctx.setSendZuulResponse(true);
                return null;
            }
            InputStream in = (InputStream) ctx.get("requestEntity");
            if (in == null) {
                in = ctx.getRequest().getInputStream();
            }
            String token = null;
            if (request.getRequestURI().equals("/api/edge/getpublickey")) {
                ctx.setSendZuulResponse(true);
                return null;
            }
            if (!request.getRequestURI().contains("getverfyimg") && !request.getRequestURI().contains("regsmscodestr")) {
                if (!request.getContentType().contains("multipart/form-data")) {
                    token = ctx.getRequest().getParameter("token");
                } else {
                    Part part = request.getPart("token");
                    InputStream name = part.getInputStream();
                    token = StreamUtils.copyToString(name, Charset.forName("UTF-8"));
                }
            }
            if (request.getRequestURI().equals("/api/user/logout") || request.getRequestURI().equals("/api/user/changepwd") || request.getRequestURI().equals("/api/user/uploadpic") || request.getRequestURI().equals("/api/user/loadimg")) {
                Claims claims = JWTUtils.parseJWT(token, "nimadetou".getBytes());
                String subject = claims.getSubject();
                Userinfo userinfo = JsonUtils.jsonToPojo(subject, Userinfo.class);
                log.info(userinfo.getUid());
                ctx.setSendZuulResponse(true);
                return null;
            } else {
                ctx.setSendZuulResponse(true);
                return null;
            }*/
        return null;
    }

    private void verifyToken(RequestContext ctx) {
        try {
            String token = CookieUtils.getCookie("token");
            Claims claims = JWTUtils.parseJWT(token, "nimadetou".getBytes());
            String subject = claims.getSubject();
            UserInfoDTO userinfo = JSONUtils.parseObject(subject, UserInfoDTO.class);
            log.info(userinfo.getUserId());
            ctx.setSendZuulResponse(true);
        } catch (Exception e) {
            ctx.setSendZuulResponse(false);
        }
    }

    /*
     * 这里可以写逻辑判断，是否要过滤，本文true,永远过滤。
     *
     * @see com.netflix.zuul.IZuulFilter#shouldFilter()
     */
    @Override
    public boolean shouldFilter() {
        return true;
    }

    @Override
    public int filterOrder() {
        return 0;
    }

    /*
     * (non-Javadoc) pre：路由之前 routing：路由之时 post： 路由之后 error：发送错误调用
     *
     * @see com.netflix.zuul.ZuulFilter#filterType()
     */
    @Override
    public String filterType() {
        return "pre";
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="115" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.274</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> NetworkDisk</a><br />
<b> <a> File: </a> </b>  <a> PreFilter.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>pan-file-service\pan-file-zuul\src\main\java\top\quhailong\pan\file\zuul\filter\PreFilter.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package top.quhailong.pan.file.zuul.filter;

import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import io.jsonwebtoken.Claims;
import org.apache.commons.codec.binary.Base64;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;
import top.quhailong.pan.response.UserInfoDTO;
import top.quhailong.pan.utils.CookieUtils;
import top.quhailong.pan.utils.JSONUtils;
import top.quhailong.pan.utils.JWTUtils;

import javax.servlet.http.HttpServletRequest;

/**
 * token过滤器，校验token必输项方法，token不能为空
 *
 * @author guooo
 */
@Component
public class PreFilter extends ZuulFilter {

    private static Logger log = LoggerFactory.getLogger(PreFilter.class);

    /*
     * 过滤器的具体逻辑。可用很复杂，包括查sql，nosql去判断该请求到底有没有权限访问。
     *
     * @see com.netflix.zuul.IZuulFilter#run()
     */
    private String getBase64Credentials(String username, String password) {
        String plainCreds = username + ":" + password;
        byte[] plainCredsBytes = plainCreds.getBytes();
        byte[] base64CredsBytes = Base64.encodeBase64(plainCredsBytes);
        return new String(base64CredsBytes);
    }

    @Override
    public Object run() {
        RequestContext ctx = RequestContext.getCurrentContext();
        try {
            HttpServletRequest request = ctx.getRequest();
            ctx.addZuulRequestHeader("Authorization", "Basic " + getBase64Credentials("admin", "admin123"));
            String curOrigin = request.getHeader("Origin");
            log.info(String.format("%s &gt;&gt;&gt; %s &gt;&gt;&gt; %s", request.getMethod(), request.getRequestURI().toString(), curOrigin));
            if (request.getRequestURI().contains("/api/file")) {
                verifyToken(ctx);
            }
            /*String token = ctx.getRequest().getParameter("token");
            InputStream in = (InputStream) ctx.get("requestEntity");
            if (in == null) {
                in = ctx.getRequest().getInputStream();
            }
            if (!StringUtils.isEmpty(token)) {
                Claims claims = JWTUtils.parseJWT(token, "nimadetou".getBytes());
                String subject = claims.getSubject();
                Userinfo userinfo = JSONUtils.parseObject(subject, Userinfo.class);
                String body = StreamUtils.copyToString(in, Charset.forName("UTF-8"));
                body = StringUtils.replace(body, "token=" + token, "uid=" + userinfo.getUid());
                final byte[] reqBodyBytes = body.getBytes();
                ctx.setRequest(new HttpServletRequestWrapper(request) {
                    @Override
                    public ServletInputStream getInputStream() throws IOException {
                        return new ServletInputStreamWrapper(reqBodyBytes);
                    }

                    @Override
                    public int getContentLength() {
                        return reqBodyBytes.length;
                    }

                    @Override
                    public long getContentLengthLong() {
                        return reqBodyBytes.length;
                    }
                });
                ctx.setSendZuulResponse(true);
                return null;
            } else {
                ctx.setSendZuulResponse(false);
                return null;
            }*/
            return null;
        } catch (Exception e) {
            ctx.setSendZuulResponse(false);
            return null;
        }

    }

    private void verifyToken(RequestContext ctx) {
        try {
            String token = CookieUtils.getCookie("token");
            Claims claims = JWTUtils.parseJWT(token, "nimadetou".getBytes());
            String subject = claims.getSubject();
            UserInfoDTO userinfo = JSONUtils.parseObject(subject, UserInfoDTO.class);
            log.info(userinfo.getUserId());
            ctx.setSendZuulResponse(true);
        } catch (Exception e) {
            ctx.setSendZuulResponse(false);
        }
    }

    /*
     * 这里可以写逻辑判断，是否要过滤，本文true,永远过滤。
     *
     * @see com.netflix.zuul.IZuulFilter#shouldFilter()
     */
    @Override
    public boolean shouldFilter() {
        return true;
    }

    @Override
    public int filterOrder() {
        return 0;
    }

    /*
     * (non-Javadoc) pre：路由之前 routing：路由之时 post： 路由之后 error：发送错误调用
     *
     * @see com.netflix.zuul.ZuulFilter#filterType()
     */
    @Override
    public String filterType() {
        return "pre";
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="116" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.280</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> sns</a><br />
<b> <a> File: </a> </b>  <a> JwtInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>sns-article\src\main\java\com\zrkworld\sns\article\interceptor\JwtInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zrkworld.sns.article.interceptor;

import io.jsonwebtoken.Claims;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import utils.JwtUtil;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * 拦截器,用来jwt鉴权
 * @author zrk
 */
@Component
public class JwtInterceptor implements HandlerInterceptor {
    @Resource
    private JwtUtil jwtUtil;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // 无论如何都放行，具体能不能操作还是在具体操作中去判断
        // 拦截器只负责把请求头中包含token的令牌进行解析
        String header = request.getHeader("Authorization");
        if (!StringUtils.isEmpty(header)) {
            // 如果有包含Authorization的头信息，就对其进行解析
            if (header.startsWith("Bearer ")) {
                // 得到token
                final String token = header.substring(7);
                // 对令牌进行验证
                try {
                    Claims claims = jwtUtil.parseJWT(token);
                    String roles = (String) claims.get("role");
                    if ("admin".equals(roles)) {
                        request.setAttribute("claims_admin", token);
                    }
                    if ("user".equals(roles)) {
                        request.setAttribute("claims_user", token);
                    }
                } catch (Exception e) {
                    throw new RuntimeException("令牌有误!");
                }
            }
        }
        return true;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="117" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.281</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> sns</a><br />
<b> <a> File: </a> </b>  <a> JwtInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>sns-friend\src\main\java\com\zrkworld\sns\friend\interceptor\JwtInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zrkworld.sns.friend.interceptor;

import io.jsonwebtoken.Claims;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import utils.JwtUtil;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class JwtInterceptor implements HandlerInterceptor {
    @Resource
    private JwtUtil jwtUtil;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // 无论如何都放行，具体能不能操作还是在具体操作中去判断
        // 拦截器只负责把请求头中包含token的令牌进行解析
        String header = request.getHeader("Authorization");
        if (!StringUtils.isEmpty(header)) {
            // 如果有包含Authorization的头信息，就对其进行解析
            if (header.startsWith("Bearer ")) {
                // 得到token
                final String token = header.substring(7);
                // 对令牌进行验证
                try {
                    Claims claims = jwtUtil.parseJWT(token);
                    String roles = (String) claims.get("role");
                    if ("admin".equals(roles)) {
                        request.setAttribute("claims_admin", claims);
                    }
                    if ("user".equals(roles)) {
                        request.setAttribute("claims_user", claims);
                    }
                } catch (Exception e) {
                    throw new RuntimeException("令牌有误!");
                }
            }
        }
        return true;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="118" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.282</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> sns</a><br />
<b> <a> File: </a> </b>  <a> JwtInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>sns-qa\src\main\java\com.zrkworld.sns.qa\interceptor\JwtInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zrkworld.sns.qa.interceptor;

import io.jsonwebtoken.Claims;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import utils.JwtUtil;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class JwtInterceptor implements HandlerInterceptor {
    @Resource
    private JwtUtil jwtUtil;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // 无论如何都放行，具体能不能操作还是在具体操作中去判断
        // 拦截器只负责把请求头中包含token的令牌进行解析
        String header = request.getHeader("Authorization");
        if (!StringUtils.isEmpty(header)) {
            // 如果有包含Authorization的头信息，就对其进行解析
            if (header.startsWith("Bearer ")) {
                // 得到token
                final String token = header.substring(7);
                // 对令牌进行验证
                try {
                    Claims claims = jwtUtil.parseJWT(token);
                    String roles = (String) claims.get("roles");
                    if ("admin".equals(roles)) {
                        request.setAttribute("claims_admin", token);
                    }
                    if ("user".equals(roles)) {
                        request.setAttribute("claims_user", token);
                    }
                } catch (Exception e) {
                    throw new RuntimeException("令牌有误!");
                }
            }
        }
        return true;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="119" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.283</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> sns</a><br />
<b> <a> File: </a> </b>  <a> JwtInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>sns-spit\src\main\java\com\zrkworld\sns\spit\interceptor\JwtInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zrkworld.sns.spit.interceptor;

import io.jsonwebtoken.Claims;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import utils.JwtUtil;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class JwtInterceptor implements HandlerInterceptor {
    @Resource
    private JwtUtil jwtUtil;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // 无论如何都放行，具体能不能操作还是在具体操作中去判断
        // 拦截器只负责把请求头中包含token的令牌进行解析
        String header = request.getHeader("Authorization");
        if (!StringUtils.isEmpty(header)) {
            // 如果有包含Authorization的头信息，就对其进行解析
            if (header.startsWith("Bearer ")) {
                // 得到token
                final String token = header.substring(7);
                // 对令牌进行验证
                try {
                    Claims claims = jwtUtil.parseJWT(token);
                    String roles = (String) claims.get("role");
                    if ("admin".equals(roles)) {
                        request.setAttribute("claims_admin", token);
                    }
                    if ("user".equals(roles)) {
                        request.setAttribute("claims_user", token);
                    }
                } catch (Exception e) {
                    throw new RuntimeException("令牌有误!");
                }
            }
        }
        return true;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="120" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.284</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> sns</a><br />
<b> <a> File: </a> </b>  <a> JwtInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>sns-user\src\main\java\com\zrkworld\sns\user\interceptor\JwtInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zrkworld.sns.user.interceptor;

import io.jsonwebtoken.Claims;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import utils.JwtUtil;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class JwtInterceptor implements HandlerInterceptor {
    @Resource
    private JwtUtil jwtUtil;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // 无论如何都放行，具体能不能操作还是在具体操作中去判断
        // 拦截器只负责把请求头中包含token的令牌进行解析
        String header = request.getHeader("Authorization");
        if (!StringUtils.isEmpty(header)) {
            // 如果有包含Authorization的头信息，就对其进行解析
            if (header.startsWith("Bearer ")) {
                // 得到token
                final String token = header.substring(7);
                // 对令牌进行验证
                try {
                    Claims claims = jwtUtil.parseJWT(token);
                    String roles = (String) claims.get("role");
                    if ("admin".equals(roles)) {
                        request.setAttribute("claims_admin", token);
                    }
                    if ("user".equals(roles)) {
                        request.setAttribute("claims_user", token);
                    }
                } catch (Exception e) {
                    throw new RuntimeException("令牌有误!");
                }
            }
        }
        return true;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="121" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.285</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> HTMLFilter.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-admin\src\main\java\io\renren\common\xss\HTMLFilter.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package io.renren.common.xss;

import java.util.*;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;
import java.util.logging.Logger;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 *
 * HTML filtering utility for protecting against XSS (Cross Site Scripting).
 *
 * This code is licensed LGPLv3
 *
 * This code is a Java port of the original work in PHP by Cal Hendersen.
 * http://code.iamcal.com/php/lib_filter/
 *
 * The trickiest part of the translation was handling the differences in regex handling
 * between PHP and Java.  These resources were helpful in the process:
 *
 * http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html
 * http://us2.php.net/manual/en/reference.pcre.pattern.modifiers.php
 * http://www.regular-expressions.info/modifiers.html
 *
 * A note on naming conventions: instance variables are prefixed with a "v"; global
 * constants are in all caps.
 *
 * Sample use:
 * String input = ...
 * String clean = new HTMLFilter().filter( input );
 *
 * The class is not thread safe. Create a new instance if in doubt.
 *
 * If you find bugs or have suggestions on improvement (especially regarding
 * performance), please contact us.  The latest version of this
 * source, and our contact details, can be found at http://xss-html-filter.sf.net
 *
 * @author Joseph O'Connell
 * @author Cal Hendersen
 * @author Michael Semb Wever
 */
public final class HTMLFilter {

    /** regex flag union representing /si modifiers in php **/
    private static final int REGEX_FLAGS_SI = Pattern.CASE_INSENSITIVE | Pattern.DOTALL;
    private static final Pattern P_COMMENTS = Pattern.compile("&lt;!--(.*?)--&gt;", Pattern.DOTALL);
    private static final Pattern P_COMMENT = Pattern.compile("^!--(.*)--$", REGEX_FLAGS_SI);
    private static final Pattern P_TAGS = Pattern.compile("&lt;(.*?)&gt;", Pattern.DOTALL);
    private static final Pattern P_END_TAG = Pattern.compile("^/([a-z0-9]+)", REGEX_FLAGS_SI);
    private static final Pattern P_START_TAG = Pattern.compile("^([a-z0-9]+)(.*?)(/?)$", REGEX_FLAGS_SI);
    private static final Pattern P_QUOTED_ATTRIBUTES = Pattern.compile("([a-z0-9]+)=([\"'])(.*?)\\2", REGEX_FLAGS_SI);
    private static final Pattern P_UNQUOTED_ATTRIBUTES = Pattern.compile("([a-z0-9]+)(=)([^\"\\s']+)", REGEX_FLAGS_SI);
    private static final Pattern P_PROTOCOL = Pattern.compile("^([^:]+):", REGEX_FLAGS_SI);
    private static final Pattern P_ENTITY = Pattern.compile("&#(\\d+);?");
    private static final Pattern P_ENTITY_UNICODE = Pattern.compile("&#x([0-9a-f]+);?");
    private static final Pattern P_ENCODE = Pattern.compile("%([0-9a-f]{2});?");
    private static final Pattern P_VALID_ENTITIES = Pattern.compile("&([^&;]*)(?=(;|&|$))");
    private static final Pattern P_VALID_QUOTES = Pattern.compile("(&gt;|^)([^&lt;]+?)(&lt;|$)", Pattern.DOTALL);
    private static final Pattern P_END_ARROW = Pattern.compile("^&gt;");
    private static final Pattern P_BODY_TO_END = Pattern.compile("&lt;([^&gt;]*?)(?=&lt;|$)");
    private static final Pattern P_XML_CONTENT = Pattern.compile("(^|&gt;)([^&lt;]*?)(?=&gt;)");
    private static final Pattern P_STRAY_LEFT_ARROW = Pattern.compile("&lt;([^&gt;]*?)(?=&lt;|$)");
    private static final Pattern P_STRAY_RIGHT_ARROW = Pattern.compile("(^|&gt;)([^&lt;]*?)(?=&gt;)");
    private static final Pattern P_AMP = Pattern.compile("&");
    private static final Pattern P_QUOTE = Pattern.compile("&lt;");
    private static final Pattern P_LEFT_ARROW = Pattern.compile("&lt;");
    private static final Pattern P_RIGHT_ARROW = Pattern.compile("&gt;");
    private static final Pattern P_BOTH_ARROWS = Pattern.compile("&lt;&gt;");

    // @xxx could grow large... maybe use sesat's ReferenceMap
    private static final ConcurrentMap&lt;String,Pattern&gt; P_REMOVE_PAIR_BLANKS = new ConcurrentHashMap&lt;String, Pattern&gt;();
    private static final ConcurrentMap&lt;String,Pattern&gt; P_REMOVE_SELF_BLANKS = new ConcurrentHashMap&lt;String, Pattern&gt;();

    /** set of allowed html elements, along with allowed attributes for each element **/
    private final Map&lt;String, List&lt;String&gt;&gt; vAllowed;
    /** counts of open tags for each (allowable) html element **/
    private final Map&lt;String, Integer&gt; vTagCounts = new HashMap&lt;String, Integer&gt;();

    /** html elements which must always be self-closing (e.g. "&lt;img /&gt;") **/
    private final String[] vSelfClosingTags;
    /** html elements which must always have separate opening and closing tags (e.g. "&lt;b&gt;&lt;/b&gt;") **/
    private final String[] vNeedClosingTags;
    /** set of disallowed html elements **/
    private final String[] vDisallowed;
    /** attributes which should be checked for valid protocols **/
    private final String[] vProtocolAtts;
    /** allowed protocols **/
    private final String[] vAllowedProtocols;
    /** tags which should be removed if they contain no content (e.g. "&lt;b&gt;&lt;/b&gt;" or "&lt;b /&gt;") **/
    private final String[] vRemoveBlanks;
    /** entities allowed within html markup **/
    private final String[] vAllowedEntities;
    /** flag determining whether comments are allowed in input String. */
    private final boolean stripComment;
    private final boolean encodeQuotes;
    private boolean vDebug = false;
    /**
     * flag determining whether to try to make tags when presented with "unbalanced"
     * angle brackets (e.g. "&lt;b text &lt;/b&gt;" becomes "&lt;b&gt; text &lt;/b&gt;").  If set to false,
     * unbalanced angle brackets will be html escaped.
     */
    private final boolean alwaysMakeTags;

    /** Default constructor.
     *
     */
    public HTMLFilter() {
        vAllowed = new HashMap&lt;&gt;();

        final ArrayList&lt;String&gt; a_atts = new ArrayList&lt;String&gt;();
        a_atts.add("href");
        a_atts.add("target");
        vAllowed.put("a", a_atts);

        final ArrayList&lt;String&gt; img_atts = new ArrayList&lt;String&gt;();
        img_atts.add("src");
        img_atts.add("width");
        img_atts.add("height");
        img_atts.add("alt");
        vAllowed.put("img", img_atts);

        final ArrayList&lt;String&gt; no_atts = new ArrayList&lt;String&gt;();
        vAllowed.put("b", no_atts);
        vAllowed.put("strong", no_atts);
        vAllowed.put("i", no_atts);
        vAllowed.put("em", no_atts);

        vSelfClosingTags = new String[]{"img"};
        vNeedClosingTags = new String[]{"a", "b", "strong", "i", "em"};
        vDisallowed = new String[]{};
        vAllowedProtocols = new String[]{"http", "mailto", "https"}; // no ftp.
        vProtocolAtts = new String[]{"src", "href"};
        vRemoveBlanks = new String[]{"a", "b", "strong", "i", "em"};
        vAllowedEntities = new String[]{"amp", "gt", "lt", "quot"};
        stripComment = true;
        encodeQuotes = true;
        alwaysMakeTags = true;
    }

    /** Set debug flag to true. Otherwise use default settings. See the default constructor.
     *
     * @param debug turn debug on with a true argument
     */
    public HTMLFilter(final boolean debug) {
        this();
        vDebug = debug;

    }

    /** Map-parameter configurable constructor.
     *
     * @param conf map containing configuration. keys match field names.
     */
    public HTMLFilter(final Map&lt;String,Object&gt; conf) {

        assert conf.containsKey("vAllowed") : "configuration requires vAllowed";
        assert conf.containsKey("vSelfClosingTags") : "configuration requires vSelfClosingTags";
        assert conf.containsKey("vNeedClosingTags") : "configuration requires vNeedClosingTags";
        assert conf.containsKey("vDisallowed") : "configuration requires vDisallowed";
        assert conf.containsKey("vAllowedProtocols") : "configuration requires vAllowedProtocols";
        assert conf.containsKey("vProtocolAtts") : "configuration requires vProtocolAtts";
        assert conf.containsKey("vRemoveBlanks") : "configuration requires vRemoveBlanks";
        assert conf.containsKey("vAllowedEntities") : "configuration requires vAllowedEntities";

        vAllowed = Collections.unmodifiableMap((HashMap&lt;String, List&lt;String&gt;&gt;) conf.get("vAllowed"));
        vSelfClosingTags = (String[]) conf.get("vSelfClosingTags");
        vNeedClosingTags = (String[]) conf.get("vNeedClosingTags");
        vDisallowed = (String[]) conf.get("vDisallowed");
        vAllowedProtocols = (String[]) conf.get("vAllowedProtocols");
        vProtocolAtts = (String[]) conf.get("vProtocolAtts");
        vRemoveBlanks = (String[]) conf.get("vRemoveBlanks");
        vAllowedEntities = (String[]) conf.get("vAllowedEntities");
        stripComment =  conf.containsKey("stripComment") ? (Boolean) conf.get("stripComment") : true;
        encodeQuotes = conf.containsKey("encodeQuotes") ? (Boolean) conf.get("encodeQuotes") : true;
        alwaysMakeTags = conf.containsKey("alwaysMakeTags") ? (Boolean) conf.get("alwaysMakeTags") : true;
    }

    private void reset() {
        vTagCounts.clear();
    }

    private void debug(final String msg) {
        if (vDebug) {
            Logger.getAnonymousLogger().info(msg);
        }
    }

    //---------------------------------------------------------------
    // my versions of some PHP library functions
    public static String chr(final int decimal) {
        return String.valueOf((char) decimal);
    }

    public static String htmlSpecialChars(final String s) {
        String result = s;
        result = regexReplace(P_AMP, "&amp;", result);
        result = regexReplace(P_QUOTE, "&quot;", result);
        result = regexReplace(P_LEFT_ARROW, "&lt;", result);
        result = regexReplace(P_RIGHT_ARROW, "&gt;", result);
        return result;
    }

    //---------------------------------------------------------------
    /**
     * given a user submitted input String, filter out any invalid or restricted
     * html.
     *
     * @param input text (i.e. submitted by a user) than may contain html
     * @return "clean" version of input, with only valid, whitelisted html elements allowed
     */
    public String filter(final String input) {
        reset();
        String s = input;

        debug("************************************************");
        debug("              INPUT: " + input);

        s = escapeComments(s);
        debug("     escapeComments: " + s);

        s = balanceHTML(s);
        debug("        balanceHTML: " + s);

        s = checkTags(s);
        debug("          checkTags: " + s);

        s = processRemoveBlanks(s);
        debug("processRemoveBlanks: " + s);

        s = validateEntities(s);
        debug("    validateEntites: " + s);

        debug("************************************************\n\n");
        return s;
    }

    public boolean isAlwaysMakeTags(){
        return alwaysMakeTags;
    }

    public boolean isStripComments(){
        return stripComment;
    }

    private String escapeComments(final String s) {
        final Matcher m = P_COMMENTS.matcher(s);
        final StringBuffer buf = new StringBuffer();
        if (m.find()) {
            final String match = m.group(1); //(.*?)
            m.appendReplacement(buf, Matcher.quoteReplacement("&lt;!--" + htmlSpecialChars(match) + "--&gt;"));
        }
        m.appendTail(buf);

        return buf.toString();
    }

    private String balanceHTML(String s) {
        if (alwaysMakeTags) {
            //
            // try and form html
            //
            s = regexReplace(P_END_ARROW, "", s);
            s = regexReplace(P_BODY_TO_END, "&lt;$1&gt;", s);
            s = regexReplace(P_XML_CONTENT, "$1&lt;$2", s);

        } else {
            //
            // escape stray brackets
            //
            s = regexReplace(P_STRAY_LEFT_ARROW, "&lt;$1", s);
            s = regexReplace(P_STRAY_RIGHT_ARROW, "$1$2&gt;&lt;", s);

            //
            // the last regexp causes '&lt;&gt;' entities to appear
            // (we need to do a lookahead assertion so that the last bracket can
            // be used in the next pass of the regexp)
            //
            s = regexReplace(P_BOTH_ARROWS, "", s);
        }

        return s;
    }

    private String checkTags(String s) {
        Matcher m = P_TAGS.matcher(s);

        final StringBuffer buf = new StringBuffer();
        while (m.find()) {
            String replaceStr = m.group(1);
            replaceStr = processTag(replaceStr);
            m.appendReplacement(buf, Matcher.quoteReplacement(replaceStr));
        }
        m.appendTail(buf);

        s = buf.toString();

        // these get tallied in processTag
        // (remember to reset before subsequent calls to filter method)
        for (String key : vTagCounts.keySet()) {
            for (int ii = 0; ii &lt; vTagCounts.get(key); ii++) {
                s += "&lt;/" + key + "&gt;";
            }
        }

        return s;
    }

    private String processRemoveBlanks(final String s) {
        String result = s;
        for (String tag : vRemoveBlanks) {
            if(!P_REMOVE_PAIR_BLANKS.containsKey(tag)){
                P_REMOVE_PAIR_BLANKS.putIfAbsent(tag, Pattern.compile("&lt;" + tag + "(\\s[^&gt;]*)?&gt;&lt;/" + tag + "&gt;"));
            }
            result = regexReplace(P_REMOVE_PAIR_BLANKS.get(tag), "", result);
            if(!P_REMOVE_SELF_BLANKS.containsKey(tag)){
                P_REMOVE_SELF_BLANKS.putIfAbsent(tag, Pattern.compile("&lt;" + tag + "(\\s[^&gt;]*)?/&gt;"));
            }
            result = regexReplace(P_REMOVE_SELF_BLANKS.get(tag), "", result);
        }

        return result;
    }

    private static String regexReplace(final Pattern regex_pattern, final String replacement, final String s) {
        Matcher m = regex_pattern.matcher(s);
        return m.replaceAll(replacement);
    }

    private String processTag(final String s) {
        // ending tags
        Matcher m = P_END_TAG.matcher(s);
        if (m.find()) {
            final String name = m.group(1).toLowerCase();
            if (allowed(name)) {
                if (!inArray(name, vSelfClosingTags)) {
                    if (vTagCounts.containsKey(name)) {
                        vTagCounts.put(name, vTagCounts.get(name) - 1);
                        return "&lt;/" + name + "&gt;";
                    }
                }
            }
        }

        // starting tags
        m = P_START_TAG.matcher(s);
        if (m.find()) {
            final String name = m.group(1).toLowerCase();
            final String body = m.group(2);
            String ending = m.group(3);

            //debug( "in a starting tag, name='" + name + "'; body='" + body + "'; ending='" + ending + "'" );
            if (allowed(name)) {
                String params = "";

                final Matcher m2 = P_QUOTED_ATTRIBUTES.matcher(body);
                final Matcher m3 = P_UNQUOTED_ATTRIBUTES.matcher(body);
                final List&lt;String&gt; paramNames = new ArrayList&lt;String&gt;();
                final List&lt;String&gt; paramValues = new ArrayList&lt;String&gt;();
                while (m2.find()) {
                    paramNames.add(m2.group(1)); //([a-z0-9]+)
                    paramValues.add(m2.group(3)); //(.*?)
                }
                while (m3.find()) {
                    paramNames.add(m3.group(1)); //([a-z0-9]+)
                    paramValues.add(m3.group(3)); //([^\"\\s']+)
                }

                String paramName, paramValue;
                for (int ii = 0; ii &lt; paramNames.size(); ii++) {
                    paramName = paramNames.get(ii).toLowerCase();
                    paramValue = paramValues.get(ii);

//          debug( "paramName='" + paramName + "'" );
//          debug( "paramValue='" + paramValue + "'" );
//          debug( "allowed? " + vAllowed.get( name ).contains( paramName ) );

                    if (allowedAttribute(name, paramName)) {
                        if (inArray(paramName, vProtocolAtts)) {
                            paramValue = processParamProtocol(paramValue);
                        }
                        params += " " + paramName + "=\"" + paramValue + "\"";
                    }
                }

                if (inArray(name, vSelfClosingTags)) {
                    ending = " /";
                }

                if (inArray(name, vNeedClosingTags)) {
                    ending = "";
                }

                if (ending == null || ending.length() &lt; 1) {
                    if (vTagCounts.containsKey(name)) {
                        vTagCounts.put(name, vTagCounts.get(name) + 1);
                    } else {
                        vTagCounts.put(name, 1);
                    }
                } else {
                    ending = " /";
                }
                return "&lt;" + name + params + ending + "&gt;";
            } else {
                return "";
            }
        }

        // comments
        m = P_COMMENT.matcher(s);
        if (!stripComment && m.find()) {
            return  "&lt;" + m.group() + "&gt;";
        }

        return "";
    }

    private String processParamProtocol(String s) {
        s = decodeEntities(s);
        final Matcher m = P_PROTOCOL.matcher(s);
        if (m.find()) {
            final String protocol = m.group(1);
            if (!inArray(protocol, vAllowedProtocols)) {
                // bad protocol, turn into local anchor link instead
                s = "#" + s.substring(protocol.length() + 1, s.length());
                if (s.startsWith("#//")) {
                    s = "#" + s.substring(3, s.length());
                }
            }
        }

        return s;
    }

    private String decodeEntities(String s) {
        StringBuffer buf = new StringBuffer();

        Matcher m = P_ENTITY.matcher(s);
        while (m.find()) {
            final String match = m.group(1);
            final int decimal = Integer.decode(match).intValue();
            m.appendReplacement(buf, Matcher.quoteReplacement(chr(decimal)));
        }
        m.appendTail(buf);
        s = buf.toString();

        buf = new StringBuffer();
        m = P_ENTITY_UNICODE.matcher(s);
        while (m.find()) {
            final String match = m.group(1);
            final int decimal = Integer.valueOf(match, 16).intValue();
            m.appendReplacement(buf, Matcher.quoteReplacement(chr(decimal)));
        }
        m.appendTail(buf);
        s = buf.toString();

        buf = new StringBuffer();
        m = P_ENCODE.matcher(s);
        while (m.find()) {
            final String match = m.group(1);
            final int decimal = Integer.valueOf(match, 16).intValue();
            m.appendReplacement(buf, Matcher.quoteReplacement(chr(decimal)));
        }
        m.appendTail(buf);
        s = buf.toString();

        s = validateEntities(s);
        return s;
    }

    private String validateEntities(final String s) {
        StringBuffer buf = new StringBuffer();

        // validate entities throughout the string
        Matcher m = P_VALID_ENTITIES.matcher(s);
        while (m.find()) {
            final String one = m.group(1); //([^&;]*)
            final String two = m.group(2); //(?=(;|&|$))
            m.appendReplacement(buf, Matcher.quoteReplacement(checkEntity(one, two)));
        }
        m.appendTail(buf);

        return encodeQuotes(buf.toString());
    }

    private String encodeQuotes(final String s){
        if(encodeQuotes){
            StringBuffer buf = new StringBuffer();
            Matcher m = P_VALID_QUOTES.matcher(s);
            while (m.find()) {
                final String one = m.group(1); //(&gt;|^)
                final String two = m.group(2); //([^&lt;]+?)
                final String three = m.group(3); //(&lt;|$)
                m.appendReplacement(buf, Matcher.quoteReplacement(one + regexReplace(P_QUOTE, "&quot;", two) + three));
            }
            m.appendTail(buf);
            return buf.toString();
        }else{
            return s;
        }
    }

    private String checkEntity(final String preamble, final String term) {

        return ";".equals(term) && isValidEntity(preamble)
                ? '&' + preamble
                : "&amp;" + preamble;
    }

    private boolean isValidEntity(final String entity) {
        return inArray(entity, vAllowedEntities);
    }

    private static boolean inArray(final String s, final String[] array) {
        for (String item : array) {
            if (item != null && item.equals(s)) {
                return true;
            }
        }
        return false;
    }

    private boolean allowed(final String name) {
        return (vAllowed.isEmpty() || vAllowed.containsKey(name)) && !inArray(name, vDisallowed);
    }

    private boolean allowedAttribute(final String name, final String paramName) {
        return allowed(name) && (vAllowed.isEmpty() || vAllowed.get(name).contains(paramName));
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="122" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.287</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> HTMLFilter.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-common\src\main\java\com\jerusalem\common\xss\HTMLFilter.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.common.xss;

import java.util.*;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;
import java.util.logging.Logger;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 *
 * HTML filtering utility for protecting against XSS (Cross Site Scripting).
 *
 * This code is licensed LGPLv3
 *
 * This code is a Java port of the original work in PHP by Cal Hendersen.
 * http://code.iamcal.com/php/lib_filter/
 *
 * The trickiest part of the translation was handling the differences in regex handling
 * between PHP and Java.  These resources were helpful in the process:
 *
 * http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html
 * http://us2.php.net/manual/en/reference.pcre.pattern.modifiers.php
 * http://www.regular-expressions.info/modifiers.html
 *
 * A note on naming conventions: instance variables are prefixed with a "v"; global
 * constants are in all caps.
 *
 * Sample use:
 * String input = ...
 * String clean = new HTMLFilter().filter( input );
 *
 * The class is not thread safe. Create a new instance if in doubt.
 *
 * If you find bugs or have suggestions on improvement (especially regarding
 * performance), please contact us.  The latest version of this
 * source, and our contact details, can be found at http://xss-html-filter.sf.net
 *
 * @author Joseph O'Connell
 * @author Cal Hendersen
 * @author Michael Semb Wever
 */
public final class HTMLFilter {

    /** regex flag union representing /si modifiers in php **/
    private static final int REGEX_FLAGS_SI = Pattern.CASE_INSENSITIVE | Pattern.DOTALL;
    private static final Pattern P_COMMENTS = Pattern.compile("&lt;!--(.*?)--&gt;", Pattern.DOTALL);
    private static final Pattern P_COMMENT = Pattern.compile("^!--(.*)--$", REGEX_FLAGS_SI);
    private static final Pattern P_TAGS = Pattern.compile("&lt;(.*?)&gt;", Pattern.DOTALL);
    private static final Pattern P_END_TAG = Pattern.compile("^/([a-z0-9]+)", REGEX_FLAGS_SI);
    private static final Pattern P_START_TAG = Pattern.compile("^([a-z0-9]+)(.*?)(/?)$", REGEX_FLAGS_SI);
    private static final Pattern P_QUOTED_ATTRIBUTES = Pattern.compile("([a-z0-9]+)=([\"'])(.*?)\\2", REGEX_FLAGS_SI);
    private static final Pattern P_UNQUOTED_ATTRIBUTES = Pattern.compile("([a-z0-9]+)(=)([^\"\\s']+)", REGEX_FLAGS_SI);
    private static final Pattern P_PROTOCOL = Pattern.compile("^([^:]+):", REGEX_FLAGS_SI);
    private static final Pattern P_ENTITY = Pattern.compile("&#(\\d+);?");
    private static final Pattern P_ENTITY_UNICODE = Pattern.compile("&#x([0-9a-f]+);?");
    private static final Pattern P_ENCODE = Pattern.compile("%([0-9a-f]{2});?");
    private static final Pattern P_VALID_ENTITIES = Pattern.compile("&([^&;]*)(?=(;|&|$))");
    private static final Pattern P_VALID_QUOTES = Pattern.compile("(&gt;|^)([^&lt;]+?)(&lt;|$)", Pattern.DOTALL);
    private static final Pattern P_END_ARROW = Pattern.compile("^&gt;");
    private static final Pattern P_BODY_TO_END = Pattern.compile("&lt;([^&gt;]*?)(?=&lt;|$)");
    private static final Pattern P_XML_CONTENT = Pattern.compile("(^|&gt;)([^&lt;]*?)(?=&gt;)");
    private static final Pattern P_STRAY_LEFT_ARROW = Pattern.compile("&lt;([^&gt;]*?)(?=&lt;|$)");
    private static final Pattern P_STRAY_RIGHT_ARROW = Pattern.compile("(^|&gt;)([^&lt;]*?)(?=&gt;)");
    private static final Pattern P_AMP = Pattern.compile("&");
    private static final Pattern P_QUOTE = Pattern.compile("&lt;");
    private static final Pattern P_LEFT_ARROW = Pattern.compile("&lt;");
    private static final Pattern P_RIGHT_ARROW = Pattern.compile("&gt;");
    private static final Pattern P_BOTH_ARROWS = Pattern.compile("&lt;&gt;");

    // @xxx could grow large... maybe use sesat's ReferenceMap
    private static final ConcurrentMap&lt;String,Pattern&gt; P_REMOVE_PAIR_BLANKS = new ConcurrentHashMap&lt;String, Pattern&gt;();
    private static final ConcurrentMap&lt;String,Pattern&gt; P_REMOVE_SELF_BLANKS = new ConcurrentHashMap&lt;String, Pattern&gt;();

    /** set of allowed html elements, along with allowed attributes for each element **/
    private final Map&lt;String, List&lt;String&gt;&gt; vAllowed;
    /** counts of open tags for each (allowable) html element **/
    private final Map&lt;String, Integer&gt; vTagCounts = new HashMap&lt;String, Integer&gt;();

    /** html elements which must always be self-closing (e.g. "&lt;img /&gt;") **/
    private final String[] vSelfClosingTags;
    /** html elements which must always have separate opening and closing tags (e.g. "&lt;b&gt;&lt;/b&gt;") **/
    private final String[] vNeedClosingTags;
    /** set of disallowed html elements **/
    private final String[] vDisallowed;
    /** attributes which should be checked for valid protocols **/
    private final String[] vProtocolAtts;
    /** allowed protocols **/
    private final String[] vAllowedProtocols;
    /** tags which should be removed if they contain no content (e.g. "&lt;b&gt;&lt;/b&gt;" or "&lt;b /&gt;") **/
    private final String[] vRemoveBlanks;
    /** entities allowed within html markup **/
    private final String[] vAllowedEntities;
    /** flag determining whether comments are allowed in input String. */
    private final boolean stripComment;
    private final boolean encodeQuotes;
    private boolean vDebug = false;
    /**
     * flag determining whether to try to make tags when presented with "unbalanced"
     * angle brackets (e.g. "&lt;b text &lt;/b&gt;" becomes "&lt;b&gt; text &lt;/b&gt;").  If set to false,
     * unbalanced angle brackets will be html escaped.
     */
    private final boolean alwaysMakeTags;

    /** Default constructor.
     *
     */
    public HTMLFilter() {
        vAllowed = new HashMap&lt;&gt;();

        final ArrayList&lt;String&gt; a_atts = new ArrayList&lt;String&gt;();
        a_atts.add("href");
        a_atts.add("target");
        vAllowed.put("a", a_atts);

        final ArrayList&lt;String&gt; img_atts = new ArrayList&lt;String&gt;();
        img_atts.add("src");
        img_atts.add("width");
        img_atts.add("height");
        img_atts.add("alt");
        vAllowed.put("img", img_atts);

        final ArrayList&lt;String&gt; no_atts = new ArrayList&lt;String&gt;();
        vAllowed.put("b", no_atts);
        vAllowed.put("strong", no_atts);
        vAllowed.put("i", no_atts);
        vAllowed.put("em", no_atts);

        vSelfClosingTags = new String[]{"img"};
        vNeedClosingTags = new String[]{"a", "b", "strong", "i", "em"};
        vDisallowed = new String[]{};
        vAllowedProtocols = new String[]{"http", "mailto", "https"}; // no ftp.
        vProtocolAtts = new String[]{"src", "href"};
        vRemoveBlanks = new String[]{"a", "b", "strong", "i", "em"};
        vAllowedEntities = new String[]{"amp", "gt", "lt", "quot"};
        stripComment = true;
        encodeQuotes = true;
        alwaysMakeTags = true;
    }

    /** Set debug flag to true. Otherwise use default settings. See the default constructor.
     *
     * @param debug turn debug on with a true argument
     */
    public HTMLFilter(final boolean debug) {
        this();
        vDebug = debug;

    }

    /** Map-parameter configurable constructor.
     *
     * @param conf map containing configuration. keys match field names.
     */
    public HTMLFilter(final Map&lt;String,Object&gt; conf) {

        assert conf.containsKey("vAllowed") : "configuration requires vAllowed";
        assert conf.containsKey("vSelfClosingTags") : "configuration requires vSelfClosingTags";
        assert conf.containsKey("vNeedClosingTags") : "configuration requires vNeedClosingTags";
        assert conf.containsKey("vDisallowed") : "configuration requires vDisallowed";
        assert conf.containsKey("vAllowedProtocols") : "configuration requires vAllowedProtocols";
        assert conf.containsKey("vProtocolAtts") : "configuration requires vProtocolAtts";
        assert conf.containsKey("vRemoveBlanks") : "configuration requires vRemoveBlanks";
        assert conf.containsKey("vAllowedEntities") : "configuration requires vAllowedEntities";

        vAllowed = Collections.unmodifiableMap((HashMap&lt;String, List&lt;String&gt;&gt;) conf.get("vAllowed"));
        vSelfClosingTags = (String[]) conf.get("vSelfClosingTags");
        vNeedClosingTags = (String[]) conf.get("vNeedClosingTags");
        vDisallowed = (String[]) conf.get("vDisallowed");
        vAllowedProtocols = (String[]) conf.get("vAllowedProtocols");
        vProtocolAtts = (String[]) conf.get("vProtocolAtts");
        vRemoveBlanks = (String[]) conf.get("vRemoveBlanks");
        vAllowedEntities = (String[]) conf.get("vAllowedEntities");
        stripComment =  conf.containsKey("stripComment") ? (Boolean) conf.get("stripComment") : true;
        encodeQuotes = conf.containsKey("encodeQuotes") ? (Boolean) conf.get("encodeQuotes") : true;
        alwaysMakeTags = conf.containsKey("alwaysMakeTags") ? (Boolean) conf.get("alwaysMakeTags") : true;
    }

    private void reset() {
        vTagCounts.clear();
    }

    private void debug(final String msg) {
        if (vDebug) {
            Logger.getAnonymousLogger().info(msg);
        }
    }

    //---------------------------------------------------------------
    // my versions of some PHP library functions
    public static String chr(final int decimal) {
        return String.valueOf((char) decimal);
    }

    public static String htmlSpecialChars(final String s) {
        String result = s;
        result = regexReplace(P_AMP, "&amp;", result);
        result = regexReplace(P_QUOTE, "&quot;", result);
        result = regexReplace(P_LEFT_ARROW, "&lt;", result);
        result = regexReplace(P_RIGHT_ARROW, "&gt;", result);
        return result;
    }

    //---------------------------------------------------------------
    /**
     * given a user submitted input String, filter out any invalid or restricted
     * html.
     *
     * @param input text (i.e. submitted by a user) than may contain html
     * @return "clean" version of input, with only valid, whitelisted html elements allowed
     */
    public String filter(final String input) {
        reset();
        String s = input;

        debug("************************************************");
        debug("              INPUT: " + input);

        s = escapeComments(s);
        debug("     escapeComments: " + s);

        s = balanceHTML(s);
        debug("        balanceHTML: " + s);

        s = checkTags(s);
        debug("          checkTags: " + s);

        s = processRemoveBlanks(s);
        debug("processRemoveBlanks: " + s);

        s = validateEntities(s);
        debug("    validateEntites: " + s);

        debug("************************************************\n\n");
        return s;
    }

    public boolean isAlwaysMakeTags(){
        return alwaysMakeTags;
    }

    public boolean isStripComments(){
        return stripComment;
    }

    private String escapeComments(final String s) {
        final Matcher m = P_COMMENTS.matcher(s);
        final StringBuffer buf = new StringBuffer();
        if (m.find()) {
            final String match = m.group(1); //(.*?)
            m.appendReplacement(buf, Matcher.quoteReplacement("&lt;!--" + htmlSpecialChars(match) + "--&gt;"));
        }
        m.appendTail(buf);

        return buf.toString();
    }

    private String balanceHTML(String s) {
        if (alwaysMakeTags) {
            //
            // try and form html
            //
            s = regexReplace(P_END_ARROW, "", s);
            s = regexReplace(P_BODY_TO_END, "&lt;$1&gt;", s);
            s = regexReplace(P_XML_CONTENT, "$1&lt;$2", s);

        } else {
            //
            // escape stray brackets
            //
            s = regexReplace(P_STRAY_LEFT_ARROW, "&lt;$1", s);
            s = regexReplace(P_STRAY_RIGHT_ARROW, "$1$2&gt;&lt;", s);

            //
            // the last regexp causes '&lt;&gt;' entities to appear
            // (we need to do a lookahead assertion so that the last bracket can
            // be used in the next pass of the regexp)
            //
            s = regexReplace(P_BOTH_ARROWS, "", s);
        }

        return s;
    }

    private String checkTags(String s) {
        Matcher m = P_TAGS.matcher(s);

        final StringBuffer buf = new StringBuffer();
        while (m.find()) {
            String replaceStr = m.group(1);
            replaceStr = processTag(replaceStr);
            m.appendReplacement(buf, Matcher.quoteReplacement(replaceStr));
        }
        m.appendTail(buf);

        s = buf.toString();

        // these get tallied in processTag
        // (remember to reset before subsequent calls to filter method)
        for (String key : vTagCounts.keySet()) {
            for (int ii = 0; ii &lt; vTagCounts.get(key); ii++) {
                s += "&lt;/" + key + "&gt;";
            }
        }

        return s;
    }

    private String processRemoveBlanks(final String s) {
        String result = s;
        for (String tag : vRemoveBlanks) {
            if(!P_REMOVE_PAIR_BLANKS.containsKey(tag)){
                P_REMOVE_PAIR_BLANKS.putIfAbsent(tag, Pattern.compile("&lt;" + tag + "(\\s[^&gt;]*)?&gt;&lt;/" + tag + "&gt;"));
            }
            result = regexReplace(P_REMOVE_PAIR_BLANKS.get(tag), "", result);
            if(!P_REMOVE_SELF_BLANKS.containsKey(tag)){
                P_REMOVE_SELF_BLANKS.putIfAbsent(tag, Pattern.compile("&lt;" + tag + "(\\s[^&gt;]*)?/&gt;"));
            }
            result = regexReplace(P_REMOVE_SELF_BLANKS.get(tag), "", result);
        }

        return result;
    }

    private static String regexReplace(final Pattern regex_pattern, final String replacement, final String s) {
        Matcher m = regex_pattern.matcher(s);
        return m.replaceAll(replacement);
    }

    private String processTag(final String s) {
        // ending tags
        Matcher m = P_END_TAG.matcher(s);
        if (m.find()) {
            final String name = m.group(1).toLowerCase();
            if (allowed(name)) {
                if (!inArray(name, vSelfClosingTags)) {
                    if (vTagCounts.containsKey(name)) {
                        vTagCounts.put(name, vTagCounts.get(name) - 1);
                        return "&lt;/" + name + "&gt;";
                    }
                }
            }
        }

        // starting tags
        m = P_START_TAG.matcher(s);
        if (m.find()) {
            final String name = m.group(1).toLowerCase();
            final String body = m.group(2);
            String ending = m.group(3);

            //debug( "in a starting tag, name='" + name + "'; body='" + body + "'; ending='" + ending + "'" );
            if (allowed(name)) {
                String params = "";

                final Matcher m2 = P_QUOTED_ATTRIBUTES.matcher(body);
                final Matcher m3 = P_UNQUOTED_ATTRIBUTES.matcher(body);
                final List&lt;String&gt; paramNames = new ArrayList&lt;String&gt;();
                final List&lt;String&gt; paramValues = new ArrayList&lt;String&gt;();
                while (m2.find()) {
                    paramNames.add(m2.group(1)); //([a-z0-9]+)
                    paramValues.add(m2.group(3)); //(.*?)
                }
                while (m3.find()) {
                    paramNames.add(m3.group(1)); //([a-z0-9]+)
                    paramValues.add(m3.group(3)); //([^\"\\s']+)
                }

                String paramName, paramValue;
                for (int ii = 0; ii &lt; paramNames.size(); ii++) {
                    paramName = paramNames.get(ii).toLowerCase();
                    paramValue = paramValues.get(ii);

//          debug( "paramName='" + paramName + "'" );
//          debug( "paramValue='" + paramValue + "'" );
//          debug( "allowed? " + vAllowed.get( name ).contains( paramName ) );

                    if (allowedAttribute(name, paramName)) {
                        if (inArray(paramName, vProtocolAtts)) {
                            paramValue = processParamProtocol(paramValue);
                        }
                        params += " " + paramName + "=\"" + paramValue + "\"";
                    }
                }

                if (inArray(name, vSelfClosingTags)) {
                    ending = " /";
                }

                if (inArray(name, vNeedClosingTags)) {
                    ending = "";
                }

                if (ending == null || ending.length() &lt; 1) {
                    if (vTagCounts.containsKey(name)) {
                        vTagCounts.put(name, vTagCounts.get(name) + 1);
                    } else {
                        vTagCounts.put(name, 1);
                    }
                } else {
                    ending = " /";
                }
                return "&lt;" + name + params + ending + "&gt;";
            } else {
                return "";
            }
        }

        // comments
        m = P_COMMENT.matcher(s);
        if (!stripComment && m.find()) {
            return  "&lt;" + m.group() + "&gt;";
        }

        return "";
    }

    private String processParamProtocol(String s) {
        s = decodeEntities(s);
        final Matcher m = P_PROTOCOL.matcher(s);
        if (m.find()) {
            final String protocol = m.group(1);
            if (!inArray(protocol, vAllowedProtocols)) {
                // bad protocol, turn into local anchor link instead
                s = "#" + s.substring(protocol.length() + 1, s.length());
                if (s.startsWith("#//")) {
                    s = "#" + s.substring(3, s.length());
                }
            }
        }

        return s;
    }

    private String decodeEntities(String s) {
        StringBuffer buf = new StringBuffer();

        Matcher m = P_ENTITY.matcher(s);
        while (m.find()) {
            final String match = m.group(1);
            final int decimal = Integer.decode(match).intValue();
            m.appendReplacement(buf, Matcher.quoteReplacement(chr(decimal)));
        }
        m.appendTail(buf);
        s = buf.toString();

        buf = new StringBuffer();
        m = P_ENTITY_UNICODE.matcher(s);
        while (m.find()) {
            final String match = m.group(1);
            final int decimal = Integer.valueOf(match, 16).intValue();
            m.appendReplacement(buf, Matcher.quoteReplacement(chr(decimal)));
        }
        m.appendTail(buf);
        s = buf.toString();

        buf = new StringBuffer();
        m = P_ENCODE.matcher(s);
        while (m.find()) {
            final String match = m.group(1);
            final int decimal = Integer.valueOf(match, 16).intValue();
            m.appendReplacement(buf, Matcher.quoteReplacement(chr(decimal)));
        }
        m.appendTail(buf);
        s = buf.toString();

        s = validateEntities(s);
        return s;
    }

    private String validateEntities(final String s) {
        StringBuffer buf = new StringBuffer();

        // validate entities throughout the string
        Matcher m = P_VALID_ENTITIES.matcher(s);
        while (m.find()) {
            final String one = m.group(1); //([^&;]*)
            final String two = m.group(2); //(?=(;|&|$))
            m.appendReplacement(buf, Matcher.quoteReplacement(checkEntity(one, two)));
        }
        m.appendTail(buf);

        return encodeQuotes(buf.toString());
    }

    private String encodeQuotes(final String s){
        if(encodeQuotes){
            StringBuffer buf = new StringBuffer();
            Matcher m = P_VALID_QUOTES.matcher(s);
            while (m.find()) {
                final String one = m.group(1); //(&gt;|^)
                final String two = m.group(2); //([^&lt;]+?)
                final String three = m.group(3); //(&lt;|$)
                m.appendReplacement(buf, Matcher.quoteReplacement(one + regexReplace(P_QUOTE, "&quot;", two) + three));
            }
            m.appendTail(buf);
            return buf.toString();
        }else{
            return s;
        }
    }

    private String checkEntity(final String preamble, final String term) {

        return ";".equals(term) && isValidEntity(preamble)
                ? '&' + preamble
                : "&amp;" + preamble;
    }

    private boolean isValidEntity(final String entity) {
        return inArray(entity, vAllowedEntities);
    }

    private static boolean inArray(final String s, final String[] array) {
        for (String item : array) {
            if (item != null && item.equals(s)) {
                return true;
            }
        }
        return false;
    }

    private boolean allowed(final String name) {
        return (vAllowed.isEmpty() || vAllowed.containsKey(name)) && !inArray(name, vDisallowed);
    }

    private boolean allowedAttribute(final String name, final String paramName) {
        return allowed(name) && (vAllowed.isEmpty() || vAllowed.get(name).contains(paramName));
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="123" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.292</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> LoginInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-order\src\main\java\com\jerusalem\order\interceptor\LoginInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.order.interceptor;

import com.jerusalem.common.constant.AuthConstant;
import com.jerusalem.common.vo.UserResponseVo;
import org.springframework.stereotype.Component;
import org.springframework.util.AntPathMatcher;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/****
 * @Author: jerusalem
 * @Description: LoginInterceptor
 * 订单登录拦截器
 * @Date 2020/11/7 12:29
 *****/
@Component
public class LoginInterceptor implements HandlerInterceptor {

    /***
     * 全系统共享当前登录用户
     */
    public static ThreadLocal&lt;UserResponseVo&gt; loginUser = new ThreadLocal&lt;&gt;();

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        /***
         * 放行库存系统的个别请求
         */
        String uri = request.getRequestURI();
        AntPathMatcher antPathMatcher = new AntPathMatcher();
        boolean match = antPathMatcher.match("/order/orders/status/**", uri);
        //放行支付成功异步通知回调
        boolean match1 = antPathMatcher.match("/payed/notify", uri);
        if (match || match1){
            return true;
        }

        UserResponseVo userResponseVo = (UserResponseVo) request.getSession().getAttribute(AuthConstant.LOGIN_USER);
        if (userResponseVo != null){
            //全系统共享
            loginUser.set(userResponseVo);
            return true;
        }else {
            //没登陆，拦截,重定向到登录页面
            request.getSession().setAttribute("msg","请先登录！");
            response.sendRedirect("http://auth.tesco.com/login.html");
            return false;
        }
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="124" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.295</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> tesco-mall</a><br />
<b> <a> File: </a> </b>  <a> LoginInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>tesco-seckill\src\main\java\com\jerusalem\seckill\interceptor\LoginInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.jerusalem.seckill.interceptor;

import com.jerusalem.common.constant.AuthConstant;
import com.jerusalem.common.vo.UserResponseVo;
import org.springframework.stereotype.Component;
import org.springframework.util.AntPathMatcher;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/****
 * @Author: jerusalem
 * @Description: LoginInterceptor
 * 秒杀登录拦截器
 * @Date 2020/11/7 12:29
 *****/
@Component
public class LoginInterceptor implements HandlerInterceptor {

    /***
     * 全系统共享当前登录用户
     */
    public static ThreadLocal&lt;UserResponseVo&gt; loginUser = new ThreadLocal&lt;&gt;();

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        /***
         * 拦截秒杀系统的个别请求，进行登陆检查
         * 其他的放行
         */
        String uri = request.getRequestURI();
        AntPathMatcher antPathMatcher = new AntPathMatcher();
        boolean match = antPathMatcher.match("/seckill/kill", uri);
        if (match){
            UserResponseVo userResponseVo = (UserResponseVo) request.getSession().getAttribute(AuthConstant.LOGIN_USER);
            if (userResponseVo != null){
                //全系统共享
                loginUser.set(userResponseVo);
                return true;
            }else {
                //没登陆，拦截,重定向到登录页面
                request.getSession().setAttribute("msg","请先登录！");
                response.sendRedirect("http://auth.tesco.com/login.html");
                return false;
            }
        }
        return true;
    }
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="125" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.308</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> TokenInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-consumer-service\src\main\java\com\wanxin\consumer\interceptor\TokenInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.consumer.interceptor;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.TypeReference;
import com.wanxin.api.account.model.LoginUser;
import com.wanxin.common.util.EncryptUtil;
import org.apache.commons.lang3.StringUtils;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Token拦截处理
 *
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class TokenInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) {
        String jsonToken = httpServletRequest.getParameter("jsonToken");
        if (StringUtils.isNotBlank(jsonToken)) {
            LoginUser loginUser = JSON.parseObject(EncryptUtil.decodeUTF8StringBase64(jsonToken), new TypeReference&lt;LoginUser&gt;() {
            });
            httpServletRequest.setAttribute("jsonToken", loginUser);
        }
        return true;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="126" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.314</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> TokenInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-repayment-service\src\main\java\com\wanxin\repayment\interceptor\TokenInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.repayment.interceptor;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.TypeReference;
import com.wanxin.api.account.model.LoginUser;
import com.wanxin.common.util.EncryptUtil;
import org.apache.commons.lang3.StringUtils;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Token拦截处理
 *
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class TokenInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) {
        String jsonToken = httpServletRequest.getParameter("jsonToken");
        if (StringUtils.isNotBlank(jsonToken)) {
            LoginUser loginUser = JSON.parseObject(EncryptUtil.decodeUTF8StringBase64(jsonToken), new TypeReference&lt;LoginUser&gt;() {
            });
            httpServletRequest.setAttribute("jsonToken", loginUser);
        }

        return true;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="127" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.318</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> TokenInterceptor.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-transaction-service\src\main\java\com\wanxin\transaction\interceptor\TokenInterceptor.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.transaction.interceptor;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.TypeReference;
import com.wanxin.api.account.model.LoginUser;
import com.wanxin.common.util.EncryptUtil;
import org.apache.commons.lang.StringUtils;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * &lt;P&gt;
 * Token 拦截处理
 * &lt;/p&gt;
 *
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class TokenInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) {
        String jsonToken = httpServletRequest.getParameter("jsonToken");
        if (StringUtils.isNotBlank(jsonToken)) {
            LoginUser loginUser = JSON.parseObject(EncryptUtil.decodeUTF8StringBase64(jsonToken), new TypeReference&lt;LoginUser&gt;() {
            });
            httpServletRequest.setAttribute("jsonToken", loginUser);
        }
        return true;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="128" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.320</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> wanxin</a><br />
<b> <a> File: </a> </b>  <a> ClientDefaultAccessTokenConverter.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>wanxinp2p-uaa-service\src\main\java\com\wanxin\uaa\domain\ClientDefaultAccessTokenConverter.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.wanxin.uaa.domain;

import com.alibaba.fastjson.JSON;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.AuthorityUtils;
import org.springframework.security.oauth2.common.DefaultOAuth2AccessToken;
import org.springframework.security.oauth2.common.OAuth2AccessToken;
import org.springframework.security.oauth2.provider.OAuth2Authentication;
import org.springframework.security.oauth2.provider.OAuth2Request;
import org.springframework.security.oauth2.provider.token.AccessTokenConverter;
import org.springframework.security.oauth2.provider.token.DefaultUserAuthenticationConverter;
import org.springframework.security.oauth2.provider.token.UserAuthenticationConverter;

import java.util.*;

/**
 * 令牌格式json与spring OAuth2Authentication的转换, 增加jwt对client Authorities的支持
 *
 * @author yuelimin
 * @version 1.0.0
 * @since 1.8
 */
public class ClientDefaultAccessTokenConverter implements AccessTokenConverter {

    public static final String CLIENT_AUTHORITIES = "client_authorities";
    private UserAuthenticationConverter userTokenConverter = new DefaultUserAuthenticationConverter();
    private boolean includeGrantType;

    /**
     * Converter for the part of the data in the token representing a user.
     *
     * @param userTokenConverter the userTokenConverter to set
     */
    public void setUserTokenConverter(UserAuthenticationConverter userTokenConverter) {
        this.userTokenConverter = userTokenConverter;
    }

    /**
     * Flag to indicate the the grant type should be included in the converted token.
     *
     * @param includeGrantType the flag value (default false)
     */
    public void setIncludeGrantType(boolean includeGrantType) {
        this.includeGrantType = includeGrantType;
    }

    public Map&lt;String, ?&gt; convertAccessToken(OAuth2AccessToken token, OAuth2Authentication authentication) {
        Map&lt;String, Object&gt; response = new HashMap&lt;String, Object&gt;();
        OAuth2Request clientToken = authentication.getOAuth2Request();

        if (!authentication.isClientOnly()) {
            response.putAll(userTokenConverter.convertUserAuthentication(authentication.getUserAuthentication()));

            ///增加对client Authorities支持
            if (authentication.getOAuth2Request().getAuthorities() != null && !authentication.getOAuth2Request().getAuthorities().isEmpty()) {
                response.put(CLIENT_AUTHORITIES,
                        AuthorityUtils.authorityListToSet(authentication.getOAuth2Request().getAuthorities()));
            }
            ///结束增加对client Authorities支持
        } else {
            if (clientToken.getAuthorities() != null && !clientToken.getAuthorities().isEmpty()) {
                response.put(UserAuthenticationConverter.AUTHORITIES,
                        AuthorityUtils.authorityListToSet(clientToken.getAuthorities()));
            }
        }

        if (token.getScope() != null) {
            response.put(SCOPE, token.getScope());
        }
        if (token.getAdditionalInformation().containsKey(JTI)) {
            response.put(JTI, token.getAdditionalInformation().get(JTI));
        }

        if (token.getExpiration() != null) {
            response.put(EXP, token.getExpiration().getTime() / 1000);
        }

        if (includeGrantType && authentication.getOAuth2Request().getGrantType() != null) {
            response.put(GRANT_TYPE, authentication.getOAuth2Request().getGrantType());
        }

        response.putAll(token.getAdditionalInformation());

        response.put(CLIENT_ID, clientToken.getClientId());
        if (clientToken.getResourceIds() != null && !clientToken.getResourceIds().isEmpty()) {
            response.put(AUD, clientToken.getResourceIds());
        }

        return response;
    }

    public OAuth2AccessToken extractAccessToken(String value, Map&lt;String, ?&gt; map) {
        DefaultOAuth2AccessToken token = new DefaultOAuth2AccessToken(value);
        Map&lt;String, Object&gt; info = new HashMap&lt;String, Object&gt;(map);
        info.remove(EXP);
        info.remove(AUD);
        info.remove(CLIENT_ID);
        info.remove(SCOPE);
        if (map.containsKey(EXP)) {
            token.setExpiration(new Date((Long) map.get(EXP) * 1000L));
        }
        if (map.containsKey(JTI)) {
            info.put(JTI, map.get(JTI));
        }
        token.setScope(extractScope(map));
        token.setAdditionalInformation(info);
        return token;
    }

    public OAuth2Authentication extractAuthentication(Map&lt;String, ?&gt; map) {
        Map&lt;String, String&gt; parameters = new HashMap&lt;String, String&gt;();
        Set&lt;String&gt; scope = extractScope(map);
        Authentication user = userTokenConverter.extractAuthentication(map);
        String clientId = (String) map.get(CLIENT_ID);
        parameters.put(CLIENT_ID, clientId);
        if (includeGrantType && map.containsKey(GRANT_TYPE)) {
            parameters.put(GRANT_TYPE, (String) map.get(GRANT_TYPE));
        }
        Set&lt;String&gt; resourceIds = new LinkedHashSet&lt;String&gt;(map.containsKey(AUD) ? getAudience(map)
                : Collections.&lt;String&gt;emptySet());

        Collection&lt;? extends GrantedAuthority&gt; authorities = null;
        if (user == null && map.containsKey(AUTHORITIES)) {
            @SuppressWarnings("unchecked")
            String[] roles = ((Collection&lt;String&gt;) map.get(AUTHORITIES)).toArray(new String[0]);
            authorities = AuthorityUtils.createAuthorityList(roles);
        }
        ///增加对client Authorities支持
        if (user != null && map.containsKey(CLIENT_AUTHORITIES)) {
            String[] clentRoles = ((Collection&lt;String&gt;) map.get(CLIENT_AUTHORITIES)).toArray(new String[0]);
            authorities = AuthorityUtils.createAuthorityList(clentRoles);
            ///增加额外属性
            parameters.put("mobile", (String) map.get("mobile"));
            parameters.put("tenant_id", (String) map.get("tenant_id"));
            parameters.put("department_id", (String) map.get("department_id"));
            parameters.put("user_authorities", JSON.toJSONString(map.get("user_authorities")));
            parameters.put("payload", JSON.toJSONString(map.get("payload")));
            ///结束增加额外属性
        }
        ///结束增加对client Authorities支持


        OAuth2Request request = new OAuth2Request(parameters, clientId, authorities, true, scope, resourceIds, null, null,
                null);
        return new OAuth2Authentication(request, user);
    }

    private Collection&lt;String&gt; getAudience(Map&lt;String, ?&gt; map) {
        Object auds = map.get(AUD);
        if (auds instanceof Collection) {
            @SuppressWarnings("unchecked")
            Collection&lt;String&gt; result = (Collection&lt;String&gt;) auds;
            return result;
        }
        return Collections.singleton((String) auds);
    }

    private Set&lt;String&gt; extractScope(Map&lt;String, ?&gt; map) {
        Set&lt;String&gt; scope = Collections.emptySet();
        if (map.containsKey(SCOPE)) {
            Object scopeObj = map.get(SCOPE);
            if (String.class.isInstance(scopeObj)) {
                scope = new LinkedHashSet&lt;String&gt;(Arrays.asList(String.class.cast(scopeObj).split(" ")));
            } else if (Collection.class.isAssignableFrom(scopeObj.getClass())) {
                @SuppressWarnings("unchecked")
                Collection&lt;String&gt; scopeColl = (Collection&lt;String&gt;) scopeObj;
                scope = new LinkedHashSet&lt;String&gt;(scopeColl);    // Preserve ordering
            }
        }
        return scope;
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="129" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.328</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> zheng</a><br />
<b> <a> File: </a> </b>  <a> DefaultMessageQueueListener.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>zheng-api\zheng-api-server\src\main\java\com\zheng\api\server\jms\DefaultMessageQueueListener.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zheng.api.server.jms;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.TextMessage;

/**
 * MQ消费者
 * Created by shuzheng on 2017/2/19.
 */
public class DefaultMessageQueueListener implements MessageListener {

    private static final Logger LOGGER = LoggerFactory.getLogger(DefaultMessageQueueListener.class);

    @Autowired
    ThreadPoolTaskExecutor threadPoolTaskExecutor;

    @Override
    public void onMessage(final Message message) {
        // 使用线程池多线程处理
        threadPoolTaskExecutor.execute(new Runnable() {
            @Override
            public void run() {
                if (message instanceof TextMessage) {
                    TextMessage textMessage = (TextMessage) message;
                    try {
                        LOGGER.info("消费：{}", textMessage.getText());
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }
        });
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="130" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.329</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> zheng</a><br />
<b> <a> File: </a> </b>  <a> DefaultMessageQueueListener.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>zheng-cms\zheng-cms-admin\src\main\java\com\zheng\cms\admin\jms\DefaultMessageQueueListener.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zheng.cms.admin.jms;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.TextMessage;

/**
 * MQ消费者
 * Created by ZhangShuzheng on 2017/01/12.
 */
public class DefaultMessageQueueListener implements MessageListener {

	private static final Logger LOGGER = LoggerFactory.getLogger(DefaultMessageQueueListener.class);

	@Autowired
	ThreadPoolTaskExecutor threadPoolTaskExecutor;

	@Override
    public void onMessage(final Message message) {
		// 使用线程池多线程处理
		threadPoolTaskExecutor.execute(new Runnable() {
			@Override
            public void run() {
				if (message instanceof TextMessage) {
					TextMessage textMessage = (TextMessage) message;
					try {
						LOGGER.info("消费消息：{}", textMessage.getText());
					} catch (Exception e){
						e.printStackTrace();
					}
				}
			}
		});
	}

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="131" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.330</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> zheng</a><br />
<b> <a> File: </a> </b>  <a> DefaultMessageQueueListener.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>zheng-cms\zheng-cms-job\src\main\java\com\zheng\cms\job\jms\DefaultMessageQueueListener.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zheng.cms.job.jms;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.TextMessage;

/**
 * MQ消费者
 * Created by ZhangShuzheng on 2016/11/24.
 */
public class DefaultMessageQueueListener implements MessageListener {

    private static final Logger LOGGER = LoggerFactory.getLogger(DefaultMessageQueueListener.class);

    @Autowired
    ThreadPoolTaskExecutor threadPoolTaskExecutor;

    @Override
    public void onMessage(final Message message) {
        // 使用线程池多线程处理
        threadPoolTaskExecutor.execute(new Runnable() {
            @Override
            public void run() {
                TextMessage textMessage = (TextMessage) message;
                try {
                    String text = textMessage.getText();
                    LOGGER.info("消费：{}", text);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        });
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="132" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.331</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> zheng</a><br />
<b> <a> File: </a> </b>  <a> DefaultMessageQueueListener.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>zheng-cms\zheng-cms-web\src\main\java\com\zheng\cms\web\jms\DefaultMessageQueueListener.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.zheng.cms.web.jms;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.TextMessage;

/**
 * MQ消费者
 * Created by ZhangShuzheng on 2016/11/24.
 */
public class DefaultMessageQueueListener implements MessageListener {

    private static final Logger LOGGER = LoggerFactory.getLogger(DefaultMessageQueueListener.class);

    @Autowired
    ThreadPoolTaskExecutor threadPoolTaskExecutor;

    @Override
    public void onMessage(final Message message) {
        // 使用线程池多线程处理
        threadPoolTaskExecutor.execute(new Runnable() {
            @Override
            public void run() {
                TextMessage textMessage = (TextMessage) message;
                try {
                    String text = textMessage.getText();
                    LOGGER.info("消费：{}", text);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        });
    }

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="133" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.352</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> workshop</a><br />
<b> <a> File: </a> </b>  <a> BaseComponent.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>order-service\order-loba\src\main\java\com\metamagic\ms\controller\BaseComponent.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.metamagic.ms.controller;

import java.util.Arrays;
import java.util.Enumeration;

import javax.servlet.http.HttpServletRequest;

import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;

/**
 * @author sagar
 * THIS CLASS USED FOR COMMON METHODS OF REST CONTROLLER
 */
public abstract class BaseComponent {

	/**
	 * HERE HTTPHEADERS SET CONTENT TYPE
	 * */
	protected final HttpHeaders createHeaders(HttpServletRequest request) {

		HttpHeaders headers = new HttpHeaders();
		headers.setAccept(Arrays.asList(MediaType.APPLICATION_JSON));
		headers.setContentType(MediaType.APPLICATION_JSON);

		Enumeration&lt;String&gt; headerNames = request.getHeaderNames();
		while (headerNames.hasMoreElements()) {
			String key = (String) headerNames.nextElement();
			String value = request.getHeader(key);
			headers.add(key, value);
		}

		return headers;
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="134" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.353</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> workshop</a><br />
<b> <a> File: </a> </b>  <a> TokenAspect.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>order-service\src\main\java\com\metamagic\ms\aspect\TokenAspect.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.metamagic.ms.aspect;

import javax.servlet.http.HttpServletRequest;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Scope;
import org.springframework.core.annotation.Order;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Component;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import com.metamagic.ms.bean.ResponseBean;
import com.metamagic.ms.service.TokenService;

import atg.taglib.json.util.JSONObject;
import ch.qos.logback.classic.Logger;
import io.jsonwebtoken.ExpiredJwtException;

/**
 * @author sagar
 * 
 * THIS ASPECT ADD TOKEN IN HEPLER BEAN 
 */
@Component
@Aspect
@Order(2)
@Scope(value = "request")
public class TokenAspect {

	private static final Logger log = (Logger) LoggerFactory.getLogger(TokenAspect.class);

	@Autowired
	private TokenService tokenService;

	@Autowired
	private LoginInfoHelperBean loginInfoHelperBean;

	@Around("allOperations()")
	public Object validateToken(ProceedingJoinPoint joinPoint) throws Throwable {
		HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes())
				.getRequest();
		try {
			JSONObject jsonObject = tokenService.getTokenData((String) request.getHeader("tokenid"));
			loginInfoHelperBean.setProperty(jsonObject.getString("userId"));
		} catch (ExpiredJwtException e) {
			log.error("Token expired");
			ResponseBean response = new ResponseBean(false, "Token expired.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		} catch (IllegalArgumentException e) {
			log.error("Token required");
			ResponseBean response = new ResponseBean(false, "Token required.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		} catch (Exception e) {
			log.error("Invalid Token");
			ResponseBean response = new ResponseBean(false, "Invalid Token.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		}
		return joinPoint.proceed();
	}

	@Pointcut("execution(* com.metamagic.ms.controller.read..*.*(..))")
	public void allOperations() {
	}

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="135" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.354</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> workshop</a><br />
<b> <a> File: </a> </b>  <a> BaseComponent.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>product-service\product-loba\src\main\java\com\metamagic\ms\controller\BaseComponent.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.metamagic.ms.controller;

import java.util.Arrays;
import java.util.Enumeration;

import javax.servlet.http.HttpServletRequest;

import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;

/**
 * @author sagar
 * BASE CLASS OF CONTROLLER
 */
public abstract class BaseComponent {

	protected final HttpHeaders createHeaders(HttpServletRequest request) {

		HttpHeaders headers = new HttpHeaders();
		headers.setAccept(Arrays.asList(MediaType.APPLICATION_JSON));
		headers.setContentType(MediaType.APPLICATION_JSON);

		Enumeration&lt;String&gt; headerNames = request.getHeaderNames();
		while (headerNames.hasMoreElements()) {
			String key = (String) headerNames.nextElement();
			String value = request.getHeader(key);
			headers.add(key, value);
		}

		return headers;
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="136" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.355</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> workshop</a><br />
<b> <a> File: </a> </b>  <a> TokenAspect.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>product-service\src\main\java\com\metamagic\ms\aspect\TokenAspect.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.metamagic.ms.aspect;

import javax.servlet.http.HttpServletRequest;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Scope;
import org.springframework.core.annotation.Order;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Component;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import com.metamagic.ms.bean.ResponseBean;
import com.metamagic.ms.service.TokenService;

import atg.taglib.json.util.JSONObject;
import ch.qos.logback.classic.Logger;
import io.jsonwebtoken.ExpiredJwtException;

/**
 * @author sagar
 * THIS ASPECT USED FOR ADDING TOKEN
 */
@Component
@Aspect
@Order(2)
@Scope(value = "request")
public class TokenAspect {

	private static final Logger log = (Logger) LoggerFactory.getLogger(TokenAspect.class);
	
	@Autowired
	private TokenService tokenService;

	@Autowired
	private LoginInfoHelperBean loginInfoHelperBean;

	@Around("allOperations()")
	public Object validateToken(ProceedingJoinPoint joinPoint) throws Throwable {
		HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes())
				.getRequest();
		try {
			JSONObject jsonObject = tokenService.getTokenData((String) request.getHeader("tokenid"));
			loginInfoHelperBean.setProperty(jsonObject.getString("userId"));
		} catch (ExpiredJwtException e) {
			log.error("Token expired");
			ResponseBean response = new ResponseBean(false, "Token expired.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		} catch (IllegalArgumentException e) {
			log.error("Token required");
			ResponseBean response = new ResponseBean(false, "Token required.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		} catch (Exception e) {
			log.error("Invalid Token");
			ResponseBean response = new ResponseBean(false, "Invalid Token.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		}
		return joinPoint.proceed();
	}

	@Pointcut("execution(* com.metamagic.ms.controller.write..*.*(..))")
	public void allOperations() {
	}

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="137" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.356</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> workshop</a><br />
<b> <a> File: </a> </b>  <a> BaseComponent.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>shopping-cart-service\shopping-cart-loba\src\main\java\com\metamagic\ms\controller\BaseComponent.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.metamagic.ms.controller;

import java.util.Arrays;
import java.util.Enumeration;

import javax.servlet.http.HttpServletRequest;

import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;

/**
 * @author sagar
 * THIS CLASS USED FOR CONTROLLER HTTPHREADER ADD
 */
public abstract class BaseComponent {

	protected final HttpHeaders createHeaders(HttpServletRequest request) {

		HttpHeaders headers = new HttpHeaders();
		headers.setAccept(Arrays.asList(MediaType.APPLICATION_JSON));
		headers.setContentType(MediaType.APPLICATION_JSON);

		Enumeration&lt;String&gt; headerNames = request.getHeaderNames();
		while (headerNames.hasMoreElements()) {
			String key = (String) headerNames.nextElement();
			String value = request.getHeader(key);
			headers.add(key, value);
		}

		return headers;
	}
}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="138" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.357</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> workshop</a><br />
<b> <a> File: </a> </b>  <a> TokenAspect.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>shopping-cart-service\src\main\java\com\metamagic\ms\aspect\TokenAspect.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.metamagic.ms.aspect;

import javax.servlet.http.HttpServletRequest;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Scope;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Component;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import com.metamagic.ms.bean.ResponseBean;
import com.metamagic.ms.service.TokenService;

import atg.taglib.json.util.JSONObject;
import ch.qos.logback.classic.Logger;
import io.jsonwebtoken.ExpiredJwtException;

/**
 * @author sagar
 * THIS ASPECT USED FOR TOKEN
 */
@Component
@Aspect
@Scope(value = "request")
public class TokenAspect {

	private static final Logger log = (Logger) LoggerFactory.getLogger(ServiceAspect.class);
	
	@Autowired
	private TokenService tokenService;

	@Autowired
	private LoginInfoHelperBean loginInfoHelperBean;

	@Around("allOperations()")
	public Object validateToken(ProceedingJoinPoint joinPoint) throws Throwable {
		HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes())
				.getRequest();
		try {
			JSONObject jsonObject = tokenService.getTokenData((String) request.getHeader("tokenid"));
			loginInfoHelperBean.setProperty(jsonObject.getString("userId"));
		} catch (ExpiredJwtException e) {
			log.debug("Token expired");
			ResponseBean response = new ResponseBean(false, "Token expired.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		} catch (IllegalArgumentException e) {
			log.error("Token required");
			ResponseBean response = new ResponseBean(false, "Token required.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		} catch (Exception e) {
			log.error("Invalid Token");
			ResponseBean response = new ResponseBean(false, "Invalid Token.", "failure", null);
			return new ResponseEntity&lt;ResponseBean&gt;(response, HttpStatus.UNAUTHORIZED);
		}
		return joinPoint.proceed();
	}

	@Pointcut("execution(* com.metamagic.ms.controller..*.*(..))")
	public void allOperations() {
	}

}
</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="139" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.366</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> SysLoggerAspect.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_blog\src\main\java\com\fly\blog\aop\SysLoggerAspect.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.blog.aop;

import com.alibaba.fastjson.JSON;
import com.fly.blog.entity.SysLog;
import com.fly.blog.util.HttpUtils;
import com.fly.blog.util.UserUtils;
import com.fly.blog.service.LoggerService;
import com.fly.common.annotation.SysLogger;
import org.apache.commons.lang.StringUtils;
import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;
import org.aspectj.lang.reflect.MethodSignature;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.lang.reflect.Method;
import java.util.Date;

/**
 * Description: &lt;&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
@Aspect
@Component
public class SysLoggerAspect {
    @Autowired
    private LoggerService loggerService;

    @Pointcut("@annotation(com.fly.common.annotation.SysLogger)")
    public void loggerPointCut() {

    }

    @Before("loggerPointCut()")
    public void saveSysLog(JoinPoint joinPoint) {
        MethodSignature signature = (MethodSignature) joinPoint.getSignature();
        Method method = signature.getMethod();

        SysLog sysLog = new SysLog();
        SysLogger sysLogger = method.getAnnotation(SysLogger.class);
        if (sysLogger != null) {
            //注解上的描述
            sysLog.setOperation(sysLogger.value());
        }
        //请求的方法名
        String className = joinPoint.getTarget().getClass().getName();
        String methodName = signature.getName();
        sysLog.setMethod(className + "." + methodName + "()");
        //请求的参数
        Object[] args = joinPoint.getArgs();
        String params = "";
        for (Object o : args) {
            params += JSON.toJSONString(o);
        }
        if (!StringUtils.isEmpty(params)) {
            sysLog.setParams(params);
        }
        //设置IP地址
        sysLog.setIp(HttpUtils.getIpAddress());
        //用户名
        String username = UserUtils.getCurrentPrinciple();
        if (!StringUtils.isEmpty(username)) {
            sysLog.setUsername(username);
        }
        sysLog.setCreateDate(new Date());
        //保存系统日志
        loggerService.log(sysLog);
    }

}

</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="140" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.370</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> SysLoggerAspect.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_news\src\main\java\com\fly\news\aop\SysLoggerAspect.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.news.aop;

import com.alibaba.fastjson.JSON;
import com.fly.common.annotation.SysLogger;
import com.fly.news.entity.SysLog;
import com.fly.news.service.LoggerService;
import com.fly.news.util.HttpUtils;
import com.fly.news.util.UserUtils;
import org.apache.commons.lang.StringUtils;
import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;
import org.aspectj.lang.reflect.MethodSignature;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import java.lang.reflect.Method;
import java.util.Date;

/**
 * Description: &lt;&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
@Aspect
@Component
public class SysLoggerAspect {
    @Autowired
    private LoggerService loggerService;

    @Pointcut("@annotation(com.fly.common.annotation.SysLogger)")
    public void loggerPointCut() {

    }

    @Before("loggerPointCut()")
    public void saveSysLog(JoinPoint joinPoint) {
        MethodSignature signature = (MethodSignature) joinPoint.getSignature();
        Method method = signature.getMethod();

        SysLog sysLog = new SysLog();
        SysLogger sysLogger = method.getAnnotation(SysLogger.class);
        if (sysLogger != null) {
            //注解上的描述
            sysLog.setOperation(sysLogger.value());
        }
        //请求的方法名
        String className = joinPoint.getTarget().getClass().getName();
        String methodName = signature.getName();
        sysLog.setMethod(className + "." + methodName + "()");
        //请求的参数
        Object[] args = joinPoint.getArgs();
        String params = "";
        for (Object o : args) {
            params += JSON.toJSONString(o);
        }
        if (!StringUtils.isEmpty(params)) {
            sysLog.setParams(params);
        }
        //设置IP地址
        sysLog.setIp(HttpUtils.getIpAddress());
        //用户名
        String username = UserUtils.getCurrentPrinciple();
        if (!StringUtils.isEmpty(username)) {
            sysLog.setUsername(username);
        }
        sysLog.setCreateDate(new Date());
        //保存系统日志
        loggerService.log(sysLog);
    }

}

</pre>
<br />
</div>
</div>
</div>
</div>
</div>
<div class="layui-card" id="141" style="display:block">
<div class="layui-card-header ">
<h3><b><a> No.374</a></b></h3>
</div>
<div class="layui-card-body">
<div class="layui-word-aux">
<b> <a> Project: </a> </b> <a> flycloud</a><br />
<b> <a> File: </a> </b>  <a> SysLoggerAspect.java</a><br />
<b> <a> Category: </a> </b>  <a>  DIFile &rarr; Communication Support File</a>
</div><hr />
<div class="layui-collapse" >
<div class="layui-colla-item" >
<h2 class="layui-colla-title">File Content</h2>
<div class="layui-colla-content ">
<b> <a> File Location: </a> </b>module_user\src\main\java\com\fly\user\aop\SysLoggerAspect.java</a>
<br />
<pre class="layui-code" lay-skin="notepad" lay-height="300px">
package com.fly.user.aop;

import com.alibaba.fastjson.JSON;
import com.fly.common.annotation.SysLogger;
import com.fly.user.util.HttpUtils;
import com.fly.user.util.UserUtils;
import com.fly.user.entity.SysLog;
import com.fly.user.service.LoggerService;
import org.apache.commons.lang.StringUtils;
import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;
import org.aspectj.lang.reflect.MethodSignature;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import java.lang.reflect.Method;
import java.util.Date;

/**
 * Description: &lt;SysLoggerAspect&gt;&lt;br&gt;
 * Author:    mxdl&lt;br&gt;
 * Date:      2019/2/19&lt;br&gt;
 * Version:    V1.0.0&lt;br&gt;
 * Update:     &lt;br&gt;
 */
@Aspect
@Component
public class SysLoggerAspect {
    @Autowired
    private LoggerService loggerService;

    @Pointcut("@annotation(com.fly.common.annotation.SysLogger)")
    public void loggerPointCut() {

    }

    @Before("loggerPointCut()")
    public void saveSysLog(JoinPoint joinPoint) {
        System.out.println("MYTAG:User SysLoggerAspect saveLogger start...");
        MethodSignature signature = (MethodSignature) joinPoint.getSignature();
        Method method = signature.getMethod();

        SysLog sysLog = new SysLog();
        SysLogger sysLogger = method.getAnnotation(SysLogger.class);
        if(sysLogger != null){
            //注解上的描述
            sysLog.setOperation(sysLogger.value());
        }
        //请求的方法名
        String className = joinPoint.getTarget().getClass().getName();
        String methodName = signature.getName();
        sysLog.setMethod(className + "." + methodName + "()");
        //请求的参数
        Object[] args = joinPoint.getArgs();
        String params="";

        for(Object o:args){
            params+= JSON.toJSONString(o);
        }
        if(!StringUtils.isEmpty(params)) {
            sysLog.setParams(params);
        }
        //设置IP地址
        sysLog.setIp(HttpUtils.getIpAddress());
        //用户名
        String username = UserUtils.getCurrentPrinciple();
        if(!StringUtils.isEmpty(username)) {
            sysLog.setUsername(username);
        }
        sysLog.setCreateDate(new Date());
        //保存系统日志
        loggerService.log(sysLog);
    }

}

</pre>
<br />
</div>
</div>
</div>
</div>
</div>



                        <div>
                            <div id="divpager-4"></div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>

<script>
    $(function () {
        layui.use(['laypage', 'layer'], function () {
            var laypage = layui.laypage
                , layer = layui.layer;

            laypage.render({
                elem: 'divpager-1'
                , count: 62
                , curr: 1
                , limit: __PageSize
                , jump: function (obj, first) {
                    page = obj.curr;
                    size = obj.limit;
                    for(i = 1;i <= obj.count;i++){
                        document.getElementById(i).style.display="none";
                    }
                    for (i = size * (page - 1) + 1;i <= size* page;i++){
                        if(i <= obj.count){
                            document.getElementById(i).style.display = "block";
                        }
                    }


                    if (!first) {

                    }
                }
            });
            laypage.render({
                elem: 'divpager-2'
                , count: 11
                , curr: 1
                , limit: __PageSize
                , jump: function (obj, first) {
                    page = obj.curr;
                    size = obj.limit;
                    for(i = 63;i <= obj.count + 62;i++){
                        document.getElementById(i).style.display="none";
                    }
                    for (i = size * (page - 1) + 63;i <= size* page + 62;i++){
                        if(i <= obj.count + 62){
                            document.getElementById(i).style.display = "block";
                        }
                    }
                    if (!first) {

                    }
                }
            });
            laypage.render({
                elem: 'divpager-3'
                , count: 34
                , curr: 1
                , limit: __PageSize
                , jump: function (obj, first) {
                    page = obj.curr;
                    size = obj.limit;
                    for(i = 74;i <= obj.count + 73;i++){
                        document.getElementById(i).style.display="none";
                    }
                    for (i = size * (page - 1) + 74;i <= size* page + 73;i++){
                        if(i <= obj.count + 73){
                            document.getElementById(i).style.display = "block";
                        }
                    }
                    if (!first) {

                    }
                }
            });
            laypage.render({
                elem: 'divpager-4'
                , count: 34
                , curr: 1
                , limit: __PageSize
                , jump: function (obj, first) {
                    page = obj.curr;
                    size = obj.limit;
                    for(i = 108;i <= obj.count + 107;i++){
                        document.getElementById(i).style.display="none";
                    }
                    for (i = size * (page - 1) + 108;i <= size* page + 107;i++){
                        if(i <= obj.count + 107){
                            document.getElementById(i).style.display = "block";
                        }
                    }
                    if (!first) {

                    }
                }
            });
        });
    })
</script>


    <script>
        //注意：导航 依赖 element 模块，否则无法进行功能性操作
        layui.use('element', function () {
            var element = layui.element;

        });

        document.onkeydown = function (e) { // 回车提交表单
            // 兼容FF和IE和Opera
            var theEvent = window.event || e;
            var code = theEvent.keyCode || theEvent.which || theEvent.charCode;
            if (code == 13) {
                likesearch();
            }
        }

        function likesearch() {
            var liketxt = $("#LikeKey").val();
            var url = 'http://g4.net.cn/Home/Search' + "?likekey=" + liketxt;
            document.location.href = url;
        }
    </script>

</body>
</html>
